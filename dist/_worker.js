var Fs=Object.defineProperty;var $r=e=>{throw TypeError(e)};var Us=(e,t,r)=>t in e?Fs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var O=(e,t,r)=>Us(e,typeof t!="symbol"?t+"":t,r),Ht=(e,t,r)=>t.has(e)||$r("Cannot "+r);var g=(e,t,r)=>(Ht(e,t,"read from private field"),r?r.call(e):t.get(e)),$=(e,t,r)=>t.has(e)?$r("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),M=(e,t,r,n)=>(Ht(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),k=(e,t,r)=>(Ht(e,t,"access private method"),r);var Lr=(e,t,r,n)=>({set _(s){M(e,t,s,r)},get _(){return g(e,t,n)}});import et from"events";import Ze from"util";import Tr from"crypto";import Qs from"dns";import Wn from"fs";import Kn from"net";import Ws from"tls";import Ks from"path";import Jn from"stream";import Js from"string_decoder";var qr=(e,t,r)=>(n,s)=>{let i=-1;return a(0);async function a(c){if(c<=i)throw new Error("next() called multiple times");i=c;let f,u=!1,o;if(e[c]?(o=e[c][0][0],n.req.routeIndex=c):o=c===e.length&&s||void 0,o)try{f=await o(n,()=>a(c+1))}catch(l){if(l instanceof Error&&t)n.error=l,f=await t(l,n),u=!0;else throw l}else n.finalized===!1&&r&&(f=await r(n));return f&&(n.finalized===!1||u)&&(n.res=f),n}},Gs=Symbol(),Vs=async(e,t=Object.create(null))=>{const{all:r=!1,dot:n=!1}=t,i=(e instanceof Zn?e.raw.headers:e.headers).get("Content-Type");return i!=null&&i.startsWith("multipart/form-data")||i!=null&&i.startsWith("application/x-www-form-urlencoded")?zs(e,{all:r,dot:n}):{}};async function zs(e,t){const r=await e.formData();return r?Ys(r,t):{}}function Ys(e,t){const r=Object.create(null);return e.forEach((n,s)=>{t.all||s.endsWith("[]")?Xs(r,s,n):r[s]=n}),t.dot&&Object.entries(r).forEach(([n,s])=>{n.includes(".")&&(Zs(r,n,s),delete r[n])}),r}var Xs=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},Zs=(e,t,r)=>{let n=e;const s=t.split(".");s.forEach((i,a)=>{a===s.length-1?n[i]=r:((!n[i]||typeof n[i]!="object"||Array.isArray(n[i])||n[i]instanceof File)&&(n[i]=Object.create(null)),n=n[i])})},Gn=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},ei=e=>{const{groups:t,path:r}=ti(e),n=Gn(r);return ri(n,t)},ti=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,n)=>{const s=`@${n}`;return t.push([s,r]),s}),{groups:t,path:e}},ri=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[n]=t[r];for(let s=e.length-1;s>=0;s--)if(e[s].includes(n)){e[s]=e[s].replace(n,t[r][1]);break}}return e},At={},ni=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const n=`${e}#${t}`;return At[n]||(r[2]?At[n]=t&&t[0]!==":"&&t[0]!=="*"?[n,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:At[n]=[e,r[1],!0]),At[n]}return null},Ir=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},si=e=>Ir(e,decodeURI),Vn=e=>{const t=e.url,r=t.indexOf("/",t.indexOf(":")+4);let n=r;for(;n<t.length;n++){const s=t.charCodeAt(n);if(s===37){const i=t.indexOf("?",n),a=t.indexOf("#",n),c=i===-1?a===-1?void 0:a:a===-1?i:Math.min(i,a),f=t.slice(r,c);return si(f.includes("%25")?f.replace(/%25/g,"%2525"):f)}else if(s===63||s===35)break}return t.slice(r,n)},ii=e=>{const t=Vn(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},qe=(e,t,...r)=>(r.length&&(t=qe(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),zn=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let n="";return t.forEach(s=>{if(s!==""&&!/\:/.test(s))n+="/"+s;else if(/\:/.test(s))if(/\?/.test(s)){r.length===0&&n===""?r.push("/"):r.push(n);const i=s.replace("?","");n+="/"+i,r.push(n)}else n+="/"+s}),r.filter((s,i,a)=>a.indexOf(s)===i)},jt=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?Ir(e,Xn):e):e,Yn=(e,t,r)=>{let n;if(!r&&t&&!/[%+]/.test(t)){let a=e.indexOf("?",8);if(a===-1)return;for(e.startsWith(t,a+1)||(a=e.indexOf(`&${t}`,a+1));a!==-1;){const c=e.charCodeAt(a+t.length+1);if(c===61){const f=a+t.length+2,u=e.indexOf("&",f);return jt(e.slice(f,u===-1?void 0:u))}else if(c==38||isNaN(c))return"";a=e.indexOf(`&${t}`,a+1)}if(n=/[%+]/.test(e),!n)return}const s={};n??(n=/[%+]/.test(e));let i=e.indexOf("?",8);for(;i!==-1;){const a=e.indexOf("&",i+1);let c=e.indexOf("=",i);c>a&&a!==-1&&(c=-1);let f=e.slice(i+1,c===-1?a===-1?void 0:a:c);if(n&&(f=jt(f)),i=a,f==="")continue;let u;c===-1?u="":(u=e.slice(c+1,a===-1?void 0:a),n&&(u=jt(u))),r?(s[f]&&Array.isArray(s[f])||(s[f]=[]),s[f].push(u)):s[f]??(s[f]=u)}return t?s[t]:s},ai=Yn,oi=(e,t)=>Yn(e,t,!0),Xn=decodeURIComponent,kr=e=>Ir(e,Xn),Qe,z,de,es,ts,Sr,me,Bn,Zn=(Bn=class{constructor(e,t="/",r=[[]]){$(this,de);O(this,"raw");$(this,Qe);$(this,z);O(this,"routeIndex",0);O(this,"path");O(this,"bodyCache",{});$(this,me,e=>{const{bodyCache:t,raw:r}=this,n=t[e];if(n)return n;const s=Object.keys(t)[0];return s?t[s].then(i=>(s==="json"&&(i=JSON.stringify(i)),new Response(i)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,M(this,z,r),M(this,Qe,{})}param(e){return e?k(this,de,es).call(this,e):k(this,de,ts).call(this)}query(e){return ai(this.url,e)}queries(e){return oi(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,n)=>{t[n]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await Vs(this,e))}json(){return g(this,me).call(this,"text").then(e=>JSON.parse(e))}text(){return g(this,me).call(this,"text")}arrayBuffer(){return g(this,me).call(this,"arrayBuffer")}blob(){return g(this,me).call(this,"blob")}formData(){return g(this,me).call(this,"formData")}addValidatedData(e,t){g(this,Qe)[e]=t}valid(e){return g(this,Qe)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[Gs](){return g(this,z)}get matchedRoutes(){return g(this,z)[0].map(([[,e]])=>e)}get routePath(){return g(this,z)[0].map(([[,e]])=>e)[this.routeIndex].path}},Qe=new WeakMap,z=new WeakMap,de=new WeakSet,es=function(e){const t=g(this,z)[0][this.routeIndex][1][e],r=k(this,de,Sr).call(this,t);return r&&/\%/.test(r)?kr(r):r},ts=function(){const e={},t=Object.keys(g(this,z)[0][this.routeIndex][1]);for(const r of t){const n=k(this,de,Sr).call(this,g(this,z)[0][this.routeIndex][1][r]);n!==void 0&&(e[r]=/\%/.test(n)?kr(n):n)}return e},Sr=function(e){return g(this,z)[1]?g(this,z)[1][e]:e},me=new WeakMap,Bn),ci={Stringify:1},rs=async(e,t,r,n,s)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const i=e.callbacks;return i!=null&&i.length?(s?s[0]+=e:s=[e],Promise.all(i.map(c=>c({phase:t,buffer:s,context:n}))).then(c=>Promise.all(c.filter(Boolean).map(f=>rs(f,t,!1,n,s))).then(()=>s[0]))):Promise.resolve(e)},ui="text/plain; charset=UTF-8",Ft=(e,t)=>({"Content-Type":e,...t}),nt=(e,t)=>new Response(e,t),yt,bt,oe,We,ce,J,gt,Ke,Je,Ce,wt,_t,xe,ke,Hn,fi=(Hn=class{constructor(e,t){$(this,xe);$(this,yt);$(this,bt);O(this,"env",{});$(this,oe);O(this,"finalized",!1);O(this,"error");$(this,We);$(this,ce);$(this,J);$(this,gt);$(this,Ke);$(this,Je);$(this,Ce);$(this,wt);$(this,_t);O(this,"render",(...e)=>(g(this,Ke)??M(this,Ke,t=>this.html(t)),g(this,Ke).call(this,...e)));O(this,"setLayout",e=>M(this,gt,e));O(this,"getLayout",()=>g(this,gt));O(this,"setRenderer",e=>{M(this,Ke,e)});O(this,"header",(e,t,r)=>{this.finalized&&M(this,J,nt(g(this,J).body,g(this,J)));const n=g(this,J)?g(this,J).headers:g(this,Ce)??M(this,Ce,new Headers);t===void 0?n.delete(e):r!=null&&r.append?n.append(e,t):n.set(e,t)});O(this,"status",e=>{M(this,We,e)});O(this,"set",(e,t)=>{g(this,oe)??M(this,oe,new Map),g(this,oe).set(e,t)});O(this,"get",e=>g(this,oe)?g(this,oe).get(e):void 0);O(this,"newResponse",(...e)=>k(this,xe,ke).call(this,...e));O(this,"body",(e,t,r)=>k(this,xe,ke).call(this,e,t,r));O(this,"text",(e,t,r)=>!g(this,Ce)&&!g(this,We)&&!t&&!r&&!this.finalized?new Response(e):k(this,xe,ke).call(this,e,t,Ft(ui,r)));O(this,"json",(e,t,r)=>k(this,xe,ke).call(this,JSON.stringify(e),t,Ft("application/json",r)));O(this,"html",(e,t,r)=>{const n=s=>k(this,xe,ke).call(this,s,t,Ft("text/html; charset=UTF-8",r));return typeof e=="object"?rs(e,ci.Stringify,!1,{}).then(n):n(e)});O(this,"redirect",(e,t)=>{const r=String(e);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,t??302)});O(this,"notFound",()=>(g(this,Je)??M(this,Je,()=>nt()),g(this,Je).call(this,this)));M(this,yt,e),t&&(M(this,ce,t.executionCtx),this.env=t.env,M(this,Je,t.notFoundHandler),M(this,_t,t.path),M(this,wt,t.matchResult))}get req(){return g(this,bt)??M(this,bt,new Zn(g(this,yt),g(this,_t),g(this,wt))),g(this,bt)}get event(){if(g(this,ce)&&"respondWith"in g(this,ce))return g(this,ce);throw Error("This context has no FetchEvent")}get executionCtx(){if(g(this,ce))return g(this,ce);throw Error("This context has no ExecutionContext")}get res(){return g(this,J)||M(this,J,nt(null,{headers:g(this,Ce)??M(this,Ce,new Headers)}))}set res(e){if(g(this,J)&&e){e=nt(e.body,e);for(const[t,r]of g(this,J).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const n=g(this,J).headers.getSetCookie();e.headers.delete("set-cookie");for(const s of n)e.headers.append("set-cookie",s)}else e.headers.set(t,r)}M(this,J,e),this.finalized=!0}get var(){return g(this,oe)?Object.fromEntries(g(this,oe)):{}}},yt=new WeakMap,bt=new WeakMap,oe=new WeakMap,We=new WeakMap,ce=new WeakMap,J=new WeakMap,gt=new WeakMap,Ke=new WeakMap,Je=new WeakMap,Ce=new WeakMap,wt=new WeakMap,_t=new WeakMap,xe=new WeakSet,ke=function(e,t,r){const n=g(this,J)?new Headers(g(this,J).headers):g(this,Ce)??new Headers;if(typeof t=="object"&&"headers"in t){const i=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(const[a,c]of i)a.toLowerCase()==="set-cookie"?n.append(a,c):n.set(a,c)}if(r)for(const[i,a]of Object.entries(r))if(typeof a=="string")n.set(i,a);else{n.delete(i);for(const c of a)n.append(i,c)}const s=typeof t=="number"?t:(t==null?void 0:t.status)??g(this,We);return nt(e,{status:s,headers:n})},Hn),F="ALL",di="all",li=["get","post","put","delete","options","patch"],ns="Can not add a route since the matcher is already built.",ss=class extends Error{},hi="__COMPOSED_HANDLER",pi=e=>e.text("404 Not Found",404),Br=(e,t)=>{if("getResponse"in e){const r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},te,U,is,re,Se,It,Pt,Ge,mi=(Ge=class{constructor(t={}){$(this,U);O(this,"get");O(this,"post");O(this,"put");O(this,"delete");O(this,"options");O(this,"patch");O(this,"all");O(this,"on");O(this,"use");O(this,"router");O(this,"getPath");O(this,"_basePath","/");$(this,te,"/");O(this,"routes",[]);$(this,re,pi);O(this,"errorHandler",Br);O(this,"onError",t=>(this.errorHandler=t,this));O(this,"notFound",t=>(M(this,re,t),this));O(this,"fetch",(t,...r)=>k(this,U,Pt).call(this,t,r[1],r[0],t.method));O(this,"request",(t,r,n,s)=>t instanceof Request?this.fetch(r?new Request(t,r):t,n,s):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${qe("/",t)}`,r),n,s)));O(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(k(this,U,Pt).call(this,t.request,t,void 0,t.request.method))})});[...li,di].forEach(i=>{this[i]=(a,...c)=>(typeof a=="string"?M(this,te,a):k(this,U,Se).call(this,i,g(this,te),a),c.forEach(f=>{k(this,U,Se).call(this,i,g(this,te),f)}),this)}),this.on=(i,a,...c)=>{for(const f of[a].flat()){M(this,te,f);for(const u of[i].flat())c.map(o=>{k(this,U,Se).call(this,u.toUpperCase(),g(this,te),o)})}return this},this.use=(i,...a)=>(typeof i=="string"?M(this,te,i):(M(this,te,"*"),a.unshift(i)),a.forEach(c=>{k(this,U,Se).call(this,F,g(this,te),c)}),this);const{strict:n,...s}=t;Object.assign(this,s),this.getPath=n??!0?t.getPath??Vn:ii}route(t,r){const n=this.basePath(t);return r.routes.map(s=>{var a;let i;r.errorHandler===Br?i=s.handler:(i=async(c,f)=>(await qr([],r.errorHandler)(c,()=>s.handler(c,f))).res,i[hi]=s.handler),k(a=n,U,Se).call(a,s.method,s.path,i)}),this}basePath(t){const r=k(this,U,is).call(this);return r._basePath=qe(this._basePath,t),r}mount(t,r,n){let s,i;n&&(typeof n=="function"?i=n:(i=n.optionHandler,n.replaceRequest===!1?s=f=>f:s=n.replaceRequest));const a=i?f=>{const u=i(f);return Array.isArray(u)?u:[u]}:f=>{let u;try{u=f.executionCtx}catch{}return[f.env,u]};s||(s=(()=>{const f=qe(this._basePath,t),u=f==="/"?0:f.length;return o=>{const l=new URL(o.url);return l.pathname=l.pathname.slice(u)||"/",new Request(l,o)}})());const c=async(f,u)=>{const o=await r(s(f.req.raw),...a(f));if(o)return o;await u()};return k(this,U,Se).call(this,F,qe(t,"*"),c),this}},te=new WeakMap,U=new WeakSet,is=function(){const t=new Ge({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,M(t,re,g(this,re)),t.routes=this.routes,t},re=new WeakMap,Se=function(t,r,n){t=t.toUpperCase(),r=qe(this._basePath,r);const s={basePath:this._basePath,path:r,method:t,handler:n};this.router.add(t,r,[n,s]),this.routes.push(s)},It=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},Pt=function(t,r,n,s){if(s==="HEAD")return(async()=>new Response(null,await k(this,U,Pt).call(this,t,r,n,"GET")))();const i=this.getPath(t,{env:n}),a=this.router.match(s,i),c=new fi(t,{path:i,matchResult:a,env:n,executionCtx:r,notFoundHandler:g(this,re)});if(a[0].length===1){let u;try{u=a[0][0][0][0](c,async()=>{c.res=await g(this,re).call(this,c)})}catch(o){return k(this,U,It).call(this,o,c)}return u instanceof Promise?u.then(o=>o||(c.finalized?c.res:g(this,re).call(this,c))).catch(o=>k(this,U,It).call(this,o,c)):u??g(this,re).call(this,c)}const f=qr(a[0],this.errorHandler,g(this,re));return(async()=>{try{const u=await f(c);if(!u.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return u.res}catch(u){return k(this,U,It).call(this,u,c)}})()},Ge),as=[];function xi(e,t){const r=this.buildAllMatchers(),n=((s,i)=>{const a=r[s]||r[F],c=a[2][i];if(c)return c;const f=i.match(a[0]);if(!f)return[[],as];const u=f.indexOf("",1);return[a[1][u],f]});return this.match=n,n(e,t)}var Dt="[^/]+",ut=".*",ft="(?:|/.*)",Be=Symbol(),yi=new Set(".\\+*[^]$()");function bi(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===ut||e===ft?1:t===ut||t===ft?-1:e===Dt?1:t===Dt?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var Re,Te,ne,Oe,gi=(Oe=class{constructor(){$(this,Re);$(this,Te);$(this,ne,Object.create(null))}insert(t,r,n,s,i){if(t.length===0){if(g(this,Re)!==void 0)throw Be;if(i)return;M(this,Re,r);return}const[a,...c]=t,f=a==="*"?c.length===0?["","",ut]:["","",Dt]:a==="/*"?["","",ft]:a.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let u;if(f){const o=f[1];let l=f[2]||Dt;if(o&&f[2]&&(l===".*"||(l=l.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(l))))throw Be;if(u=g(this,ne)[l],!u){if(Object.keys(g(this,ne)).some(d=>d!==ut&&d!==ft))throw Be;if(i)return;u=g(this,ne)[l]=new Oe,o!==""&&M(u,Te,s.varIndex++)}!i&&o!==""&&n.push([o,g(u,Te)])}else if(u=g(this,ne)[a],!u){if(Object.keys(g(this,ne)).some(o=>o.length>1&&o!==ut&&o!==ft))throw Be;if(i)return;u=g(this,ne)[a]=new Oe}u.insert(c,r,n,s,i)}buildRegExpStr(){const r=Object.keys(g(this,ne)).sort(bi).map(n=>{const s=g(this,ne)[n];return(typeof g(s,Te)=="number"?`(${n})@${g(s,Te)}`:yi.has(n)?`\\${n}`:n)+s.buildRegExpStr()});return typeof g(this,Re)=="number"&&r.unshift(`#${g(this,Re)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},Re=new WeakMap,Te=new WeakMap,ne=new WeakMap,Oe),$t,Et,jn,wi=(jn=class{constructor(){$(this,$t,{varIndex:0});$(this,Et,new gi)}insert(e,t,r){const n=[],s=[];for(let a=0;;){let c=!1;if(e=e.replace(/\{[^}]+\}/g,f=>{const u=`@\\${a}`;return s[a]=[u,f],a++,c=!0,u}),!c)break}const i=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=s.length-1;a>=0;a--){const[c]=s[a];for(let f=i.length-1;f>=0;f--)if(i[f].indexOf(c)!==-1){i[f]=i[f].replace(c,s[a][1]);break}}return g(this,Et).insert(i,t,n,g(this,$t),r),n}buildRegExp(){let e=g(this,Et).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],n=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(s,i,a)=>i!==void 0?(r[++t]=Number(i),"$()"):(a!==void 0&&(n[Number(a)]=++t),"")),[new RegExp(`^${e}`),r,n]}},$t=new WeakMap,Et=new WeakMap,jn),_i=[/^$/,[],Object.create(null)],Ot=Object.create(null);function os(e){return Ot[e]??(Ot[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Ei(){Ot=Object.create(null)}function vi(e){var u;const t=new wi,r=[];if(e.length===0)return _i;const n=e.map(o=>[!/\*|\/:/.test(o[0]),...o]).sort(([o,l],[d,h])=>o?1:d?-1:l.length-h.length),s=Object.create(null);for(let o=0,l=-1,d=n.length;o<d;o++){const[h,m,b]=n[o];h?s[m]=[b.map(([p])=>[p,Object.create(null)]),as]:l++;let w;try{w=t.insert(m,l,h)}catch(p){throw p===Be?new ss(m):p}h||(r[l]=b.map(([p,y])=>{const _=Object.create(null);for(y-=1;y>=0;y--){const[v,I]=w[y];_[v]=I}return[p,_]}))}const[i,a,c]=t.buildRegExp();for(let o=0,l=r.length;o<l;o++)for(let d=0,h=r[o].length;d<h;d++){const m=(u=r[o][d])==null?void 0:u[1];if(!m)continue;const b=Object.keys(m);for(let w=0,p=b.length;w<p;w++)m[b[w]]=c[m[b[w]]]}const f=[];for(const o in a)f[o]=r[a[o]];return[i,f,s]}function De(e,t){if(e){for(const r of Object.keys(e).sort((n,s)=>s.length-n.length))if(os(r).test(t))return[...e[r]]}}var ye,be,Lt,cs,Fn,Si=(Fn=class{constructor(){$(this,Lt);O(this,"name","RegExpRouter");$(this,ye);$(this,be);O(this,"match",xi);M(this,ye,{[F]:Object.create(null)}),M(this,be,{[F]:Object.create(null)})}add(e,t,r){var c;const n=g(this,ye),s=g(this,be);if(!n||!s)throw new Error(ns);n[e]||[n,s].forEach(f=>{f[e]=Object.create(null),Object.keys(f[F]).forEach(u=>{f[e][u]=[...f[F][u]]})}),t==="/*"&&(t="*");const i=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const f=os(t);e===F?Object.keys(n).forEach(u=>{var o;(o=n[u])[t]||(o[t]=De(n[u],t)||De(n[F],t)||[])}):(c=n[e])[t]||(c[t]=De(n[e],t)||De(n[F],t)||[]),Object.keys(n).forEach(u=>{(e===F||e===u)&&Object.keys(n[u]).forEach(o=>{f.test(o)&&n[u][o].push([r,i])})}),Object.keys(s).forEach(u=>{(e===F||e===u)&&Object.keys(s[u]).forEach(o=>f.test(o)&&s[u][o].push([r,i]))});return}const a=zn(t)||[t];for(let f=0,u=a.length;f<u;f++){const o=a[f];Object.keys(s).forEach(l=>{var d;(e===F||e===l)&&((d=s[l])[o]||(d[o]=[...De(n[l],o)||De(n[F],o)||[]]),s[l][o].push([r,i-u+f+1]))})}}buildAllMatchers(){const e=Object.create(null);return Object.keys(g(this,be)).concat(Object.keys(g(this,ye))).forEach(t=>{e[t]||(e[t]=k(this,Lt,cs).call(this,t))}),M(this,ye,M(this,be,void 0)),Ei(),e}},ye=new WeakMap,be=new WeakMap,Lt=new WeakSet,cs=function(e){const t=[];let r=e===F;return[g(this,ye),g(this,be)].forEach(n=>{const s=n[e]?Object.keys(n[e]).map(i=>[i,n[e][i]]):[];s.length!==0?(r||(r=!0),t.push(...s)):e!==F&&t.push(...Object.keys(n[F]).map(i=>[i,n[F][i]]))}),r?vi(t):null},Fn),ge,ue,Un,Ai=(Un=class{constructor(e){O(this,"name","SmartRouter");$(this,ge,[]);$(this,ue,[]);M(this,ge,e.routers)}add(e,t,r){if(!g(this,ue))throw new Error(ns);g(this,ue).push([e,t,r])}match(e,t){if(!g(this,ue))throw new Error("Fatal error");const r=g(this,ge),n=g(this,ue),s=r.length;let i=0,a;for(;i<s;i++){const c=r[i];try{for(let f=0,u=n.length;f<u;f++)c.add(...n[f]);a=c.match(e,t)}catch(f){if(f instanceof ss)continue;throw f}this.match=c.match.bind(c),M(this,ge,[c]),M(this,ue,void 0);break}if(i===s)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(g(this,ue)||g(this,ge).length!==1)throw new Error("No active router has been determined yet.");return g(this,ge)[0]}},ge=new WeakMap,ue=new WeakMap,Un),st=Object.create(null),Ci=e=>{for(const t in e)return!0;return!1},we,K,Ie,Ve,W,fe,Ae,ze,Ri=(ze=class{constructor(t,r,n){$(this,fe);$(this,we);$(this,K);$(this,Ie);$(this,Ve,0);$(this,W,st);if(M(this,K,n||Object.create(null)),M(this,we,[]),t&&r){const s=Object.create(null);s[t]={handler:r,possibleKeys:[],score:0},M(this,we,[s])}M(this,Ie,[])}insert(t,r,n){M(this,Ve,++Lr(this,Ve)._);let s=this;const i=ei(r),a=[];for(let c=0,f=i.length;c<f;c++){const u=i[c],o=i[c+1],l=ni(u,o),d=Array.isArray(l)?l[0]:u;if(d in g(s,K)){s=g(s,K)[d],l&&a.push(l[1]);continue}g(s,K)[d]=new ze,l&&(g(s,Ie).push(l),a.push(l[1])),s=g(s,K)[d]}return g(s,we).push({[t]:{handler:n,possibleKeys:a.filter((c,f,u)=>u.indexOf(c)===f),score:g(this,Ve)}}),s}search(t,r){var o;const n=[];M(this,W,st);let i=[this];const a=Gn(r),c=[],f=a.length;let u=null;for(let l=0;l<f;l++){const d=a[l],h=l===f-1,m=[];for(let w=0,p=i.length;w<p;w++){const y=i[w],_=g(y,K)[d];_&&(M(_,W,g(y,W)),h?(g(_,K)["*"]&&k(this,fe,Ae).call(this,n,g(_,K)["*"],t,g(y,W)),k(this,fe,Ae).call(this,n,_,t,g(y,W))):m.push(_));for(let v=0,I=g(y,Ie).length;v<I;v++){const T=g(y,Ie)[v],x=g(y,W)===st?{}:{...g(y,W)};if(T==="*"){const P=g(y,K)["*"];P&&(k(this,fe,Ae).call(this,n,P,t,g(y,W)),M(P,W,x),m.push(P));continue}const[S,E,C]=T;if(!d&&!(C instanceof RegExp))continue;const R=g(y,K)[S];if(C instanceof RegExp){if(u===null){u=new Array(f);let D=r[0]==="/"?1:0;for(let q=0;q<f;q++)u[q]=D,D+=a[q].length+1}const P=r.substring(u[l]),A=C.exec(P);if(A){if(x[E]=A[0],k(this,fe,Ae).call(this,n,R,t,g(y,W),x),Ci(g(R,K))){M(R,W,x);const D=((o=A[0].match(/\//))==null?void 0:o.length)??0;(c[D]||(c[D]=[])).push(R)}continue}}(C===!0||C.test(d))&&(x[E]=d,h?(k(this,fe,Ae).call(this,n,R,t,x,g(y,W)),g(R,K)["*"]&&k(this,fe,Ae).call(this,n,g(R,K)["*"],t,x,g(y,W))):(M(R,W,x),m.push(R)))}}const b=c.shift();i=b?m.concat(b):m}return n.length>1&&n.sort((l,d)=>l.score-d.score),[n.map(({handler:l,params:d})=>[l,d])]}},we=new WeakMap,K=new WeakMap,Ie=new WeakMap,Ve=new WeakMap,W=new WeakMap,fe=new WeakSet,Ae=function(t,r,n,s,i){for(let a=0,c=g(r,we).length;a<c;a++){const f=g(r,we)[a],u=f[n]||f[F],o={};if(u!==void 0&&(u.params=Object.create(null),t.push(u),s!==st||i&&i!==st))for(let l=0,d=u.possibleKeys.length;l<d;l++){const h=u.possibleKeys[l],m=o[u.score];u.params[h]=i!=null&&i[h]&&!m?i[h]:s[h]??(i==null?void 0:i[h]),o[u.score]=!0}}},ze),Pe,Qn,Ti=(Qn=class{constructor(){O(this,"name","TrieRouter");$(this,Pe);M(this,Pe,new Ri)}add(e,t,r){const n=zn(t);if(n){for(let s=0,i=n.length;s<i;s++)g(this,Pe).insert(e,n[s],r);return}g(this,Pe).insert(e,t,r)}match(e,t){return g(this,Pe).search(e,t)}},Pe=new WeakMap,Qn),tt=class extends mi{constructor(e={}){super(e),this.router=e.router??new Ai({routers:[new Si,new Ti]})}},Ii=e=>{const r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},n=(i=>typeof i=="string"?i==="*"?()=>i:a=>i===a?a:null:typeof i=="function"?i:a=>i.includes(a)?a:null)(r.origin),s=(i=>typeof i=="function"?i:Array.isArray(i)?()=>i:()=>[])(r.allowMethods);return async function(a,c){var o;function f(l,d){a.res.headers.set(l,d)}const u=await n(a.req.header("origin")||"",a);if(u&&f("Access-Control-Allow-Origin",u),r.credentials&&f("Access-Control-Allow-Credentials","true"),(o=r.exposeHeaders)!=null&&o.length&&f("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),a.req.method==="OPTIONS"){r.origin!=="*"&&f("Vary","Origin"),r.maxAge!=null&&f("Access-Control-Max-Age",r.maxAge.toString());const l=await s(a.req.header("origin")||"",a);l.length&&f("Access-Control-Allow-Methods",l.join(","));let d=r.allowHeaders;if(!(d!=null&&d.length)){const h=a.req.header("Access-Control-Request-Headers");h&&(d=h.split(/\s*,\s*/))}return d!=null&&d.length&&(f("Access-Control-Allow-Headers",d.join(",")),a.res.headers.append("Vary","Access-Control-Request-Headers")),a.res.headers.delete("Content-Length"),a.res.headers.delete("Content-Type"),new Response(null,{headers:a.res.headers,status:204,statusText:"No Content"})}await c(),r.origin!=="*"&&a.header("Vary","Origin",{append:!0})}};function Pi(){const{process:e,Deno:t}=globalThis;return!(typeof(t==null?void 0:t.noColor)=="boolean"?t.noColor:e!==void 0?"NO_COLOR"in(e==null?void 0:e.env):!1)}async function Oi(){const{navigator:e}=globalThis,t="cloudflare:workers";return!(e!==void 0&&e.userAgent==="Cloudflare-Workers"?await(async()=>{try{return"NO_COLOR"in((await import(t)).env??{})}catch{return!1}})():!Pi())}var Mi=e=>{const[t,r]=[",","."];return e.map(s=>s.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+t)).join(r)},Di=e=>{const t=Date.now()-e;return Mi([t<1e3?t+"ms":Math.round(t/1e3)+"s"])},Ni=async e=>{if(await Oi())switch(e/100|0){case 5:return`\x1B[31m${e}\x1B[0m`;case 4:return`\x1B[33m${e}\x1B[0m`;case 3:return`\x1B[36m${e}\x1B[0m`;case 2:return`\x1B[32m${e}\x1B[0m`}return`${e}`};async function Hr(e,t,r,n,s=0,i){const a=t==="<--"?`${t} ${r} ${n}`:`${t} ${r} ${n} ${await Ni(s)} ${i}`;e(a)}var $i=(e=console.log)=>async function(r,n){const{method:s,url:i}=r.req,a=i.slice(i.indexOf("/",8));await Hr(e,"<--",s,a);const c=Date.now();await n(),await Hr(e,"-->",s,a,r.res.status,Di(c))},Li=/^\s*(?:text\/(?!event-stream(?:[;\s]|$))[^;\s]+|application\/(?:javascript|json|xml|xml-dtd|ecmascript|dart|postscript|rtf|tar|toml|vnd\.dart|vnd\.ms-fontobject|vnd\.ms-opentype|wasm|x-httpd-php|x-javascript|x-ns-proxy-autoconfig|x-sh|x-tar|x-virtualbox-hdd|x-virtualbox-ova|x-virtualbox-ovf|x-virtualbox-vbox|x-virtualbox-vdi|x-virtualbox-vhd|x-virtualbox-vmdk|x-www-form-urlencoded)|font\/(?:otf|ttf)|image\/(?:bmp|vnd\.adobe\.photoshop|vnd\.microsoft\.icon|vnd\.ms-dds|x-icon|x-ms-bmp)|message\/rfc822|model\/gltf-binary|x-shader\/x-fragment|x-shader\/x-vertex|[^;\s]+?\+(?:json|text|xml|yaml))(?:[;\s]|$)/i,jr=(e,t=ki)=>{const r=/\.([a-zA-Z0-9]+?)$/,n=e.match(r);if(!n)return;let s=t[n[1]];return s&&s.startsWith("text")&&(s+="; charset=utf-8"),s},qi={aac:"audio/aac",avi:"video/x-msvideo",avif:"image/avif",av1:"video/av1",bin:"application/octet-stream",bmp:"image/bmp",css:"text/css",csv:"text/csv",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",map:"application/json",mid:"audio/x-midi",midi:"audio/x-midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",pdf:"application/pdf",png:"image/png",rtf:"application/rtf",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",wasm:"application/wasm",webm:"video/webm",weba:"audio/webm",webmanifest:"application/manifest+json",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xml:"application/xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2",gltf:"model/gltf+json",glb:"model/gltf-binary"},ki=qi,Bi=(...e)=>{let t=e.filter(s=>s!=="").join("/");t=t.replace(new RegExp("(?<=\\/)\\/+","g"),"");const r=t.split("/"),n=[];for(const s of r)s===".."&&n.length>0&&n.at(-1)!==".."?n.pop():s!=="."&&n.push(s);return n.join("/")||"."},us={br:".br",zstd:".zst",gzip:".gz"},Hi=Object.keys(us),ji="index.html",Fi=e=>{const t=e.root??"./",r=e.path,n=e.join??Bi;return async(s,i)=>{var o,l,d,h;if(s.finalized)return i();let a;if(e.path)a=e.path;else try{if(a=decodeURIComponent(s.req.path),/(?:^|[\/\\])\.\.(?:$|[\/\\])/.test(a))throw new Error}catch{return await((o=e.onNotFound)==null?void 0:o.call(e,s.req.path,s)),i()}let c=n(t,!r&&e.rewriteRequestPath?e.rewriteRequestPath(a):a);e.isDir&&await e.isDir(c)&&(c=n(c,ji));const f=e.getContent;let u=await f(c,s);if(u instanceof Response)return s.newResponse(u.body,u);if(u){const m=e.mimes&&jr(c,e.mimes)||jr(c);if(s.header("Content-Type",m||"application/octet-stream"),e.precompressed&&(!m||Li.test(m))){const b=new Set((l=s.req.header("Accept-Encoding"))==null?void 0:l.split(",").map(w=>w.trim()));for(const w of Hi){if(!b.has(w))continue;const p=await f(c+us[w],s);if(p){u=p,s.header("Content-Encoding",w),s.header("Vary","Accept-Encoding",{append:!0});break}}}return await((d=e.onFound)==null?void 0:d.call(e,c,s)),s.body(u)}await((h=e.onNotFound)==null?void 0:h.call(e,c,s)),await i()}},Ui=async(e,t)=>{let r;t&&t.manifest?typeof t.manifest=="string"?r=JSON.parse(t.manifest):r=t.manifest:typeof __STATIC_CONTENT_MANIFEST=="string"?r=JSON.parse(__STATIC_CONTENT_MANIFEST):r=__STATIC_CONTENT_MANIFEST;let n;t&&t.namespace?n=t.namespace:n=__STATIC_CONTENT;const s=r[e];if(!s)return null;const i=await n.get(s,{type:"stream"});return i||null},Qi=e=>async function(r,n){return Fi({...e,getContent:async i=>Ui(i,{manifest:e.manifest,namespace:e.namespace?e.namespace:r.env?r.env.__STATIC_CONTENT:void 0})})(r,n)},Wi=e=>Qi(e),Pr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ki(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Ji(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}),r}var Ut={exports:{}},Qt={exports:{}},Ne={},Wt={},Fr;function fs(){if(Fr)return Wt;Fr=1,Wt.parse=function(r,n){return new e(r,n).parse()};class e{constructor(n,s){this.source=n,this.transform=s||t,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var n=this.source[this.position++];return n==="\\"?{value:this.source[this.position++],escaped:!0}:{value:n,escaped:!1}}record(n){this.recorded.push(n)}newEntry(n){var s;(this.recorded.length>0||n)&&(s=this.recorded.join(""),s==="NULL"&&!n&&(s=null),s!==null&&(s=this.transform(s)),this.entries.push(s),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var n=this.nextCharacter();if(n.value==="=")break}}parse(n){var s,i,a;for(this.consumeDimensions();!this.isEof();)if(s=this.nextCharacter(),s.value==="{"&&!a)this.dimension++,this.dimension>1&&(i=new e(this.source.substr(this.position-1),this.transform),this.entries.push(i.parse(!0)),this.position+=i.position-2);else if(s.value==="}"&&!a){if(this.dimension--,!this.dimension&&(this.newEntry(),n))return this.entries}else s.value==='"'&&!s.escaped?(a&&this.newEntry(!0),a=!a):s.value===","&&!a?this.newEntry():this.record(s.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}}function t(r){return r}return Wt}var Kt,Ur;function ds(){if(Ur)return Kt;Ur=1;var e=fs();return Kt={create:function(t,r){return{parse:function(){return e.parse(t,r)}}}},Kt}var Jt,Qr;function Gi(){if(Qr)return Jt;Qr=1;var e=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,t=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,r=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,n=/^-?infinity$/;Jt=function(u){if(n.test(u))return Number(u.replace("i","I"));var o=e.exec(u);if(!o)return s(u)||null;var l=!!o[8],d=parseInt(o[1],10);l&&(d=a(d));var h=parseInt(o[2],10)-1,m=o[3],b=parseInt(o[4],10),w=parseInt(o[5],10),p=parseInt(o[6],10),y=o[7];y=y?1e3*parseFloat(y):0;var _,v=i(u);return v!=null?(_=new Date(Date.UTC(d,h,m,b,w,p,y)),c(d)&&_.setUTCFullYear(d),v!==0&&_.setTime(_.getTime()-v)):(_=new Date(d,h,m,b,w,p,y),c(d)&&_.setFullYear(d)),_};function s(f){var u=t.exec(f);if(u){var o=parseInt(u[1],10),l=!!u[4];l&&(o=a(o));var d=parseInt(u[2],10)-1,h=u[3],m=new Date(o,d,h);return c(o)&&m.setFullYear(o),m}}function i(f){if(f.endsWith("+00"))return 0;var u=r.exec(f.split(" ")[1]);if(u){var o=u[1];if(o==="Z")return 0;var l=o==="-"?-1:1,d=parseInt(u[2],10)*3600+parseInt(u[3]||0,10)*60+parseInt(u[4]||0,10);return d*l*1e3}}function a(f){return-(f-1)}function c(f){return f>=0&&f<100}return Jt}var Gt,Wr;function Vi(){if(Wr)return Gt;Wr=1,Gt=t;var e=Object.prototype.hasOwnProperty;function t(r){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var i in s)e.call(s,i)&&(r[i]=s[i])}return r}return Gt}var Vt,Kr;function zi(){if(Kr)return Vt;Kr=1;var e=Vi();Vt=t;function t(w){if(!(this instanceof t))return new t(w);e(this,b(w))}var r=["seconds","minutes","hours","days","months","years"];t.prototype.toPostgres=function(){var w=r.filter(this.hasOwnProperty,this);return this.milliseconds&&w.indexOf("seconds")<0&&w.push("seconds"),w.length===0?"0":w.map(function(p){var y=this[p]||0;return p==="seconds"&&this.milliseconds&&(y=(y+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),y+" "+p},this).join(" ")};var n={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},s=["years","months","days"],i=["hours","minutes","seconds"];t.prototype.toISOString=t.prototype.toISO=function(){var w=s.map(y,this).join(""),p=i.map(y,this).join("");return"P"+w+"T"+p;function y(_){var v=this[_]||0;return _==="seconds"&&this.milliseconds&&(v=(v+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),v+n[_]}};var a="([+-]?\\d+)",c=a+"\\s+years?",f=a+"\\s+mons?",u=a+"\\s+days?",o="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",l=new RegExp([c,f,u,o].map(function(w){return"("+w+")?"}).join("\\s*")),d={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},h=["hours","minutes","seconds","milliseconds"];function m(w){var p=w+"000000".slice(w.length);return parseInt(p,10)/1e3}function b(w){if(!w)return{};var p=l.exec(w),y=p[8]==="-";return Object.keys(d).reduce(function(_,v){var I=d[v],T=p[I];return!T||(T=v==="milliseconds"?m(T):parseInt(T,10),!T)||(y&&~h.indexOf(v)&&(T*=-1),_[v]=T),_},{})}return Vt}var zt,Jr;function Yi(){if(Jr)return zt;Jr=1;var e=Buffer.from||Buffer;return zt=function(r){if(/^\\x/.test(r))return e(r.substr(2),"hex");for(var n="",s=0;s<r.length;)if(r[s]!=="\\")n+=r[s],++s;else if(/[0-7]{3}/.test(r.substr(s+1,3)))n+=String.fromCharCode(parseInt(r.substr(s+1,3),8)),s+=4;else{for(var i=1;s+i<r.length&&r[s+i]==="\\";)i++;for(var a=0;a<Math.floor(i/2);++a)n+="\\";s+=Math.floor(i/2)*2}return e(n,"binary")},zt}var Yt,Gr;function Xi(){if(Gr)return Yt;Gr=1;var e=fs(),t=ds(),r=Gi(),n=zi(),s=Yi();function i(x){return function(E){return E===null?E:x(E)}}function a(x){return x===null?x:x==="TRUE"||x==="t"||x==="true"||x==="y"||x==="yes"||x==="on"||x==="1"}function c(x){return x?e.parse(x,a):null}function f(x){return parseInt(x,10)}function u(x){return x?e.parse(x,i(f)):null}function o(x){return x?e.parse(x,i(function(S){return y(S).trim()})):null}var l=function(x){if(!x)return null;var S=t.create(x,function(E){return E!==null&&(E=v(E)),E});return S.parse()},d=function(x){if(!x)return null;var S=t.create(x,function(E){return E!==null&&(E=parseFloat(E)),E});return S.parse()},h=function(x){if(!x)return null;var S=t.create(x);return S.parse()},m=function(x){if(!x)return null;var S=t.create(x,function(E){return E!==null&&(E=r(E)),E});return S.parse()},b=function(x){if(!x)return null;var S=t.create(x,function(E){return E!==null&&(E=n(E)),E});return S.parse()},w=function(x){return x?e.parse(x,i(s)):null},p=function(x){return parseInt(x,10)},y=function(x){var S=String(x);return/^\d+$/.test(S)?S:x},_=function(x){return x?e.parse(x,i(JSON.parse)):null},v=function(x){return x[0]!=="("?null:(x=x.substring(1,x.length-1).split(","),{x:parseFloat(x[0]),y:parseFloat(x[1])})},I=function(x){if(x[0]!=="<"&&x[1]!=="(")return null;for(var S="(",E="",C=!1,R=2;R<x.length-1;R++){if(C||(S+=x[R]),x[R]===")"){C=!0;continue}else if(!C)continue;x[R]!==","&&(E+=x[R])}var P=v(S);return P.radius=parseFloat(E),P},T=function(x){x(20,y),x(21,p),x(23,p),x(26,p),x(700,parseFloat),x(701,parseFloat),x(16,a),x(1082,r),x(1114,r),x(1184,r),x(600,v),x(651,h),x(718,I),x(1e3,c),x(1001,w),x(1005,u),x(1007,u),x(1028,u),x(1016,o),x(1017,l),x(1021,d),x(1022,d),x(1231,d),x(1014,h),x(1015,h),x(1008,h),x(1009,h),x(1040,h),x(1041,h),x(1115,m),x(1182,m),x(1185,m),x(1186,n),x(1187,b),x(17,s),x(114,JSON.parse.bind(JSON)),x(3802,JSON.parse.bind(JSON)),x(199,_),x(3807,_),x(3907,h),x(2951,h),x(791,h),x(1183,h),x(1270,h)};return Yt={init:T},Yt}var Xt,Vr;function Zi(){if(Vr)return Xt;Vr=1;var e=1e6;function t(r){var n=r.readInt32BE(0),s=r.readUInt32BE(4),i="";n<0&&(n=~n+(s===0),s=~s+1>>>0,i="-");var a="",c,f,u,o,l,d;{if(c=n%e,n=n/e>>>0,f=4294967296*c+s,s=f/e>>>0,u=""+(f-e*s),s===0&&n===0)return i+u+a;for(o="",l=6-u.length,d=0;d<l;d++)o+="0";a=o+u+a}{if(c=n%e,n=n/e>>>0,f=4294967296*c+s,s=f/e>>>0,u=""+(f-e*s),s===0&&n===0)return i+u+a;for(o="",l=6-u.length,d=0;d<l;d++)o+="0";a=o+u+a}{if(c=n%e,n=n/e>>>0,f=4294967296*c+s,s=f/e>>>0,u=""+(f-e*s),s===0&&n===0)return i+u+a;for(o="",l=6-u.length,d=0;d<l;d++)o+="0";a=o+u+a}return c=n%e,f=4294967296*c+s,u=""+f%e,i+u+a}return Xt=t,Xt}var Zt,zr;function ea(){if(zr)return Zt;zr=1;var e=Zi(),t=function(h,m,b,w,p){b=b||0,w=w||!1,p=p||function(C,R,P){return C*Math.pow(2,P)+R};var y=b>>3,_=function(C){return w?~C&255:C},v=255,I=8-b%8;m<I&&(v=255<<8-m&255,I=m),b&&(v=v>>b%8);var T=0;b%8+m>=8&&(T=p(0,_(h[y])&v,I));for(var x=m+b>>3,S=y+1;S<x;S++)T=p(T,_(h[S]),8);var E=(m+b)%8;return E>0&&(T=p(T,_(h[x])>>8-E,E)),T},r=function(h,m,b){var w=Math.pow(2,b-1)-1,p=t(h,1),y=t(h,b,1);if(y===0)return 0;var _=1,v=function(T,x,S){T===0&&(T=1);for(var E=1;E<=S;E++)_/=2,(x&1<<S-E)>0&&(T+=_);return T},I=t(h,m,b+1,!1,v);return y==Math.pow(2,b+1)-1?I===0?p===0?1/0:-1/0:NaN:(p===0?1:-1)*Math.pow(2,y-w)*I},n=function(h){return t(h,1)==1?-1*(t(h,15,1,!0)+1):t(h,15,1)},s=function(h){return t(h,1)==1?-1*(t(h,31,1,!0)+1):t(h,31,1)},i=function(h){return r(h,23,8)},a=function(h){return r(h,52,11)},c=function(h){var m=t(h,16,32);if(m==49152)return NaN;for(var b=Math.pow(1e4,t(h,16,16)),w=0,p=t(h,16),y=0;y<p;y++)w+=t(h,16,64+16*y)*b,b/=1e4;var _=Math.pow(10,t(h,16,48));return(m===0?1:-1)*Math.round(w*_)/_},f=function(h,m){var b=t(m,1),w=t(m,63,1),p=new Date((b===0?1:-1)*w/1e3+9466848e5);return h||p.setTime(p.getTime()+p.getTimezoneOffset()*6e4),p.usec=w%1e3,p.getMicroSeconds=function(){return this.usec},p.setMicroSeconds=function(y){this.usec=y},p.getUTCMicroSeconds=function(){return this.usec},p},u=function(h){var m=t(h,32);t(h,32,32);for(var b=t(h,32,64),w=96,p=[],y=0;y<m;y++)p[y]=t(h,32,w),w+=32,w+=32;var _=function(I){var T=t(h,32,w);if(w+=32,T==4294967295)return null;var x;if(I==23||I==20)return x=t(h,T*8,w),w+=T*8,x;if(I==25)return x=h.toString(this.encoding,w>>3,(w+=T<<3)>>3),x;console.log("ERROR: ElementType not implemented: "+I)},v=function(I,T){var x=[],S;if(I.length>1){var E=I.shift();for(S=0;S<E;S++)x[S]=v(I,T);I.unshift(E)}else for(S=0;S<I[0];S++)x[S]=_(T);return x};return v(p,b)},o=function(h){return h.toString("utf8")},l=function(h){return h===null?null:t(h,8)>0},d=function(h){h(20,e),h(21,n),h(23,s),h(26,s),h(1700,c),h(700,i),h(701,a),h(16,l),h(1114,f.bind(null,!1)),h(1184,f.bind(null,!0)),h(1e3,u),h(1007,u),h(1016,u),h(1008,u),h(1009,u),h(25,o)};return Zt={init:d},Zt}var er,Yr;function ta(){return Yr||(Yr=1,er={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}),er}var Xr;function qt(){if(Xr)return Ne;Xr=1;var e=Xi(),t=ea(),r=ds(),n=ta();Ne.getTypeParser=a,Ne.setTypeParser=c,Ne.arrayParser=r,Ne.builtins=n;var s={text:{},binary:{}};function i(f){return String(f)}function a(f,u){return u=u||"text",s[u]&&s[u][f]||i}function c(f,u,o){typeof u=="function"&&(o=u,u="text"),s[u][f]=o}return e.init(function(f,u){s.text[f]=u}),t.init(function(f,u){s.binary[f]=u}),Ne}var Zr;function kt(){return Zr||(Zr=1,(function(e){var t={};let r;try{r=process.platform==="win32"?t.USERNAME:t.USER}catch{}e.exports={host:"localhost",user:r,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};const n=qt(),s=n.getTypeParser(20,"text"),i=n.getTypeParser(1016,"text");e.exports.__defineSetter__("parseInt8",function(a){n.setTypeParser(20,"text",a?n.getTypeParser(23,"text"):s),n.setTypeParser(1016,"text",a?n.getTypeParser(1007,"text"):i)})})(Qt)),Qt.exports}var tr,en;function lt(){if(en)return tr;en=1;const e=kt(),t=Ze,{isDate:r}=t.types||t;function n(d){return'"'+d.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function s(d){let h="{";for(let m=0;m<d.length;m++)if(m>0&&(h=h+","),d[m]===null||typeof d[m]>"u")h=h+"NULL";else if(Array.isArray(d[m]))h=h+s(d[m]);else if(ArrayBuffer.isView(d[m])){let b=d[m];if(!(b instanceof Buffer)){const w=Buffer.from(b.buffer,b.byteOffset,b.byteLength);w.length===b.byteLength?b=w:b=w.slice(b.byteOffset,b.byteOffset+b.byteLength)}h+="\\\\x"+b.toString("hex")}else h+=n(i(d[m]));return h=h+"}",h}const i=function(d,h){if(d==null)return null;if(typeof d=="object"){if(d instanceof Buffer)return d;if(ArrayBuffer.isView(d)){const m=Buffer.from(d.buffer,d.byteOffset,d.byteLength);return m.length===d.byteLength?m:m.slice(d.byteOffset,d.byteOffset+d.byteLength)}return r(d)?e.parseInputDatesAsUTC?f(d):c(d):Array.isArray(d)?s(d):a(d,h)}return d.toString()};function a(d,h){if(d&&typeof d.toPostgres=="function"){if(h=h||[],h.indexOf(d)!==-1)throw new Error('circular reference detected while preparing "'+d+'" for query');return h.push(d),i(d.toPostgres(i),h)}return JSON.stringify(d)}function c(d){let h=-d.getTimezoneOffset(),m=d.getFullYear();const b=m<1;b&&(m=Math.abs(m)+1);let w=String(m).padStart(4,"0")+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0")+"T"+String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0")+":"+String(d.getSeconds()).padStart(2,"0")+"."+String(d.getMilliseconds()).padStart(3,"0");return h<0?(w+="-",h*=-1):w+="+",w+=String(Math.floor(h/60)).padStart(2,"0")+":"+String(h%60).padStart(2,"0"),b&&(w+=" BC"),w}function f(d){let h=d.getUTCFullYear();const m=h<1;m&&(h=Math.abs(h)+1);let b=String(h).padStart(4,"0")+"-"+String(d.getUTCMonth()+1).padStart(2,"0")+"-"+String(d.getUTCDate()).padStart(2,"0")+"T"+String(d.getUTCHours()).padStart(2,"0")+":"+String(d.getUTCMinutes()).padStart(2,"0")+":"+String(d.getUTCSeconds()).padStart(2,"0")+"."+String(d.getUTCMilliseconds()).padStart(3,"0");return b+="+00:00",m&&(b+=" BC"),b}function u(d,h,m){return d=typeof d=="string"?{text:d}:d,h&&(typeof h=="function"?d.callback=h:d.values=h),m&&(d.callback=m),d}return tr={prepareValue:function(h){return i(h)},normalizeQueryConfig:u,escapeIdentifier:function(d){return'"'+d.replace(/"/g,'""')+'"'},escapeLiteral:function(d){let h=!1,m="'";if(d==null||typeof d!="string")return"''";for(let b=0;b<d.length;b++){const w=d[b];w==="'"?m+=w+w:w==="\\"?(m+=w+w,h=!0):m+=w}return m+="'",h===!0&&(m=" E"+m),m}},tr}var Ct={exports:{}},rr,tn;function ra(){if(tn)return rr;tn=1;const e=Tr;function t(c){return e.createHash("md5").update(c,"utf-8").digest("hex")}function r(c,f,u){const o=t(f+c);return"md5"+t(Buffer.concat([Buffer.from(o),u]))}function n(c){return e.createHash("sha256").update(c).digest()}function s(c,f){return c=c.replace(/(\D)-/,"$1"),e.createHash(c).update(f).digest()}function i(c,f){return e.createHmac("sha256",c).update(f).digest()}async function a(c,f,u){return e.pbkdf2Sync(c,f,u,32,"sha256")}return rr={postgresMd5PasswordHash:r,randomBytes:e.randomBytes,deriveKey:a,sha256:n,hashByName:s,hmacSha256:i,md5:t},rr}var nr,rn;function na(){if(rn)return nr;rn=1;const e=Tr;nr={postgresMd5PasswordHash:a,randomBytes:s,deriveKey:o,sha256:c,hashByName:f,hmacSha256:u,md5:i};const t=e.webcrypto||globalThis.crypto,r=t.subtle,n=new TextEncoder;function s(l){return t.getRandomValues(Buffer.alloc(l))}async function i(l){try{return e.createHash("md5").update(l,"utf-8").digest("hex")}catch{const h=typeof l=="string"?n.encode(l):l,m=await r.digest("MD5",h);return Array.from(new Uint8Array(m)).map(b=>b.toString(16).padStart(2,"0")).join("")}}async function a(l,d,h){const m=await i(d+l);return"md5"+await i(Buffer.concat([Buffer.from(m),h]))}async function c(l){return await r.digest("SHA-256",l)}async function f(l,d){return await r.digest(l,d)}async function u(l,d){const h=await r.importKey("raw",l,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await r.sign("HMAC",h,n.encode(d))}async function o(l,d,h){const m=await r.importKey("raw",n.encode(l),"PBKDF2",!1,["deriveBits"]),b={name:"PBKDF2",hash:"SHA-256",salt:d,iterations:h};return await r.deriveBits(b,m,256,["deriveBits"])}return nr}var nn;function ls(){return nn||(nn=1,parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15?Ct.exports=ra():Ct.exports=na()),Ct.exports}var sr,sn;function sa(){if(sn)return sr;sn=1;function e(i,a){return new Error("SASL channel binding: "+i+" when parsing public certificate "+a.toString("base64"))}function t(i,a){let c=i[a++];if(c<128)return{length:c,index:a};const f=c&127;if(f>4)throw e("bad length",i);c=0;for(let u=0;u<f;u++)c=c<<8|i[a++];return{length:c,index:a}}function r(i,a){if(i[a++]!==6)throw e("non-OID data",i);const{length:c,index:f}=t(i,a);a=f;const u=a+c,o=i[a++];let l=(o/40>>0)+"."+o%40;for(;a<u;){let d=0;for(;a<u;){const h=i[a++];if(d=d<<7|h&127,h<128)break}l+="."+d}return{oid:l,index:a}}function n(i,a){if(i[a++]!==48)throw e("non-sequence data",i);return t(i,a)}function s(i,a){a===void 0&&(a=0),a=n(i,a).index;const{length:c,index:f}=n(i,a);a=f+c,a=n(i,a).index;const{oid:u,index:o}=r(i,a);switch(u){case"1.2.840.113549.1.1.4":return"MD5";case"1.2.840.113549.1.1.5":return"SHA-1";case"1.2.840.113549.1.1.11":return"SHA-256";case"1.2.840.113549.1.1.12":return"SHA-384";case"1.2.840.113549.1.1.13":return"SHA-512";case"1.2.840.113549.1.1.14":return"SHA-224";case"1.2.840.113549.1.1.15":return"SHA512-224";case"1.2.840.113549.1.1.16":return"SHA512-256";case"1.2.840.10045.4.1":return"SHA-1";case"1.2.840.10045.4.3.1":return"SHA-224";case"1.2.840.10045.4.3.2":return"SHA-256";case"1.2.840.10045.4.3.3":return"SHA-384";case"1.2.840.10045.4.3.4":return"SHA-512";case"1.2.840.113549.1.1.10":{if(a=o,a=n(i,a).index,i[a++]!==160)throw e("non-tag data",i);a=t(i,a).index,a=n(i,a).index;const{oid:l}=r(i,a);switch(l){case"1.2.840.113549.2.5":return"MD5";case"1.3.14.3.2.26":return"SHA-1";case"2.16.840.1.101.3.4.2.1":return"SHA-256";case"2.16.840.1.101.3.4.2.2":return"SHA-384";case"2.16.840.1.101.3.4.2.3":return"SHA-512"}throw e("unknown hash OID "+l,i)}case"1.3.101.110":case"1.3.101.112":return"SHA-512";case"1.3.101.111":case"1.3.101.113":throw e("Ed448 certificate channel binding is not currently supported by Postgres")}throw e("unknown OID "+u,i)}return sr={signatureAlgorithmHashFromCertificate:s},sr}var ir,an;function ia(){if(an)return ir;an=1;const e=ls(),{signatureAlgorithmHashFromCertificate:t}=sa();function r(l,d){const h=["SCRAM-SHA-256"];d&&h.unshift("SCRAM-SHA-256-PLUS");const m=h.find(p=>l.includes(p));if(!m)throw new Error("SASL: Only mechanism(s) "+h.join(" and ")+" are supported");if(m==="SCRAM-SHA-256-PLUS"&&typeof d.getPeerCertificate!="function")throw new Error("SASL: Mechanism SCRAM-SHA-256-PLUS requires a certificate");const b=e.randomBytes(18).toString("base64");return{mechanism:m,clientNonce:b,response:(m==="SCRAM-SHA-256-PLUS"?"p=tls-server-end-point":d?"y":"n")+",,n=*,r="+b,message:"SASLInitialResponse"}}async function n(l,d,h,m){if(l.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof d!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(d==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof h!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");const b=f(h);if(b.nonce.startsWith(l.clientNonce)){if(b.nonce.length===l.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");const w="n=*,r="+l.clientNonce,p="r="+b.nonce+",s="+b.salt+",i="+b.iteration;let y=m?"eSws":"biws";if(l.mechanism==="SCRAM-SHA-256-PLUS"){const A=m.getPeerCertificate().raw;let D=t(A);(D==="MD5"||D==="SHA-1")&&(D="SHA-256");const q=await e.hashByName(D,A);y=Buffer.concat([Buffer.from("p=tls-server-end-point,,"),Buffer.from(q)]).toString("base64")}const _="c="+y+",r="+b.nonce,v=w+","+p+","+_,I=Buffer.from(b.salt,"base64"),T=await e.deriveKey(d,I,b.iteration),x=await e.hmacSha256(T,"Client Key"),S=await e.sha256(x),E=await e.hmacSha256(S,v),C=o(Buffer.from(x),Buffer.from(E)).toString("base64"),R=await e.hmacSha256(T,"Server Key"),P=await e.hmacSha256(R,v);l.message="SASLResponse",l.serverSignature=Buffer.from(P).toString("base64"),l.response=_+",p="+C}function s(l,d){if(l.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof d!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");const{serverSignature:h}=u(d);if(h!==l.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}function i(l){if(typeof l!="string")throw new TypeError("SASL: text must be a string");return l.split("").map((d,h)=>l.charCodeAt(h)).every(d=>d>=33&&d<=43||d>=45&&d<=126)}function a(l){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(l)}function c(l){if(typeof l!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(l.split(",").map(d=>{if(!/^.=/.test(d))throw new Error("SASL: Invalid attribute pair entry");const h=d[0],m=d.substring(2);return[h,m]}))}function f(l){const d=c(l),h=d.get("r");if(h){if(!i(h))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");const m=d.get("s");if(m){if(!a(m))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");const b=d.get("i");if(b){if(!/^[1-9][0-9]*$/.test(b))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");const w=parseInt(b,10);return{nonce:h,salt:m,iteration:w}}function u(l){const h=c(l).get("v");if(h){if(!a(h))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:h}}function o(l,d){if(!Buffer.isBuffer(l))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(d))throw new TypeError("second argument must be a Buffer");if(l.length!==d.length)throw new Error("Buffer lengths must match");if(l.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(l.map((h,m)=>l[m]^d[m]))}return ir={startSession:r,continueSession:n,finalizeSession:s},ir}var ar,on;function Or(){if(on)return ar;on=1;const e=qt();function t(r){this._types=r||e,this.text={},this.binary={}}return t.prototype.getOverrides=function(r){switch(r){case"text":return this.text;case"binary":return this.binary;default:return{}}},t.prototype.setTypeParser=function(r,n,s){typeof n=="function"&&(s=n,n="text"),this.getOverrides(n)[r]=s},t.prototype.getTypeParser=function(r,n){return n=n||"text",this.getOverrides(n)[r]||this._types.getTypeParser(r,n)},ar=t,ar}var or,cn;function aa(){if(cn)return or;cn=1;function e(i,a={}){if(i.charAt(0)==="/"){const h=i.split(" ");return{host:h[0],database:h[1]}}const c={};let f,u=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(i)&&(i=encodeURI(i).replace(/%25(\d\d)/g,"%$1"));try{try{f=new URL(i,"postgres://base")}catch{f=new URL(i.replace("@/","@___DUMMY___/"),"postgres://base"),u=!0}}catch(h){throw h.input&&(h.input="*****REDACTED*****"),h}for(const h of f.searchParams.entries())c[h[0]]=h[1];if(c.user=c.user||decodeURIComponent(f.username),c.password=c.password||decodeURIComponent(f.password),f.protocol=="socket:")return c.host=decodeURI(f.pathname),c.database=f.searchParams.get("db"),c.client_encoding=f.searchParams.get("encoding"),c;const o=u?"":f.hostname;c.host?o&&/^%2f/i.test(o)&&(f.pathname=o+f.pathname):c.host=decodeURIComponent(o),c.port||(c.port=f.port);const l=f.pathname.slice(1)||null;c.database=l?decodeURI(l):null,(c.ssl==="true"||c.ssl==="1")&&(c.ssl=!0),c.ssl==="0"&&(c.ssl=!1),(c.sslcert||c.sslkey||c.sslrootcert||c.sslmode)&&(c.ssl={});const d=c.sslcert||c.sslkey||c.sslrootcert?Wn:null;if(c.sslcert&&(c.ssl.cert=d.readFileSync(c.sslcert).toString()),c.sslkey&&(c.ssl.key=d.readFileSync(c.sslkey).toString()),c.sslrootcert&&(c.ssl.ca=d.readFileSync(c.sslrootcert).toString()),a.useLibpqCompat&&c.uselibpqcompat)throw new Error("Both useLibpqCompat and uselibpqcompat are set. Please use only one of them.");if(c.uselibpqcompat==="true"||a.useLibpqCompat)switch(c.sslmode){case"disable":{c.ssl=!1;break}case"prefer":{c.ssl.rejectUnauthorized=!1;break}case"require":{c.sslrootcert?c.ssl.checkServerIdentity=function(){}:c.ssl.rejectUnauthorized=!1;break}case"verify-ca":{if(!c.ssl.ca)throw new Error("SECURITY WARNING: Using sslmode=verify-ca requires specifying a CA with sslrootcert. If a public CA is used, verify-ca allows connections to a server that somebody else may have registered with the CA, making you vulnerable to Man-in-the-Middle attacks. Either specify a custom CA certificate with sslrootcert parameter or use sslmode=verify-full for proper security.");c.ssl.checkServerIdentity=function(){};break}}else switch(c.sslmode){case"disable":{c.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":{c.sslmode!=="verify-full"&&s(c.sslmode);break}case"no-verify":{c.ssl.rejectUnauthorized=!1;break}}return c}function t(i){return Object.entries(i).reduce((c,[f,u])=>(u!=null&&(c[f]=u),c),{})}function r(i){return Object.entries(i).reduce((c,[f,u])=>{if(f==="ssl"){const o=u;typeof o=="boolean"&&(c[f]=o),typeof o=="object"&&(c[f]=t(o))}else if(u!=null)if(f==="port"){if(u!==""){const o=parseInt(u,10);if(isNaN(o))throw new Error(`Invalid ${f}: ${u}`);c[f]=o}}else c[f]=u;return c},{})}function n(i){return r(e(i))}function s(i){!s.warned&&typeof process<"u"&&process.emitWarning&&(s.warned=!0,process.emitWarning(`SECURITY WARNING: The SSL modes 'prefer', 'require', and 'verify-ca' are treated as aliases for 'verify-full'.
In the next major version (pg-connection-string v3.0.0 and pg v9.0.0), these modes will adopt standard libpq semantics, which have weaker security guarantees.

To prepare for this change:
- If you want the current behavior, explicitly use 'sslmode=verify-full'
- If you want libpq compatibility now, use 'uselibpqcompat=true&sslmode=${i}'

See https://www.postgresql.org/docs/current/libpq-ssl.html for libpq SSL mode definitions.`))}return or=e,e.parse=e,e.toClientConfig=r,e.parseIntoClientConfig=n,or}var cr,un;function hs(){if(un)return cr;un=1;var e={};const t=Qs,r=kt(),n=aa().parse,s=function(u,o,l){return o[u]?o[u]:(l===void 0?l=e["PG"+u.toUpperCase()]:l===!1||(l=e[l]),l||r[u])},i=function(){switch(e.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return r.ssl},a=function(u){return"'"+(""+u).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},c=function(u,o,l){const d=o[l];d!=null&&u.push(l+"="+a(d))};class f{constructor(o){o=typeof o=="string"?n(o):o||{},o.connectionString&&(o=Object.assign({},o,n(o.connectionString))),this.user=s("user",o),this.database=s("database",o),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",o),10),this.host=s("host",o),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",o)}),this.binary=s("binary",o),this.options=s("options",o),this.ssl=typeof o.ssl>"u"?i():o.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",o),this.replication=s("replication",o),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",o,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",o,!1),this.statement_timeout=s("statement_timeout",o,!1),this.lock_timeout=s("lock_timeout",o,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",o,!1),this.query_timeout=s("query_timeout",o,!1),o.connectionTimeoutMillis===void 0?this.connect_timeout=e.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(o.connectionTimeoutMillis/1e3),o.keepAlive===!1?this.keepalives=0:o.keepAlive===!0&&(this.keepalives=1),typeof o.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(o.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(o){const l=[];c(l,this,"user"),c(l,this,"password"),c(l,this,"port"),c(l,this,"application_name"),c(l,this,"fallback_application_name"),c(l,this,"connect_timeout"),c(l,this,"options");const d=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(l,d,"sslmode"),c(l,d,"sslca"),c(l,d,"sslkey"),c(l,d,"sslcert"),c(l,d,"sslrootcert"),this.database&&l.push("dbname="+a(this.database)),this.replication&&l.push("replication="+a(this.replication)),this.host&&l.push("host="+a(this.host)),this.isDomainSocket)return o(null,l.join(" "));this.client_encoding&&l.push("client_encoding="+a(this.client_encoding)),t.lookup(this.host,function(h,m){return h?o(h,null):(l.push("hostaddr="+a(m)),o(null,l.join(" ")))})}}return cr=f,cr}var ur,fn;function ps(){if(fn)return ur;fn=1;const e=qt(),t=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/;class r{constructor(s,i){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=i,this.RowCtor=null,this.rowAsArray=s==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(s){let i;s.text?i=t.exec(s.text):i=t.exec(s.command),i&&(this.command=i[1],i[3]?(this.oid=parseInt(i[2],10),this.rowCount=parseInt(i[3],10)):i[2]&&(this.rowCount=parseInt(i[2],10)))}_parseRowAsArray(s){const i=new Array(s.length);for(let a=0,c=s.length;a<c;a++){const f=s[a];f!==null?i[a]=this._parsers[a](f):i[a]=null}return i}parseRow(s){const i={...this._prebuiltEmptyResultObject};for(let a=0,c=s.length;a<c;a++){const f=s[a],u=this.fields[a].name;if(f!==null){const o=this.fields[a].format==="binary"?Buffer.from(f):f;i[u]=this._parsers[a](o)}else i[u]=null}return i}addRow(s){this.rows.push(s)}addFields(s){this.fields=s,this.fields.length&&(this._parsers=new Array(s.length));const i={};for(let a=0;a<s.length;a++){const c=s[a];i[c.name]=null,this._types?this._parsers[a]=this._types.getTypeParser(c.dataTypeID,c.format||"text"):this._parsers[a]=e.getTypeParser(c.dataTypeID,c.format||"text")}this._prebuiltEmptyResultObject={...i}}}return ur=r,ur}var fr,dn;function oa(){if(dn)return fr;dn=1;const{EventEmitter:e}=et,t=ps(),r=lt();class n extends e{constructor(i,a,c){super(),i=r.normalizeQueryConfig(i,a,c),this.text=i.text,this.values=i.values,this.rows=i.rows,this.types=i.types,this.name=i.name,this.queryMode=i.queryMode,this.binary=i.binary,this.portal=i.portal||"",this.callback=i.callback,this._rowMode=i.rowMode,process.domain&&i.callback&&(this.callback=process.domain.bind(i.callback)),this._result=new t(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.queryMode==="extended"||this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new t(this._rowMode,this._result._types),this._results.push(this._result))}handleRowDescription(i){this._checkForMultirow(),this._result.addFields(i.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(i){let a;if(!this._canceledDueToError){try{a=this._result.parseRow(i.fields)}catch(c){this._canceledDueToError=c;return}this.emit("row",a,this._result),this._accumulateRows&&this._result.addRow(a)}}handleCommandComplete(i,a){this._checkForMultirow(),this._result.addCommandComplete(i),this.rows&&a.sync()}handleEmptyQuery(i){this.rows&&i.sync()}handleError(i,a){if(this._canceledDueToError&&(i=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(i);this.emit("error",i)}handleReadyForQuery(i){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,i);if(this.callback)try{this.callback(null,this._results)}catch(a){process.nextTick(()=>{throw a})}this.emit("end",this._results)}submit(i){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");const a=i.parsedStatements[this.name];if(this.text&&a&&this.text!==a)return new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);if(this.values&&!Array.isArray(this.values))return new Error("Query values must be an array");if(this.requiresPreparation()){i.stream.cork&&i.stream.cork();try{this.prepare(i)}finally{i.stream.uncork&&i.stream.uncork()}}else i.query(this.text);return null}hasBeenParsed(i){return this.name&&i.parsedStatements[this.name]}handlePortalSuspended(i){this._getRows(i,this.rows)}_getRows(i,a){i.execute({portal:this.portal,rows:a}),a?i.flush():i.sync()}prepare(i){this.hasBeenParsed(i)||i.parse({text:this.text,name:this.name,types:this.types});try{i.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:r.prepareValue})}catch(a){this.handleError(a,i);return}i.describe({type:"P",name:this.portal||""}),this._getRows(i,this.rows)}handleCopyInResponse(i){i.sendCopyFail("No source stream defined")}handleCopyData(i,a){}}return fr=n,fr}var dr={},N={},ln;function ms(){if(ln)return N;ln=1,Object.defineProperty(N,"__esModule",{value:!0}),N.NoticeMessage=N.DataRowMessage=N.CommandCompleteMessage=N.ReadyForQueryMessage=N.NotificationResponseMessage=N.BackendKeyDataMessage=N.AuthenticationMD5Password=N.ParameterStatusMessage=N.ParameterDescriptionMessage=N.RowDescriptionMessage=N.Field=N.CopyResponse=N.CopyDataMessage=N.DatabaseError=N.copyDone=N.emptyQuery=N.replicationStart=N.portalSuspended=N.noData=N.closeComplete=N.bindComplete=N.parseComplete=void 0,N.parseComplete={name:"parseComplete",length:5},N.bindComplete={name:"bindComplete",length:5},N.closeComplete={name:"closeComplete",length:5},N.noData={name:"noData",length:5},N.portalSuspended={name:"portalSuspended",length:5},N.replicationStart={name:"replicationStart",length:4},N.emptyQuery={name:"emptyQuery",length:4},N.copyDone={name:"copyDone",length:4};class e extends Error{constructor(b,w,p){super(b),this.length=w,this.name=p}}N.DatabaseError=e;class t{constructor(b,w){this.length=b,this.chunk=w,this.name="copyData"}}N.CopyDataMessage=t;class r{constructor(b,w,p,y){this.length=b,this.name=w,this.binary=p,this.columnTypes=new Array(y)}}N.CopyResponse=r;class n{constructor(b,w,p,y,_,v,I){this.name=b,this.tableID=w,this.columnID=p,this.dataTypeID=y,this.dataTypeSize=_,this.dataTypeModifier=v,this.format=I}}N.Field=n;class s{constructor(b,w){this.length=b,this.fieldCount=w,this.name="rowDescription",this.fields=new Array(this.fieldCount)}}N.RowDescriptionMessage=s;class i{constructor(b,w){this.length=b,this.parameterCount=w,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}}N.ParameterDescriptionMessage=i;class a{constructor(b,w,p){this.length=b,this.parameterName=w,this.parameterValue=p,this.name="parameterStatus"}}N.ParameterStatusMessage=a;class c{constructor(b,w){this.length=b,this.salt=w,this.name="authenticationMD5Password"}}N.AuthenticationMD5Password=c;class f{constructor(b,w,p){this.length=b,this.processID=w,this.secretKey=p,this.name="backendKeyData"}}N.BackendKeyDataMessage=f;class u{constructor(b,w,p,y){this.length=b,this.processId=w,this.channel=p,this.payload=y,this.name="notification"}}N.NotificationResponseMessage=u;class o{constructor(b,w){this.length=b,this.status=w,this.name="readyForQuery"}}N.ReadyForQueryMessage=o;class l{constructor(b,w){this.length=b,this.text=w,this.name="commandComplete"}}N.CommandCompleteMessage=l;class d{constructor(b,w){this.length=b,this.fields=w,this.name="dataRow",this.fieldCount=w.length}}N.DataRowMessage=d;class h{constructor(b,w){this.length=b,this.message=w,this.name="notice"}}return N.NoticeMessage=h,N}var it={},at={},hn;function ca(){if(hn)return at;hn=1,Object.defineProperty(at,"__esModule",{value:!0}),at.Writer=void 0;class e{constructor(r=256){this.size=r,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(r)}ensure(r){if(this.buffer.length-this.offset<r){const s=this.buffer,i=s.length+(s.length>>1)+r;this.buffer=Buffer.allocUnsafe(i),s.copy(this.buffer)}}addInt32(r){return this.ensure(4),this.buffer[this.offset++]=r>>>24&255,this.buffer[this.offset++]=r>>>16&255,this.buffer[this.offset++]=r>>>8&255,this.buffer[this.offset++]=r>>>0&255,this}addInt16(r){return this.ensure(2),this.buffer[this.offset++]=r>>>8&255,this.buffer[this.offset++]=r>>>0&255,this}addCString(r){if(!r)this.ensure(1);else{const n=Buffer.byteLength(r);this.ensure(n+1),this.buffer.write(r,this.offset,"utf-8"),this.offset+=n}return this.buffer[this.offset++]=0,this}addString(r=""){const n=Buffer.byteLength(r);return this.ensure(n),this.buffer.write(r,this.offset),this.offset+=n,this}add(r){return this.ensure(r.length),r.copy(this.buffer,this.offset),this.offset+=r.length,this}join(r){if(r){this.buffer[this.headerPosition]=r;const n=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(n,this.headerPosition+1)}return this.buffer.slice(r?0:5,this.offset)}flush(r){const n=this.join(r);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),n}}return at.Writer=e,at}var pn;function ua(){if(pn)return it;pn=1,Object.defineProperty(it,"__esModule",{value:!0}),it.serialize=void 0;const e=ca(),t=new e.Writer,r=A=>{t.addInt16(3).addInt16(0);for(const B of Object.keys(A))t.addCString(B).addCString(A[B]);t.addCString("client_encoding").addCString("UTF8");const D=t.addCString("").flush(),q=D.length+4;return new e.Writer().addInt32(q).add(D).flush()},n=()=>{const A=Buffer.allocUnsafe(8);return A.writeInt32BE(8,0),A.writeInt32BE(80877103,4),A},s=A=>t.addCString(A).flush(112),i=function(A,D){return t.addCString(A).addInt32(Buffer.byteLength(D)).addString(D),t.flush(112)},a=function(A){return t.addString(A).flush(112)},c=A=>t.addCString(A).flush(81),f=[],u=A=>{const D=A.name||"";D.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",D,D.length),console.error("This can cause conflicts and silent errors executing queries"));const q=A.types||f,B=q.length,Q=t.addCString(D).addCString(A.text).addInt16(B);for(let G=0;G<B;G++)Q.addInt32(q[G]);return t.flush(80)},o=new e.Writer,l=function(A,D){for(let q=0;q<A.length;q++){const B=D?D(A[q],q):A[q];B==null?(t.addInt16(0),o.addInt32(-1)):B instanceof Buffer?(t.addInt16(1),o.addInt32(B.length),o.add(B)):(t.addInt16(0),o.addInt32(Buffer.byteLength(B)),o.addString(B))}},d=(A={})=>{const D=A.portal||"",q=A.statement||"",B=A.binary||!1,Q=A.values||f,G=Q.length;return t.addCString(D).addCString(q),t.addInt16(G),l(Q,A.valueMapper),t.addInt16(G),t.add(o.flush()),t.addInt16(1),t.addInt16(B?1:0),t.flush(66)},h=Buffer.from([69,0,0,0,9,0,0,0,0,0]),m=A=>{if(!A||!A.portal&&!A.rows)return h;const D=A.portal||"",q=A.rows||0,B=Buffer.byteLength(D),Q=4+B+1+4,G=Buffer.allocUnsafe(1+Q);return G[0]=69,G.writeInt32BE(Q,1),G.write(D,5,"utf-8"),G[B+5]=0,G.writeUInt32BE(q,G.length-4),G},b=(A,D)=>{const q=Buffer.allocUnsafe(16);return q.writeInt32BE(16,0),q.writeInt16BE(1234,4),q.writeInt16BE(5678,6),q.writeInt32BE(A,8),q.writeInt32BE(D,12),q},w=(A,D)=>{const B=4+Buffer.byteLength(D)+1,Q=Buffer.allocUnsafe(1+B);return Q[0]=A,Q.writeInt32BE(B,1),Q.write(D,5,"utf-8"),Q[B]=0,Q},p=t.addCString("P").flush(68),y=t.addCString("S").flush(68),_=A=>A.name?w(68,`${A.type}${A.name||""}`):A.type==="P"?p:y,v=A=>{const D=`${A.type}${A.name||""}`;return w(67,D)},I=A=>t.add(A).flush(100),T=A=>w(102,A),x=A=>Buffer.from([A,0,0,0,4]),S=x(72),E=x(83),C=x(88),R=x(99),P={startup:r,password:s,requestSsl:n,sendSASLInitialResponseMessage:i,sendSCRAMClientFinalMessage:a,query:c,parse:u,bind:d,execute:m,describe:_,close:v,flush:()=>S,sync:()=>E,end:()=>C,copyData:I,copyDone:()=>R,copyFail:T,cancel:b};return it.serialize=P,it}var ot={},ct={},mn;function fa(){if(mn)return ct;mn=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.BufferReader=void 0;class e{constructor(r=0){this.offset=r,this.buffer=Buffer.allocUnsafe(0),this.encoding="utf-8"}setBuffer(r,n){this.offset=r,this.buffer=n}int16(){const r=this.buffer.readInt16BE(this.offset);return this.offset+=2,r}byte(){const r=this.buffer[this.offset];return this.offset++,r}int32(){const r=this.buffer.readInt32BE(this.offset);return this.offset+=4,r}uint32(){const r=this.buffer.readUInt32BE(this.offset);return this.offset+=4,r}string(r){const n=this.buffer.toString(this.encoding,this.offset,this.offset+r);return this.offset+=r,n}cstring(){const r=this.offset;let n=r;for(;this.buffer[n++]!==0;);return this.offset=n,this.buffer.toString(this.encoding,r,n-1)}bytes(r){const n=this.buffer.slice(this.offset,this.offset+r);return this.offset+=r,n}}return ct.BufferReader=e,ct}var xn;function da(){if(xn)return ot;xn=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.Parser=void 0;const e=ms(),t=fa(),r=1,s=r+4,i=-1,a=Buffer.allocUnsafe(0);class c{constructor(S){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new t.BufferReader,(S==null?void 0:S.mode)==="binary")throw new Error("Binary mode not supported yet");this.mode=(S==null?void 0:S.mode)||"text"}parse(S,E){this.mergeBuffer(S);const C=this.bufferOffset+this.bufferLength;let R=this.bufferOffset;for(;R+s<=C;){const P=this.buffer[R],A=this.buffer.readUInt32BE(R+r),D=r+A;if(D+R<=C){const q=this.handlePacket(R+s,P,A,this.buffer);E(q),R+=D}else break}R===C?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=C-R,this.bufferOffset=R)}mergeBuffer(S){if(this.bufferLength>0){const E=this.bufferLength+S.byteLength;if(E+this.bufferOffset>this.buffer.byteLength){let R;if(E<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)R=this.buffer;else{let P=this.buffer.byteLength*2;for(;E>=P;)P*=2;R=Buffer.allocUnsafe(P)}this.buffer.copy(R,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=R,this.bufferOffset=0}S.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=E}else this.buffer=S,this.bufferOffset=0,this.bufferLength=S.byteLength}handlePacket(S,E,C,R){const{reader:P}=this;P.setBuffer(S,R);let A;switch(E){case 50:A=e.bindComplete;break;case 49:A=e.parseComplete;break;case 51:A=e.closeComplete;break;case 110:A=e.noData;break;case 115:A=e.portalSuspended;break;case 99:A=e.copyDone;break;case 87:A=e.replicationStart;break;case 73:A=e.emptyQuery;break;case 68:A=y(P);break;case 67:A=u(P);break;case 90:A=f(P);break;case 65:A=m(P);break;case 82:A=I(P,C);break;case 83:A=_(P);break;case 75:A=v(P);break;case 69:A=T(P,"error");break;case 78:A=T(P,"notice");break;case 84:A=b(P);break;case 116:A=p(P);break;case 71:A=l(P);break;case 72:A=d(P);break;case 100:A=o(P,C);break;default:return new e.DatabaseError("received invalid response: "+E.toString(16),C,"error")}return P.setBuffer(0,a),A.length=C,A}}ot.Parser=c;const f=x=>{const S=x.string(1);return new e.ReadyForQueryMessage(i,S)},u=x=>{const S=x.cstring();return new e.CommandCompleteMessage(i,S)},o=(x,S)=>{const E=x.bytes(S-4);return new e.CopyDataMessage(i,E)},l=x=>h(x,"copyInResponse"),d=x=>h(x,"copyOutResponse"),h=(x,S)=>{const E=x.byte()!==0,C=x.int16(),R=new e.CopyResponse(i,S,E,C);for(let P=0;P<C;P++)R.columnTypes[P]=x.int16();return R},m=x=>{const S=x.int32(),E=x.cstring(),C=x.cstring();return new e.NotificationResponseMessage(i,S,E,C)},b=x=>{const S=x.int16(),E=new e.RowDescriptionMessage(i,S);for(let C=0;C<S;C++)E.fields[C]=w(x);return E},w=x=>{const S=x.cstring(),E=x.uint32(),C=x.int16(),R=x.uint32(),P=x.int16(),A=x.int32(),D=x.int16()===0?"text":"binary";return new e.Field(S,E,C,R,P,A,D)},p=x=>{const S=x.int16(),E=new e.ParameterDescriptionMessage(i,S);for(let C=0;C<S;C++)E.dataTypeIDs[C]=x.int32();return E},y=x=>{const S=x.int16(),E=new Array(S);for(let C=0;C<S;C++){const R=x.int32();E[C]=R===-1?null:x.string(R)}return new e.DataRowMessage(i,E)},_=x=>{const S=x.cstring(),E=x.cstring();return new e.ParameterStatusMessage(i,S,E)},v=x=>{const S=x.int32(),E=x.int32();return new e.BackendKeyDataMessage(i,S,E)},I=(x,S)=>{const E=x.int32(),C={name:"authenticationOk",length:S};switch(E){case 0:break;case 3:C.length===8&&(C.name="authenticationCleartextPassword");break;case 5:if(C.length===12){C.name="authenticationMD5Password";const R=x.bytes(4);return new e.AuthenticationMD5Password(i,R)}break;case 10:{C.name="authenticationSASL",C.mechanisms=[];let R;do R=x.cstring(),R&&C.mechanisms.push(R);while(R)}break;case 11:C.name="authenticationSASLContinue",C.data=x.string(S-8);break;case 12:C.name="authenticationSASLFinal",C.data=x.string(S-8);break;default:throw new Error("Unknown authenticationOk message type "+E)}return C},T=(x,S)=>{const E={};let C=x.string(1);for(;C!=="\0";)E[C]=x.cstring(),C=x.string(1);const R=E.M,P=S==="notice"?new e.NoticeMessage(i,R):new e.DatabaseError(R,i,S);return P.severity=E.S,P.code=E.C,P.detail=E.D,P.hint=E.H,P.position=E.P,P.internalPosition=E.p,P.internalQuery=E.q,P.where=E.W,P.schema=E.s,P.table=E.t,P.column=E.c,P.dataType=E.d,P.constraint=E.n,P.file=E.F,P.line=E.L,P.routine=E.R,P};return ot}var yn;function xs(){return yn||(yn=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DatabaseError=e.serialize=e.parse=void 0;const t=ms();Object.defineProperty(e,"DatabaseError",{enumerable:!0,get:function(){return t.DatabaseError}});const r=ua();Object.defineProperty(e,"serialize",{enumerable:!0,get:function(){return r.serialize}});const n=da();function s(i,a){const c=new n.Parser;return i.on("data",f=>c.parse(f,a)),new Promise(f=>i.on("end",()=>f()))}e.parse=s})(dr)),dr}var Rt={},bn;function la(){return bn||(bn=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.default={}),Rt}var lr,gn;function ha(){if(gn)return lr;gn=1;const{getStream:e,getSecureStream:t}=i();lr={getStream:e,getSecureStream:t};function r(){function a(f){const u=Kn;return new u.Socket}function c(f){return Ws.connect(f)}return{getStream:a,getSecureStream:c}}function n(){function a(f){const{CloudflareSocket:u}=la();return new u(f)}function c(f){return f.socket.startTls(f),f.socket}return{getStream:a,getSecureStream:c}}function s(){if(typeof navigator=="object"&&navigator!==null&&typeof navigator.userAgent=="string")return navigator.userAgent==="Cloudflare-Workers";if(typeof Response=="function"){const a=new Response(null,{cf:{thing:!0}});if(typeof a.cf=="object"&&a.cf!==null&&a.cf.thing)return!0}return!1}function i(){return s()?n():r()}return lr}var hr,wn;function ys(){if(wn)return hr;wn=1;const e=et.EventEmitter,{parse:t,serialize:r}=xs(),{getStream:n,getSecureStream:s}=ha(),i=r.flush(),a=r.sync(),c=r.end();class f extends e{constructor(o){super(),o=o||{},this.stream=o.stream||n(o.ssl),typeof this.stream=="function"&&(this.stream=this.stream(o)),this._keepAlive=o.keepAlive,this._keepAliveInitialDelayMillis=o.keepAliveInitialDelayMillis,this.parsedStatements={},this.ssl=o.ssl||!1,this._ending=!1,this._emitMessage=!1;const l=this;this.on("newListener",function(d){d==="message"&&(l._emitMessage=!0)})}connect(o,l){const d=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(o,l),this.stream.once("connect",function(){d._keepAlive&&d.stream.setKeepAlive(!0,d._keepAliveInitialDelayMillis),d.emit("connect")});const h=function(m){d._ending&&(m.code==="ECONNRESET"||m.code==="EPIPE")||d.emit("error",m)};if(this.stream.on("error",h),this.stream.on("close",function(){d.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(m){switch(m.toString("utf8")){case"S":break;case"N":return d.stream.end(),d.emit("error",new Error("The server does not support SSL connections"));default:return d.stream.end(),d.emit("error",new Error("There was an error establishing an SSL connection"))}const w={socket:d.stream};d.ssl!==!0&&(Object.assign(w,d.ssl),"key"in d.ssl&&(w.key=d.ssl.key));const p=Kn;p.isIP&&p.isIP(l)===0&&(w.servername=l);try{d.stream=s(w)}catch(y){return d.emit("error",y)}d.attachListeners(d.stream),d.stream.on("error",h),d.emit("sslconnect")})}attachListeners(o){t(o,l=>{const d=l.name==="error"?"errorMessage":l.name;this._emitMessage&&this.emit("message",l),this.emit(d,l)})}requestSsl(){this.stream.write(r.requestSsl())}startup(o){this.stream.write(r.startup(o))}cancel(o,l){this._send(r.cancel(o,l))}password(o){this._send(r.password(o))}sendSASLInitialResponseMessage(o,l){this._send(r.sendSASLInitialResponseMessage(o,l))}sendSCRAMClientFinalMessage(o){this._send(r.sendSCRAMClientFinalMessage(o))}_send(o){return this.stream.writable?this.stream.write(o):!1}query(o){this._send(r.query(o))}parse(o){this._send(r.parse(o))}bind(o){this._send(r.bind(o))}execute(o){this._send(r.execute(o))}flush(){this.stream.writable&&this.stream.write(i)}sync(){this._ending=!0,this._send(a)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(o){this._send(r.close(o))}describe(o){this._send(r.describe(o))}sendCopyFromChunk(o){this._send(r.copyData(o))}endCopyFrom(){this._send(r.copyDone())}sendCopyFail(o){this._send(r.copyFail(o))}}return hr=f,hr}var Tt={exports:{}},pr={exports:{}},mr,_n;function pa(){if(_n)return mr;_n=1;const{Transform:e}=Jn,{StringDecoder:t}=Js,r=Symbol("last"),n=Symbol("decoder");function s(u,o,l){let d;if(this.overflow){if(d=this[n].write(u).split(this.matcher),d.length===1)return l();d.shift(),this.overflow=!1}else this[r]+=this[n].write(u),d=this[r].split(this.matcher);this[r]=d.pop();for(let h=0;h<d.length;h++)try{a(this,this.mapper(d[h]))}catch(m){return l(m)}if(this.overflow=this[r].length>this.maxLength,this.overflow&&!this.skipOverflow){l(new Error("maximum buffer reached"));return}l()}function i(u){if(this[r]+=this[n].end(),this[r])try{a(this,this.mapper(this[r]))}catch(o){return u(o)}u()}function a(u,o){o!==void 0&&u.push(o)}function c(u){return u}function f(u,o,l){switch(u=u||/\r?\n/,o=o||c,l=l||{},arguments.length){case 1:typeof u=="function"?(o=u,u=/\r?\n/):typeof u=="object"&&!(u instanceof RegExp)&&!u[Symbol.split]&&(l=u,u=/\r?\n/);break;case 2:typeof u=="function"?(l=o,o=u,u=/\r?\n/):typeof o=="object"&&(l=o,o=c)}l=Object.assign({},l),l.autoDestroy=!0,l.transform=s,l.flush=i,l.readableObjectMode=!0;const d=new e(l);return d[r]="",d[n]=new t("utf8"),d.matcher=u,d.mapper=o,d.maxLength=l.maxLength,d.skipOverflow=l.skipOverflow||!1,d.overflow=!1,d._destroy=function(h,m){this._writableState.errorEmitted=!1,m(h)},d}return mr=f,mr}var En;function ma(){return En||(En=1,(function(e){var t={},r=Ks,n=Jn.Stream,s=pa(),i=Ze,a=5432,c=process.platform==="win32",f=process.stderr,u=56,o=7,l=61440,d=32768;function h(I){return(I&l)==d}var m=["host","port","database","user","password"],b=m.length,w=m[b-1];function p(){var I=f instanceof n&&f.writable===!0;if(I){var T=Array.prototype.slice.call(arguments).concat(`
`);f.write(i.format.apply(i,T))}}Object.defineProperty(e.exports,"isWin",{get:function(){return c},set:function(I){c=I}}),e.exports.warnTo=function(I){var T=f;return f=I,T},e.exports.getFileName=function(I){var T=I||t,x=T.PGPASSFILE||(c?r.join(T.APPDATA||"./","postgresql","pgpass.conf"):r.join(T.HOME||"./",".pgpass"));return x},e.exports.usePgPass=function(I,T){return Object.prototype.hasOwnProperty.call(t,"PGPASSWORD")?!1:c?!0:(T=T||"<unkn>",h(I.mode)?I.mode&(u|o)?(p('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',T),!1):!0:(p('WARNING: password file "%s" is not a plain file',T),!1))};var y=e.exports.match=function(I,T){return m.slice(0,-1).reduce(function(x,S,E){return E==1&&Number(I[S]||a)===Number(T[S])?x&&!0:x&&(T[S]==="*"||T[S]===I[S])},!0)};e.exports.getPassword=function(I,T,x){var S,E=T.pipe(s());function C(A){var D=_(A);D&&v(D)&&y(I,D)&&(S=D[w],E.end())}var R=function(){T.destroy(),x(S)},P=function(A){T.destroy(),p("WARNING: error on reading file: %s",A),x(void 0)};T.on("error",P),E.on("data",C).on("end",R).on("error",P)};var _=e.exports.parseLine=function(I){if(I.length<11||I.match(/^\s+#/))return null;for(var T="",x="",S=0,E=0,C={},R=!1,P=function(D,q,B){var Q=I.substring(q,B);Object.hasOwnProperty.call(t,"PGPASS_NO_DEESCAPE")||(Q=Q.replace(/\\([:\\])/g,"$1")),C[m[D]]=Q},A=0;A<I.length-1;A+=1){if(T=I.charAt(A+1),x=I.charAt(A),R=S==b-1,R){P(S,E);break}A>=0&&T==":"&&x!=="\\"&&(P(S,E,A+1),E=A+2,S+=1)}return C=Object.keys(C).length===b?C:null,C},v=e.exports.isValidEntry=function(I){for(var T={0:function(R){return R.length>0},1:function(R){return R==="*"?!0:(R=Number(R),isFinite(R)&&R>0&&R<9007199254740992&&Math.floor(R)===R)},2:function(R){return R.length>0},3:function(R){return R.length>0},4:function(R){return R.length>0}},x=0;x<m.length;x+=1){var S=T[x],E=I[m[x]]||"",C=S(E);if(!C)return!1}return!0}})(pr)),pr.exports}var vn;function xa(){if(vn)return Tt.exports;vn=1;var e=Wn,t=ma();return Tt.exports=function(r,n){var s=t.getFileName();e.stat(s,function(i,a){if(i||!t.usePgPass(a,s))return n(void 0);var c=e.createReadStream(s);t.getPassword(r,c,n)})},Tt.exports.warnTo=t.warnTo,Tt.exports}var xr,Sn;function ya(){if(Sn)return xr;Sn=1;const e=et.EventEmitter,t=lt(),r=Ze,n=ia(),s=Or(),i=hs(),a=oa(),c=kt(),f=ys(),u=ls(),o=r.deprecate(()=>{},"Client.activeQuery is deprecated and will be removed in pg@9.0"),l=r.deprecate(()=>{},"Client.queryQueue is deprecated and will be removed in pg@9.0."),d=r.deprecate(()=>{},"pgpass support is deprecated and will be removed in pg@9.0. You can provide an async function as the password property to the Client/Pool constructor that returns a password instead. Within this function you can call the pgpass module in your own code."),h=r.deprecate(()=>{},"Passing a custom Promise implementation to the Client/Pool constructor is deprecated and will be removed in pg@9.0."),m=r.deprecate(()=>{},"Calling client.query() when the client is already executing a query is deprecated and will be removed in pg@9.0. Use asycn/await or an external async flow control mechanism instead.");class b extends e{constructor(p){super(),this.connectionParameters=new i(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;const y=p||{};y.Promise&&h(),this._Promise=y.Promise||Pr.Promise,this._types=new s(y.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this._activeQuery=null,this.enableChannelBinding=!!y.enableChannelBinding,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this._queryQueue=[],this.binary=y.binary||c.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}get activeQuery(){return o(),this._activeQuery}set activeQuery(p){o(),this._activeQuery=p}_getActiveQuery(){return this._activeQuery}_errorAllQueries(p){const y=v=>{process.nextTick(()=>{v.handleError(p,this.connection)})},_=this._getActiveQuery();_&&(y(_),this._activeQuery=null),this._queryQueue.forEach(y),this._queryQueue.length=0}_connect(p){const y=this,_=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){const v=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{p(v)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{_._ending=!0,_.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?_.connect(this.host+"/.s.PGSQL."+this.port):_.connect(this.port,this.host),_.on("connect",function(){y.ssl?_.requestSsl():_.startup(y.getStartupConf())}),_.on("sslconnect",function(){_.startup(y.getStartupConf())}),this._attachListeners(_),_.once("end",()=>{const v=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(v),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(v):this._handleErrorEvent(v):this._connectionError||this._handleErrorEvent(v)),process.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,_)=>{this._connect(v=>{v?_(v):y(this)})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_getPassword(p){const y=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password(this.connectionParameters)).then(_=>{if(_!==void 0){if(typeof _!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=_}else this.connectionParameters.password=this.password=null;p()}).catch(_=>{y.emit("error",_)});else if(this.password!==null)p();else try{xa()(this.connectionParameters,v=>{v!==void 0&&(d(),this.connectionParameters.password=this.password=v),p()})}catch(_){this.emit("error",_)}}_handleAuthCleartextPassword(p){this._getPassword(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._getPassword(async()=>{try{const y=await u.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)}catch(y){this.emit("error",y)}})}_handleAuthSASL(p){this._getPassword(()=>{try{this.saslSession=n.startSession(p.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(y){this.connection.emit("error",y)}})}async _handleAuthSASLContinue(p){try{await n.continueSession(this.saslSession,this.password,p.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(y){this.connection.emit("error",y)}}_handleAuthSASLFinal(p){try{n.finalizeSession(this.saslSession,p.data),this.saslSession=null}catch(y){this.connection.emit("error",y)}}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));const y=this._getActiveQuery();this._activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);const y=this._getActiveQuery();if(!y){this._handleErrorEvent(p);return}this._activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){const y=this._getActiveQuery();if(y==null){const _=new Error("Received unexpected rowDescription message from backend.");this._handleErrorEvent(_);return}y.handleRowDescription(p)}_handleDataRow(p){const y=this._getActiveQuery();if(y==null){const _=new Error("Received unexpected dataRow message from backend.");this._handleErrorEvent(_);return}y.handleDataRow(p)}_handlePortalSuspended(p){const y=this._getActiveQuery();if(y==null){const _=new Error("Received unexpected portalSuspended message from backend.");this._handleErrorEvent(_);return}y.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){const y=this._getActiveQuery();if(y==null){const _=new Error("Received unexpected emptyQuery message from backend.");this._handleErrorEvent(_);return}y.handleEmptyQuery(this.connection)}_handleCommandComplete(p){const y=this._getActiveQuery();if(y==null){const _=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(_);return}y.handleCommandComplete(p,this.connection)}_handleParseComplete(){const p=this._getActiveQuery();if(p==null){const y=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(y);return}p.name&&(this.connection.parsedStatements[p.name]=p.text)}_handleCopyInResponse(p){const y=this._getActiveQuery();if(y==null){const _=new Error("Received unexpected copyInResponse message from backend.");this._handleErrorEvent(_);return}y.handleCopyInResponse(this.connection)}_handleCopyData(p){const y=this._getActiveQuery();if(y==null){const _=new Error("Received unexpected copyData message from backend.");this._handleErrorEvent(_);return}y.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){const p=this.connectionParameters,y={user:p.user,database:p.database},_=p.application_name||p.fallback_application_name;return _&&(y.application_name=_),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){const _=this.connection;this.host&&this.host.indexOf("/")===0?_.connect(this.host+"/.s.PGSQL."+this.port):_.connect(this.port,this.host),_.on("connect",function(){_.cancel(p.processID,p.secretKey)})}else p._queryQueue.indexOf(y)!==-1&&p._queryQueue.splice(p._queryQueue.indexOf(y),1)}setTypeParser(p,y,_){return this._types.setTypeParser(p,y,_)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return t.escapeIdentifier(p)}escapeLiteral(p){return t.escapeLiteral(p)}_pulseQueryQueue(){if(this.readyForQuery===!0){this._activeQuery=this._queryQueue.shift();const p=this._getActiveQuery();if(p){this.readyForQuery=!1,this.hasExecuted=!0;const y=p.submit(this.connection);y&&process.nextTick(()=>{p.handleError(y,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this._activeQuery=null,this.emit("drain"))}}query(p,y,_){let v,I,T,x,S;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(T=p.query_timeout||this.connectionParameters.query_timeout,I=v=p,v.callback||(typeof y=="function"?v.callback=y:_&&(v.callback=_))):(T=p.query_timeout||this.connectionParameters.query_timeout,v=new a(p,y,_),v.callback||(I=new this._Promise((E,C)=>{v.callback=(R,P)=>R?C(R):E(P)}).catch(E=>{throw Error.captureStackTrace(E),E}))),T&&(S=v.callback||(()=>{}),x=setTimeout(()=>{const E=new Error("Query read timeout");process.nextTick(()=>{v.handleError(E,this.connection)}),S(E),v.callback=()=>{};const C=this._queryQueue.indexOf(v);C>-1&&this._queryQueue.splice(C,1),this._pulseQueryQueue()},T),v.callback=(E,C)=>{clearTimeout(x),S(E,C)}),this.binary&&!v.binary&&(v.binary=!0),v._result&&!v._result._types&&(v._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"),this.connection)}),I):(this._queryQueue.length>0&&m(),this._queryQueue.push(v),this._pulseQueryQueue(),I):(process.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),I)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting||this._ended)if(p)p();else return this._Promise.resolve();if(this._getActiveQuery()||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}get queryQueue(){return l(),this._queryQueue}}return b.Query=a,xr=b,xr}var yr,An;function ba(){if(An)return yr;An=1;const e=et.EventEmitter,t=function(){},r=(u,o)=>{const l=u.findIndex(o);return l===-1?void 0:u.splice(l,1)[0]};class n{constructor(o,l,d){this.client=o,this.idleListener=l,this.timeoutId=d}}class s{constructor(o){this.callback=o}}function i(){throw new Error("Release called on client which has already been released to the pool.")}function a(u,o){if(o)return{callback:o,result:void 0};let l,d;const h=function(b,w){b?l(b):d(w)},m=new u(function(b,w){d=b,l=w}).catch(b=>{throw Error.captureStackTrace(b),b});return{callback:h,result:m}}function c(u,o){return function l(d){d.client=o,o.removeListener("error",l),o.on("error",()=>{u.log("additional client error after disconnection due to error",d)}),u._remove(o),u.emit("error",d,o)}}class f extends e{constructor(o,l){super(),this.options=Object.assign({},o),o!=null&&"password"in o&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:o.password}),o!=null&&o.ssl&&o.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||l||bs().Client,this.Promise=this.options.Promise||Pr.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(l=>{this._remove(l.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;const o=this._pendingQueue.shift();if(this._idle.length){const l=this._idle.pop();clearTimeout(l.timeoutId);const d=l.client;d.ref&&d.ref();const h=l.idleListener;return this._acquireClient(d,o,h,!1)}if(!this._isFull())return this.newClient(o);throw new Error("unexpected condition")}_remove(o,l){const d=r(this._idle,m=>m.client===o);d!==void 0&&clearTimeout(d.timeoutId),this._clients=this._clients.filter(m=>m!==o);const h=this;o.end(()=>{h.emit("remove",o),typeof l=="function"&&l()})}connect(o){if(this.ending){const h=new Error("Cannot use a pool after calling end on the pool");return o?o(h):this.Promise.reject(h)}const l=a(this.Promise,o),d=l.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new s(l.callback)),d;const h=(w,p,y)=>{clearTimeout(b),l.callback(w,p,y)},m=new s(h),b=setTimeout(()=>{r(this._pendingQueue,w=>w.callback===h),m.timedOut=!0,l.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return b.unref&&b.unref(),this._pendingQueue.push(m),d}return this.newClient(new s(l.callback)),d}newClient(o){const l=new this.Client(this.options);this._clients.push(l);const d=c(this,l);this.log("checking client timeout");let h,m=!1;this.options.connectionTimeoutMillis&&(h=setTimeout(()=>{l.connection?(this.log("ending client due to timeout"),m=!0,l.connection.stream.destroy()):l.isConnected()||(this.log("ending client due to timeout"),m=!0,l.end())},this.options.connectionTimeoutMillis)),this.log("connecting new client"),l.connect(b=>{if(h&&clearTimeout(h),l.on("error",d),b)this.log("client failed to connect",b),this._clients=this._clients.filter(w=>w!==l),m&&(b=new Error("Connection terminated due to connection timeout",{cause:b})),this._pulseQueue(),o.timedOut||o.callback(b,void 0,t);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){const w=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(l),this._idle.findIndex(y=>y.client===l)!==-1&&this._acquireClient(l,new s((y,_,v)=>v()),d,!1)},this.options.maxLifetimeSeconds*1e3);w.unref(),l.once("end",()=>clearTimeout(w))}return this._acquireClient(l,o,d,!0)}})}_acquireClient(o,l,d,h){h&&this.emit("connect",o),this.emit("acquire",o),o.release=this._releaseOnce(o,d),o.removeListener("error",d),l.timedOut?h&&this.options.verify?this.options.verify(o,o.release):o.release():h&&this.options.verify?this.options.verify(o,m=>{if(m)return o.release(m),l.callback(m,void 0,t);l.callback(void 0,o,o.release)}):l.callback(void 0,o,o.release)}_releaseOnce(o,l){let d=!1;return h=>{d&&i(),d=!0,this._release(o,l,h)}}_release(o,l,d){if(o.on("error",l),o._poolUseCount=(o._poolUseCount||0)+1,this.emit("release",d,o),d||this.ending||!o._queryable||o._ending||o._poolUseCount>=this.options.maxUses)return o._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(o,this._pulseQueue.bind(this));if(this._expired.has(o))return this.log("remove expired client"),this._expired.delete(o),this._remove(o,this._pulseQueue.bind(this));let m;this.options.idleTimeoutMillis&&this._isAboveMin()&&(m=setTimeout(()=>{this._isAboveMin()&&(this.log("remove idle client"),this._remove(o,this._pulseQueue.bind(this)))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&m.unref()),this.options.allowExitOnIdle&&o.unref(),this._idle.push(new n(o,l,m)),this._pulseQueue()}query(o,l,d){if(typeof o=="function"){const m=a(this.Promise,o);return setImmediate(function(){return m.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),m.result}typeof l=="function"&&(d=l,l=void 0);const h=a(this.Promise,d);return d=h.callback,this.connect((m,b)=>{if(m)return d(m);let w=!1;const p=y=>{w||(w=!0,b.release(y),d(y))};b.once("error",p),this.log("dispatching query");try{b.query(o,l,(y,_)=>{if(this.log("query dispatched"),b.removeListener("error",p),!w)return w=!0,b.release(y),y?d(y):d(void 0,_)})}catch(y){return b.release(y),d(y)}}),h.result}end(o){if(this.log("ending"),this.ending){const d=new Error("Called end on pool more than once");return o?o(d):this.Promise.reject(d)}this.ending=!0;const l=a(this.Promise,o);return this._endCallback=l.callback,this._pulseQueue(),l.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((o,l)=>o+(this._expired.has(l)?1:0),0)}get totalCount(){return this._clients.length}}return yr=f,yr}var br={exports:{}};const ga={},wa=Object.freeze(Object.defineProperty({__proto__:null,default:ga},Symbol.toStringTag,{value:"Module"})),_a=Ji(wa);var gr={exports:{}},Cn;function Ea(){if(Cn)return gr.exports;Cn=1;const e=et.EventEmitter,t=Ze,r=lt(),n=gr.exports=function(i,a,c){e.call(this),i=r.normalizeQueryConfig(i,a,c),this.text=i.text,this.values=i.values,this.name=i.name,this.queryMode=i.queryMode,this.callback=i.callback,this.state="new",this._arrayMode=i.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",(function(f){f==="row"&&(this._emitRowEvents=!0)}).bind(this))};t.inherits(n,e);const s={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};return n.prototype.handleError=function(i){const a=this.native.pq.resultErrorFields();if(a)for(const c in a){const f=s[c]||c;i[f]=a[c]}this.callback?this.callback(i):this.emit("error",i),this.state="error"},n.prototype.then=function(i,a){return this._getPromise().then(i,a)},n.prototype.catch=function(i){return this._getPromise().catch(i)},n.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise((function(i,a){this._once("end",i),this._once("error",a)}).bind(this)),this._promise)},n.prototype.submit=function(i){this.state="running";const a=this;this.native=i.native,i.native.arrayMode=this._arrayMode;let c=function(f,u,o){if(i.native.arrayMode=!1,setImmediate(function(){a.emit("_done")}),f)return a.handleError(f);a._emitRowEvents&&(o.length>1?u.forEach((l,d)=>{l.forEach(h=>{a.emit("row",h,o[d])})}):u.forEach(function(l){a.emit("row",l,o)})),a.state="end",a.emit("end",o),a.callback&&a.callback(null,o)};if(process.domain&&(c=process.domain.bind(c)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));const f=(this.values||[]).map(r.prepareValue);if(i.namedQueries[this.name]){if(this.text&&i.namedQueries[this.name]!==this.text){const u=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return c(u)}return i.native.execute(this.name,f,c)}return i.native.prepare(this.name,this.text,f.length,function(u){return u?c(u):(i.namedQueries[a.name]=a.text,a.native.execute(a.name,f,c))})}else if(this.values){if(!Array.isArray(this.values)){const u=new Error("Query values must be an array");return c(u)}const f=this.values.map(r.prepareValue);i.native.query(this.text,f,c)}else this.queryMode==="extended"?i.native.query(this.text,[],c):i.native.query(this.text,c)},gr.exports}var Rn;function va(){if(Rn)return br.exports;Rn=1;const e=Ze;var t;try{t=_a}catch(u){throw u}const r=Or(),n=et.EventEmitter,s=Ze,i=hs(),a=Ea(),c=e.deprecate(()=>{},"Calling client.query() when the client is already executing a query is deprecated and will be removed in pg@9.0. Use asycn/await or an external async flow control mechanism instead."),f=br.exports=function(u){n.call(this),u=u||{},this._Promise=u.Promise||Pr.Promise,this._types=new r(u.types),this.native=new t({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;const o=this.connectionParameters=new i(u);u.nativeConnectionString&&(o.nativeConnectionString=u.nativeConnectionString),this.user=o.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:o.password}),this.database=o.database,this.host=o.host,this.port=o.port,this.namedQueries={}};return f.Query=a,s.inherits(f,n),f.prototype._errorAllQueries=function(u){const o=l=>{process.nextTick(()=>{l.native=this.native,l.handleError(u)})};this._hasActiveQuery()&&(o(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(o),this._queryQueue.length=0},f.prototype._connect=function(u){const o=this;if(this._connecting){process.nextTick(()=>u(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(l,d){if(o.connectionParameters.nativeConnectionString&&(d=o.connectionParameters.nativeConnectionString),l)return u(l);o.native.connect(d,function(h){if(h)return o.native.end(),u(h);o._connected=!0,o.native.on("error",function(m){o._queryable=!1,o._errorAllQueries(m),o.emit("error",m)}),o.native.on("notification",function(m){o.emit("notification",{channel:m.relname,payload:m.extra})}),o.emit("connect"),o._pulseQueryQueue(!0),u(null,this)})})},f.prototype.connect=function(u){if(u){this._connect(u);return}return new this._Promise((o,l)=>{this._connect(d=>{d?l(d):o(this)})})},f.prototype.query=function(u,o,l){let d,h,m,b,w;if(u==null)throw new TypeError("Client was passed a null or undefined query");if(typeof u.submit=="function")m=u.query_timeout||this.connectionParameters.query_timeout,h=d=u,typeof o=="function"&&(u.callback=o);else if(m=u.query_timeout||this.connectionParameters.query_timeout,d=new a(u,o,l),!d.callback){let p,y;h=new this._Promise((_,v)=>{p=_,y=v}).catch(_=>{throw Error.captureStackTrace(_),_}),d.callback=(_,v)=>_?y(_):p(v)}return m&&(w=d.callback||(()=>{}),b=setTimeout(()=>{const p=new Error("Query read timeout");process.nextTick(()=>{d.handleError(p,this.connection)}),w(p),d.callback=()=>{};const y=this._queryQueue.indexOf(d);y>-1&&this._queryQueue.splice(y,1),this._pulseQueryQueue()},m),d.callback=(p,y)=>{clearTimeout(b),w(p,y)}),this._queryable?this._ending?(d.native=this.native,process.nextTick(()=>{d.handleError(new Error("Client was closed and is not queryable"))}),h):(this._queryQueue.length>0&&c(),this._queryQueue.push(d),this._pulseQueryQueue(),h):(d.native=this.native,process.nextTick(()=>{d.handleError(new Error("Client has encountered a connection error and is not queryable"))}),h)},f.prototype.end=function(u){const o=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,u));let l;return u||(l=new this._Promise(function(d,h){u=m=>m?h(m):d()})),this.native.end(function(){o._connected=!1,o._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{o.emit("end"),u&&u()})}),l},f.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},f.prototype._pulseQueryQueue=function(u){if(!this._connected||this._hasActiveQuery())return;const o=this._queryQueue.shift();if(!o){u||this.emit("drain");return}this._activeQuery=o,o.submit(this);const l=this;o.once("_done",function(){l._pulseQueryQueue()})},f.prototype.cancel=function(u){this._activeQuery===u?this.native.cancel(function(){}):this._queryQueue.indexOf(u)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(u),1)},f.prototype.ref=function(){},f.prototype.unref=function(){},f.prototype.setTypeParser=function(u,o,l){return this._types.setTypeParser(u,o,l)},f.prototype.getTypeParser=function(u,o){return this._types.getTypeParser(u,o)},f.prototype.isConnected=function(){return this._connected},br.exports}var wr,Tn;function In(){return Tn||(Tn=1,wr=va()),wr}var Pn;function bs(){return Pn||(Pn=1,(function(e){var t={};const r=ya(),n=kt(),s=ys(),i=ps(),a=lt(),c=ba(),f=Or(),{DatabaseError:u}=xs(),{escapeIdentifier:o,escapeLiteral:l}=lt(),d=w=>class extends c{constructor(y){super(y,w)}},h=function(w){this.defaults=n,this.Client=w,this.Query=this.Client.Query,this.Pool=d(this.Client),this._pools=[],this.Connection=s,this.types=qt(),this.DatabaseError=u,this.TypeOverrides=f,this.escapeIdentifier=o,this.escapeLiteral=l,this.Result=i,this.utils=a};let m=r,b=!1;try{b=!!t.NODE_PG_FORCE_NATIVE}catch{}b&&(m=In()),e.exports=new h(m),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){let w=null;try{w=new h(In())}catch(p){if(p.code!=="MODULE_NOT_FOUND")throw p}return Object.defineProperty(e.exports,"native",{value:w}),w}})})(Ut)),Ut.exports}var Sa=bs();const X=Ki(Sa);X.Client;X.Pool;X.Connection;X.types;X.Query;X.DatabaseError;X.escapeIdentifier;X.escapeLiteral;X.Result;X.TypeOverrides;X.defaults;var Aa={};const{Pool:Ca}=X;let _r=null;const Ra="postgresql://neondb_owner:npg_dmGzNnsx6tf0@ep-divine-mouse-acs7dan0-pooler.sa-east-1.aws.neon.tech/neondb?sslmode=require";function Ta(){if(!_r){const e=Aa.DATABASE_URL||Ra;_r=new Ca({connectionString:e,ssl:{rejectUnauthorized:!1},max:10,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3})}return _r}async function L(e,t=[]){try{return(await Ta().query(e,t)).rows}catch(r){throw console.error("Database query error:",r),r}}function Ia(e){try{return crypto.getRandomValues(new Uint8Array(e))}catch{}try{return Tr.randomBytes(e)}catch{}throw Error("Neither WebCryptoAPI nor a crypto module is available. Use bcrypt.setRandomFallback to set an alternative")}function Pa(e,t){if(e=e||_s,typeof e!="number")throw Error("Illegal arguments: "+typeof e+", "+typeof t);e<4?e=4:e>31&&(e=31);var r=[];return r.push("$2b$"),e<10&&r.push("0"),r.push(e.toString()),r.push("$"),r.push(Ar(Ia(ht),ht)),r.join("")}function gs(e,t,r){if(typeof t=="function"&&(r=t,t=void 0),typeof e=="function"&&(r=e,e=void 0),typeof e>"u")e=_s;else if(typeof e!="number")throw Error("illegal arguments: "+typeof e);function n(s){se(function(){try{s(null,Pa(e))}catch(i){s(i)}})}if(r){if(typeof r!="function")throw Error("Illegal callback: "+typeof r);n(r)}else return new Promise(function(s,i){n(function(a,c){if(a){i(a);return}s(c)})})}function ws(e,t,r,n){function s(i){typeof e=="string"&&typeof t=="number"?gs(t,function(a,c){$n(e,c,i,n)}):typeof e=="string"&&typeof t=="string"?$n(e,t,i,n):se(i.bind(this,Error("Illegal arguments: "+typeof e+", "+typeof t)))}if(r){if(typeof r!="function")throw Error("Illegal callback: "+typeof r);s(r)}else return new Promise(function(i,a){s(function(c,f){if(c){a(c);return}i(f)})})}function Oa(e,t){for(var r=e.length^t.length,n=0;n<e.length;++n)r|=e.charCodeAt(n)^t.charCodeAt(n);return r===0}function Ma(e,t,r,n){function s(i){if(typeof e!="string"||typeof t!="string"){se(i.bind(this,Error("Illegal arguments: "+typeof e+", "+typeof t)));return}if(t.length!==60){se(i.bind(this,null,!1));return}ws(e,t.substring(0,29),function(a,c){a?i(a):i(null,Oa(c,t))},n)}if(r){if(typeof r!="function")throw Error("Illegal callback: "+typeof r);s(r)}else return new Promise(function(i,a){s(function(c,f){if(c){a(c);return}i(f)})})}var se=typeof setImmediate=="function"?setImmediate:typeof scheduler=="object"&&typeof scheduler.postTask=="function"?scheduler.postTask.bind(scheduler):setTimeout;function Da(e){for(var t=0,r=0,n=0;n<e.length;++n)r=e.charCodeAt(n),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function Na(e){for(var t=0,r,n,s=new Array(Da(e)),i=0,a=e.length;i<a;++i)r=e.charCodeAt(i),r<128?s[t++]=r:r<2048?(s[t++]=r>>6|192,s[t++]=r&63|128):(r&64512)===55296&&((n=e.charCodeAt(i+1))&64512)===56320?(r=65536+((r&1023)<<10)+(n&1023),++i,s[t++]=r>>18|240,s[t++]=r>>12&63|128,s[t++]=r>>6&63|128,s[t++]=r&63|128):(s[t++]=r>>12|224,s[t++]=r>>6&63|128,s[t++]=r&63|128);return s}var $e="./ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),le=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,54,55,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,-1,-1,-1,-1,-1,-1,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,-1,-1,-1,-1,-1];function Ar(e,t){var r=0,n=[],s,i;if(t<=0||t>e.length)throw Error("Illegal len: "+t);for(;r<t;){if(s=e[r++]&255,n.push($e[s>>2&63]),s=(s&3)<<4,r>=t){n.push($e[s&63]);break}if(i=e[r++]&255,s|=i>>4&15,n.push($e[s&63]),s=(i&15)<<2,r>=t){n.push($e[s&63]);break}i=e[r++]&255,s|=i>>6&3,n.push($e[s&63]),n.push($e[i&63])}return n.join("")}function $a(e,t){for(var r=0,n=e.length,s=0,i=[],a,c,f,u,o,l;r<n-1&&s<t&&(l=e.charCodeAt(r++),a=l<le.length?le[l]:-1,l=e.charCodeAt(r++),c=l<le.length?le[l]:-1,!(a==-1||c==-1||(o=a<<2>>>0,o|=(c&48)>>4,i.push(String.fromCharCode(o)),++s>=t||r>=n)||(l=e.charCodeAt(r++),f=l<le.length?le[l]:-1,f==-1)||(o=(c&15)<<4>>>0,o|=(f&60)>>2,i.push(String.fromCharCode(o)),++s>=t||r>=n)));)l=e.charCodeAt(r++),u=l<le.length?le[l]:-1,o=(f&3)<<6>>>0,o|=u,i.push(String.fromCharCode(o)),++s;var d=[];for(r=0;r<s;r++)d.push(i[r].charCodeAt(0));return d}var ht=16,_s=10,La=16,qa=100,On=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],Mn=[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946,1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055,3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504,976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462],Es=[1332899944,1700884034,1701343084,1684370003,1668446532,1869963892];function pt(e,t,r,n){var s,i=e[t],a=e[t+1];return i^=r[0],s=n[i>>>24],s+=n[256|i>>16&255],s^=n[512|i>>8&255],s+=n[768|i&255],a^=s^r[1],s=n[a>>>24],s+=n[256|a>>16&255],s^=n[512|a>>8&255],s+=n[768|a&255],i^=s^r[2],s=n[i>>>24],s+=n[256|i>>16&255],s^=n[512|i>>8&255],s+=n[768|i&255],a^=s^r[3],s=n[a>>>24],s+=n[256|a>>16&255],s^=n[512|a>>8&255],s+=n[768|a&255],i^=s^r[4],s=n[i>>>24],s+=n[256|i>>16&255],s^=n[512|i>>8&255],s+=n[768|i&255],a^=s^r[5],s=n[a>>>24],s+=n[256|a>>16&255],s^=n[512|a>>8&255],s+=n[768|a&255],i^=s^r[6],s=n[i>>>24],s+=n[256|i>>16&255],s^=n[512|i>>8&255],s+=n[768|i&255],a^=s^r[7],s=n[a>>>24],s+=n[256|a>>16&255],s^=n[512|a>>8&255],s+=n[768|a&255],i^=s^r[8],s=n[i>>>24],s+=n[256|i>>16&255],s^=n[512|i>>8&255],s+=n[768|i&255],a^=s^r[9],s=n[a>>>24],s+=n[256|a>>16&255],s^=n[512|a>>8&255],s+=n[768|a&255],i^=s^r[10],s=n[i>>>24],s+=n[256|i>>16&255],s^=n[512|i>>8&255],s+=n[768|i&255],a^=s^r[11],s=n[a>>>24],s+=n[256|a>>16&255],s^=n[512|a>>8&255],s+=n[768|a&255],i^=s^r[12],s=n[i>>>24],s+=n[256|i>>16&255],s^=n[512|i>>8&255],s+=n[768|i&255],a^=s^r[13],s=n[a>>>24],s+=n[256|a>>16&255],s^=n[512|a>>8&255],s+=n[768|a&255],i^=s^r[14],s=n[i>>>24],s+=n[256|i>>16&255],s^=n[512|i>>8&255],s+=n[768|i&255],a^=s^r[15],s=n[a>>>24],s+=n[256|a>>16&255],s^=n[512|a>>8&255],s+=n[768|a&255],i^=s^r[16],e[t]=a^r[La+1],e[t+1]=i,e}function He(e,t){for(var r=0,n=0;r<4;++r)n=n<<8|e[t]&255,t=(t+1)%e.length;return{key:n,offp:t}}function Dn(e,t,r){for(var n=0,s=[0,0],i=t.length,a=r.length,c,f=0;f<i;f++)c=He(e,n),n=c.offp,t[f]=t[f]^c.key;for(f=0;f<i;f+=2)s=pt(s,0,t,r),t[f]=s[0],t[f+1]=s[1];for(f=0;f<a;f+=2)s=pt(s,0,t,r),r[f]=s[0],r[f+1]=s[1]}function ka(e,t,r,n){for(var s=0,i=[0,0],a=r.length,c=n.length,f,u=0;u<a;u++)f=He(t,s),s=f.offp,r[u]=r[u]^f.key;for(s=0,u=0;u<a;u+=2)f=He(e,s),s=f.offp,i[0]^=f.key,f=He(e,s),s=f.offp,i[1]^=f.key,i=pt(i,0,r,n),r[u]=i[0],r[u+1]=i[1];for(u=0;u<c;u+=2)f=He(e,s),s=f.offp,i[0]^=f.key,f=He(e,s),s=f.offp,i[1]^=f.key,i=pt(i,0,r,n),n[u]=i[0],n[u+1]=i[1]}function Nn(e,t,r,n,s){var i=Es.slice(),a=i.length,c;if(r<4||r>31)if(c=Error("Illegal number of rounds (4-31): "+r),n){se(n.bind(this,c));return}else throw c;if(t.length!==ht)if(c=Error("Illegal salt length: "+t.length+" != "+ht),n){se(n.bind(this,c));return}else throw c;r=1<<r>>>0;var f,u,o=0,l;typeof Int32Array=="function"?(f=new Int32Array(On),u=new Int32Array(Mn)):(f=On.slice(),u=Mn.slice()),ka(t,e,f,u);function d(){if(s&&s(o/r),o<r)for(var m=Date.now();o<r&&(o=o+1,Dn(e,f,u),Dn(t,f,u),!(Date.now()-m>qa)););else{for(o=0;o<64;o++)for(l=0;l<a>>1;l++)pt(i,l<<1,f,u);var b=[];for(o=0;o<a;o++)b.push((i[o]>>24&255)>>>0),b.push((i[o]>>16&255)>>>0),b.push((i[o]>>8&255)>>>0),b.push((i[o]&255)>>>0);if(n){n(null,b);return}else return b}n&&se(d)}if(typeof n<"u")d();else for(var h;;)if(typeof(h=d())<"u")return h||[]}function $n(e,t,r,n){var s;if(typeof e!="string"||typeof t!="string")if(s=Error("Invalid string / salt: Not a string"),r){se(r.bind(this,s));return}else throw s;var i,a;if(t.charAt(0)!=="$"||t.charAt(1)!=="2")if(s=Error("Invalid salt version: "+t.substring(0,2)),r){se(r.bind(this,s));return}else throw s;if(t.charAt(2)==="$")i="\0",a=3;else{if(i=t.charAt(2),i!=="a"&&i!=="b"&&i!=="y"||t.charAt(3)!=="$")if(s=Error("Invalid salt revision: "+t.substring(2,4)),r){se(r.bind(this,s));return}else throw s;a=4}if(t.charAt(a+2)>"$")if(s=Error("Missing salt rounds"),r){se(r.bind(this,s));return}else throw s;var c=parseInt(t.substring(a,a+1),10)*10,f=parseInt(t.substring(a+1,a+2),10),u=c+f,o=t.substring(a+3,a+25);e+=i>="a"?"\0":"";var l=Na(e),d=$a(o,ht);function h(m){var b=[];return b.push("$2"),i>="a"&&b.push(i),b.push("$"),u<10&&b.push("0"),b.push(u.toString()),b.push("$"),b.push(Ar(d,d.length)),b.push(Ar(m,Es.length*4-1)),b.join("")}if(typeof r>"u")return h(Nn(l,d,u));Nn(l,d,u,function(m,b){m?r(m,null):r(null,h(b))},n)}const Nt=new TextEncoder,mt=new TextDecoder;function vs(...e){const t=e.reduce((s,{length:i})=>s+i,0),r=new Uint8Array(t);let n=0;for(const s of e)r.set(s,n),n+=s.length;return r}function Fe(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++){const n=e.charCodeAt(r);if(n>127)throw new TypeError("non-ASCII string encountered in encode()");t[r]=n}return t}function Ba(e){if(Uint8Array.prototype.toBase64)return e.toBase64();const t=32768,r=[];for(let n=0;n<e.length;n+=t)r.push(String.fromCharCode.apply(null,e.subarray(n,n+t)));return btoa(r.join(""))}function Ha(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(e);const t=atob(e),r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r}function Mt(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(typeof e=="string"?e:mt.decode(e),{alphabet:"base64url"});let t=e;t instanceof Uint8Array&&(t=mt.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/");try{return Ha(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}}function Er(e){let t=e;return typeof t=="string"&&(t=Nt.encode(t)),Uint8Array.prototype.toBase64?t.toBase64({alphabet:"base64url",omitPadding:!0}):Ba(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}class Me extends Error{constructor(r,n){var s;super(r,n);O(this,"code","ERR_JOSE_GENERIC");this.name=this.constructor.name,(s=Error.captureStackTrace)==null||s.call(Error,this,this.constructor)}}O(Me,"code","ERR_JOSE_GENERIC");class ee extends Me{constructor(r,n,s="unspecified",i="unspecified"){super(r,{cause:{claim:s,reason:i,payload:n}});O(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");O(this,"claim");O(this,"reason");O(this,"payload");this.claim=s,this.reason=i,this.payload=n}}O(ee,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class Cr extends Me{constructor(r,n,s="unspecified",i="unspecified"){super(r,{cause:{claim:s,reason:i,payload:n}});O(this,"code","ERR_JWT_EXPIRED");O(this,"claim");O(this,"reason");O(this,"payload");this.claim=s,this.reason=i,this.payload=n}}O(Cr,"code","ERR_JWT_EXPIRED");class pe extends Me{constructor(){super(...arguments);O(this,"code","ERR_JOSE_NOT_SUPPORTED")}}O(pe,"code","ERR_JOSE_NOT_SUPPORTED");class H extends Me{constructor(){super(...arguments);O(this,"code","ERR_JWS_INVALID")}}O(H,"code","ERR_JWS_INVALID");class Bt extends Me{constructor(){super(...arguments);O(this,"code","ERR_JWT_INVALID")}}O(Bt,"code","ERR_JWT_INVALID");class Ss extends Me{constructor(r="signature verification failed",n){super(r,n);O(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}O(Ss,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");const ie=(e,t="algorithm.name")=>new TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`),Le=(e,t)=>e.name===t;function vr(e){return parseInt(e.name.slice(4),10)}function ja(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Fa(e,t){if(t&&!e.usages.includes(t))throw new TypeError(`CryptoKey does not support this operation, its usages must include ${t}.`)}function Ua(e,t,r){switch(t){case"HS256":case"HS384":case"HS512":{if(!Le(e.algorithm,"HMAC"))throw ie("HMAC");const n=parseInt(t.slice(2),10);if(vr(e.algorithm.hash)!==n)throw ie(`SHA-${n}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Le(e.algorithm,"RSASSA-PKCS1-v1_5"))throw ie("RSASSA-PKCS1-v1_5");const n=parseInt(t.slice(2),10);if(vr(e.algorithm.hash)!==n)throw ie(`SHA-${n}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Le(e.algorithm,"RSA-PSS"))throw ie("RSA-PSS");const n=parseInt(t.slice(2),10);if(vr(e.algorithm.hash)!==n)throw ie(`SHA-${n}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":{if(!Le(e.algorithm,"Ed25519"))throw ie("Ed25519");break}case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":{if(!Le(e.algorithm,t))throw ie(t);break}case"ES256":case"ES384":case"ES512":{if(!Le(e.algorithm,"ECDSA"))throw ie("ECDSA");const n=ja(t);if(e.algorithm.namedCurve!==n)throw ie(n,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Fa(e,r)}function As(e,t,...r){var n;if(r=r.filter(Boolean),r.length>2){const s=r.pop();e+=`one of type ${r.join(", ")}, or ${s}.`}else r.length===2?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return t==null?e+=` Received ${t}`:typeof t=="function"&&t.name?e+=` Received function ${t.name}`:typeof t=="object"&&t!=null&&(n=t.constructor)!=null&&n.name&&(e+=` Received an instance of ${t.constructor.name}`),e}const Qa=(e,...t)=>As("Key must be ",e,...t),Cs=(e,t,...r)=>As(`Key for the ${e} algorithm must be `,t,...r),Rs=e=>{if((e==null?void 0:e[Symbol.toStringTag])==="CryptoKey")return!0;try{return e instanceof CryptoKey}catch{return!1}},Ts=e=>(e==null?void 0:e[Symbol.toStringTag])==="KeyObject",Is=e=>Rs(e)||Ts(e);function Ps(...e){const t=e.filter(Boolean);if(t.length===0||t.length===1)return!0;let r;for(const n of t){const s=Object.keys(n);if(!r||r.size===0){r=new Set(s);continue}for(const i of s){if(r.has(i))return!1;r.add(i)}}return!0}const Wa=e=>typeof e=="object"&&e!==null;function xt(e){if(!Wa(e)||Object.prototype.toString.call(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Os(e,t){if(e.startsWith("RS")||e.startsWith("PS")){const{modulusLength:r}=t.algorithm;if(typeof r!="number"||r<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}}function Ka(e){let t,r;switch(e.kty){case"AKP":{switch(e.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":t={name:e.alg},r=e.priv?["sign"]:["verify"];break;default:throw new pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"RSA":{switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(e.alg){case"Ed25519":case"EdDSA":t={name:"Ed25519"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new pe('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}async function Ja(e){if(!e.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:t,keyUsages:r}=Ka(e),n={...e};return n.kty!=="AKP"&&delete n.alg,delete n.use,crypto.subtle.importKey("jwk",n,t,e.ext??!(e.d||e.priv),e.key_ops??r)}function Ms(e,t,r,n,s){if(s.crit!==void 0&&(n==null?void 0:n.crit)===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||n.crit===void 0)return new Set;if(!Array.isArray(n.crit)||n.crit.length===0||n.crit.some(a=>typeof a!="string"||a.length===0))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;r!==void 0?i=new Map([...Object.entries(r),...t.entries()]):i=t;for(const a of n.crit){if(!i.has(a))throw new pe(`Extension Header Parameter "${a}" is not recognized`);if(s[a]===void 0)throw new e(`Extension Header Parameter "${a}" is missing`);if(i.get(a)&&n[a]===void 0)throw new e(`Extension Header Parameter "${a}" MUST be integrity protected`)}return new Set(n.crit)}const Mr=e=>xt(e)&&typeof e.kty=="string",Ga=e=>e.kty!=="oct"&&(e.kty==="AKP"&&typeof e.priv=="string"||typeof e.d=="string"),Va=e=>e.kty!=="oct"&&e.d===void 0&&e.priv===void 0,za=e=>e.kty==="oct"&&typeof e.k=="string";let Ue;const Ln=async(e,t,r,n=!1)=>{Ue||(Ue=new WeakMap);let s=Ue.get(e);if(s!=null&&s[r])return s[r];const i=await Ja({...t,alg:r});return n&&Object.freeze(e),s?s[r]=i:Ue.set(e,{[r]:i}),i},Ya=(e,t)=>{var a;Ue||(Ue=new WeakMap);let r=Ue.get(e);if(r!=null&&r[t])return r[t];const n=e.type==="public",s=!!n;let i;if(e.asymmetricKeyType==="x25519"){switch(t){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}i=e.toCryptoKey(e.asymmetricKeyType,s,n?[]:["deriveBits"])}if(e.asymmetricKeyType==="ed25519"){if(t!=="EdDSA"&&t!=="Ed25519")throw new TypeError("given KeyObject instance cannot be used for this algorithm");i=e.toCryptoKey(e.asymmetricKeyType,s,[n?"verify":"sign"])}switch(e.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":{if(t!==e.asymmetricKeyType.toUpperCase())throw new TypeError("given KeyObject instance cannot be used for this algorithm");i=e.toCryptoKey(e.asymmetricKeyType,s,[n?"verify":"sign"])}}if(e.asymmetricKeyType==="rsa"){let c;switch(t){case"RSA-OAEP":c="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":c="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":c="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":c="SHA-512";break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}if(t.startsWith("RSA-OAEP"))return e.toCryptoKey({name:"RSA-OAEP",hash:c},s,n?["encrypt"]:["decrypt"]);i=e.toCryptoKey({name:t.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:c},s,[n?"verify":"sign"])}if(e.asymmetricKeyType==="ec"){const f=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get((a=e.asymmetricKeyDetails)==null?void 0:a.namedCurve);if(!f)throw new TypeError("given KeyObject instance cannot be used for this algorithm");t==="ES256"&&f==="P-256"&&(i=e.toCryptoKey({name:"ECDSA",namedCurve:f},s,[n?"verify":"sign"])),t==="ES384"&&f==="P-384"&&(i=e.toCryptoKey({name:"ECDSA",namedCurve:f},s,[n?"verify":"sign"])),t==="ES512"&&f==="P-521"&&(i=e.toCryptoKey({name:"ECDSA",namedCurve:f},s,[n?"verify":"sign"])),t.startsWith("ECDH-ES")&&(i=e.toCryptoKey({name:"ECDH",namedCurve:f},s,n?[]:["deriveBits"]))}if(!i)throw new TypeError("given KeyObject instance cannot be used for this algorithm");return r?r[t]=i:Ue.set(e,{[t]:i}),i};async function Ds(e,t){if(e instanceof Uint8Array||Rs(e))return e;if(Ts(e)){if(e.type==="secret")return e.export();if("toCryptoKey"in e&&typeof e.toCryptoKey=="function")try{return Ya(e,t)}catch(n){if(n instanceof TypeError)throw n}let r=e.export({format:"jwk"});return Ln(e,r,t)}if(Mr(e))return e.k?Mt(e.k):Ln(e,e,t,!0);throw new Error("unreachable")}const je=e=>e==null?void 0:e[Symbol.toStringTag],Rr=(e,t,r)=>{var n,s;if(t.use!==void 0){let i;switch(r){case"sign":case"verify":i="sig";break;case"encrypt":case"decrypt":i="enc";break}if(t.use!==i)throw new TypeError(`Invalid key for this operation, its "use" must be "${i}" when present`)}if(t.alg!==void 0&&t.alg!==e)throw new TypeError(`Invalid key for this operation, its "alg" must be "${e}" when present`);if(Array.isArray(t.key_ops)){let i;switch(!0){case(r==="sign"||r==="verify"):case e==="dir":case e.includes("CBC-HS"):i=r;break;case e.startsWith("PBES2"):i="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(e):!e.includes("GCM")&&e.endsWith("KW")?i=r==="encrypt"?"wrapKey":"unwrapKey":i=r;break;case(r==="encrypt"&&e.startsWith("RSA")):i="wrapKey";break;case r==="decrypt":i=e.startsWith("RSA")?"unwrapKey":"deriveBits";break}if(i&&((s=(n=t.key_ops)==null?void 0:n.includes)==null?void 0:s.call(n,i))===!1)throw new TypeError(`Invalid key for this operation, its "key_ops" must include "${i}" when present`)}return!0},Xa=(e,t,r)=>{if(!(t instanceof Uint8Array)){if(Mr(t)){if(za(t)&&Rr(e,t,r))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Is(t))throw new TypeError(Cs(e,t,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if(t.type!=="secret")throw new TypeError(`${je(t)} instances for symmetric algorithms must be of type "secret"`)}},Za=(e,t,r)=>{if(Mr(t))switch(r){case"decrypt":case"sign":if(Ga(t)&&Rr(e,t,r))return;throw new TypeError("JSON Web Key for this operation must be a private JWK");case"encrypt":case"verify":if(Va(t)&&Rr(e,t,r))return;throw new TypeError("JSON Web Key for this operation must be a public JWK")}if(!Is(t))throw new TypeError(Cs(e,t,"CryptoKey","KeyObject","JSON Web Key"));if(t.type==="secret")throw new TypeError(`${je(t)} instances for asymmetric algorithms must not be of type "secret"`);if(t.type==="public")switch(r){case"sign":throw new TypeError(`${je(t)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw new TypeError(`${je(t)} instances for asymmetric algorithm decryption must be of type "private"`)}if(t.type==="private")switch(r){case"verify":throw new TypeError(`${je(t)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw new TypeError(`${je(t)} instances for asymmetric algorithm encryption must be of type "public"`)}};function Ns(e,t,r){switch(e.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":Xa(e,t,r);break;default:Za(e,t,r)}}function $s(e,t){const r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:parseInt(e.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:e};default:throw new pe(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}async function Ls(e,t,r){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(Qa(t,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}return Ua(t,e,r),t}async function eo(e,t,r,n){const s=await Ls(e,t,"verify");Os(e,s);const i=$s(e,s.algorithm);try{return await crypto.subtle.verify(i,s,r,n)}catch{return!1}}async function to(e,t,r){if(!xt(e))throw new H("Flattened JWS must be an object");if(e.protected===void 0&&e.header===void 0)throw new H('Flattened JWS must have either of the "protected" or "header" members');if(e.protected!==void 0&&typeof e.protected!="string")throw new H("JWS Protected Header incorrect type");if(e.payload===void 0)throw new H("JWS Payload missing");if(typeof e.signature!="string")throw new H("JWS Signature missing or incorrect type");if(e.header!==void 0&&!xt(e.header))throw new H("JWS Unprotected Header incorrect type");let n={};if(e.protected)try{const b=Mt(e.protected);n=JSON.parse(mt.decode(b))}catch{throw new H("JWS Protected Header is invalid")}if(!Ps(n,e.header))throw new H("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const s={...n,...e.header},i=Ms(H,new Map([["b64",!0]]),r==null?void 0:r.crit,n,s);let a=!0;if(i.has("b64")&&(a=n.b64,typeof a!="boolean"))throw new H('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:c}=s;if(typeof c!="string"||!c)throw new H('JWS "alg" (Algorithm) Header Parameter missing or invalid');if(a){if(typeof e.payload!="string")throw new H("JWS Payload must be a string")}else if(typeof e.payload!="string"&&!(e.payload instanceof Uint8Array))throw new H("JWS Payload must be a string or an Uint8Array instance");let f=!1;typeof t=="function"&&(t=await t(n,e),f=!0),Ns(c,t,"verify");const u=vs(e.protected!==void 0?Fe(e.protected):new Uint8Array,Fe("."),typeof e.payload=="string"?a?Fe(e.payload):Nt.encode(e.payload):e.payload);let o;try{o=Mt(e.signature)}catch{throw new H("Failed to base64url decode the signature")}const l=await Ds(t,c);if(!await eo(c,l,o,u))throw new Ss;let h;if(a)try{h=Mt(e.payload)}catch{throw new H("Failed to base64url decode the payload")}else typeof e.payload=="string"?h=Nt.encode(e.payload):h=e.payload;const m={payload:h};return e.protected!==void 0&&(m.protectedHeader=n),e.header!==void 0&&(m.unprotectedHeader=e.header),f?{...m,key:l}:m}async function ro(e,t,r){if(e instanceof Uint8Array&&(e=mt.decode(e)),typeof e!="string")throw new H("Compact JWS must be a string or Uint8Array");const{0:n,1:s,2:i,length:a}=e.split(".");if(a!==3)throw new H("Invalid Compact JWS");const c=await to({payload:s,protected:n,signature:i},t,r),f={payload:c.payload,protectedHeader:c.protectedHeader};return typeof t=="function"?{...f,key:c.key}:f}const he=e=>Math.floor(e.getTime()/1e3),qs=60,ks=qs*60,Dr=ks*24,no=Dr*7,so=Dr*365.25,io=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function dt(e){const t=io.exec(e);if(!t||t[4]&&t[1])throw new TypeError("Invalid time period format");const r=parseFloat(t[2]),n=t[3].toLowerCase();let s;switch(n){case"sec":case"secs":case"second":case"seconds":case"s":s=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":s=Math.round(r*qs);break;case"hour":case"hours":case"hr":case"hrs":case"h":s=Math.round(r*ks);break;case"day":case"days":case"d":s=Math.round(r*Dr);break;case"week":case"weeks":case"w":s=Math.round(r*no);break;default:s=Math.round(r*so);break}return t[1]==="-"||t[4]==="ago"?-s:s}function ve(e,t){if(!Number.isFinite(t))throw new TypeError(`Invalid ${e} input`);return t}const qn=e=>e.includes("/")?e.toLowerCase():`application/${e.toLowerCase()}`,ao=(e,t)=>typeof e=="string"?t.includes(e):Array.isArray(e)?t.some(Set.prototype.has.bind(new Set(e))):!1;function oo(e,t,r={}){let n;try{n=JSON.parse(mt.decode(t))}catch{}if(!xt(n))throw new Bt("JWT Claims Set must be a top-level JSON object");const{typ:s}=r;if(s&&(typeof e.typ!="string"||qn(e.typ)!==qn(s)))throw new ee('unexpected "typ" JWT header value',n,"typ","check_failed");const{requiredClaims:i=[],issuer:a,subject:c,audience:f,maxTokenAge:u}=r,o=[...i];u!==void 0&&o.push("iat"),f!==void 0&&o.push("aud"),c!==void 0&&o.push("sub"),a!==void 0&&o.push("iss");for(const m of new Set(o.reverse()))if(!(m in n))throw new ee(`missing required "${m}" claim`,n,m,"missing");if(a&&!(Array.isArray(a)?a:[a]).includes(n.iss))throw new ee('unexpected "iss" claim value',n,"iss","check_failed");if(c&&n.sub!==c)throw new ee('unexpected "sub" claim value',n,"sub","check_failed");if(f&&!ao(n.aud,typeof f=="string"?[f]:f))throw new ee('unexpected "aud" claim value',n,"aud","check_failed");let l;switch(typeof r.clockTolerance){case"string":l=dt(r.clockTolerance);break;case"number":l=r.clockTolerance;break;case"undefined":l=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:d}=r,h=he(d||new Date);if((n.iat!==void 0||u)&&typeof n.iat!="number")throw new ee('"iat" claim must be a number',n,"iat","invalid");if(n.nbf!==void 0){if(typeof n.nbf!="number")throw new ee('"nbf" claim must be a number',n,"nbf","invalid");if(n.nbf>h+l)throw new ee('"nbf" claim timestamp check failed',n,"nbf","check_failed")}if(n.exp!==void 0){if(typeof n.exp!="number")throw new ee('"exp" claim must be a number',n,"exp","invalid");if(n.exp<=h-l)throw new Cr('"exp" claim timestamp check failed',n,"exp","check_failed")}if(u){const m=h-n.iat,b=typeof u=="number"?u:dt(u);if(m-l>b)throw new Cr('"iat" claim timestamp check failed (too far in the past)',n,"iat","check_failed");if(m<0-l)throw new ee('"iat" claim timestamp check failed (it should be in the past)',n,"iat","check_failed")}return n}var j;class co{constructor(t){$(this,j);if(!xt(t))throw new TypeError("JWT Claims Set MUST be an object");M(this,j,structuredClone(t))}data(){return Nt.encode(JSON.stringify(g(this,j)))}get iss(){return g(this,j).iss}set iss(t){g(this,j).iss=t}get sub(){return g(this,j).sub}set sub(t){g(this,j).sub=t}get aud(){return g(this,j).aud}set aud(t){g(this,j).aud=t}set jti(t){g(this,j).jti=t}set nbf(t){typeof t=="number"?g(this,j).nbf=ve("setNotBefore",t):t instanceof Date?g(this,j).nbf=ve("setNotBefore",he(t)):g(this,j).nbf=he(new Date)+dt(t)}set exp(t){typeof t=="number"?g(this,j).exp=ve("setExpirationTime",t):t instanceof Date?g(this,j).exp=ve("setExpirationTime",he(t)):g(this,j).exp=he(new Date)+dt(t)}set iat(t){t===void 0?g(this,j).iat=he(new Date):t instanceof Date?g(this,j).iat=ve("setIssuedAt",he(t)):typeof t=="string"?g(this,j).iat=ve("setIssuedAt",he(new Date)+dt(t)):g(this,j).iat=ve("setIssuedAt",t)}}j=new WeakMap;async function uo(e,t,r){var a;const n=await ro(e,t,r);if((a=n.protectedHeader.crit)!=null&&a.includes("b64")&&n.protectedHeader.b64===!1)throw new Bt("JWTs MUST NOT use unencoded payload");const i={payload:oo(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return typeof t=="function"?{...i,key:n.key}:i}async function fo(e,t,r){const n=await Ls(e,t,"sign");Os(e,n);const s=await crypto.subtle.sign($s(e,n.algorithm),n,r);return new Uint8Array(s)}var Ye,V,ae;class lo{constructor(t){$(this,Ye);$(this,V);$(this,ae);if(!(t instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");M(this,Ye,t)}setProtectedHeader(t){if(g(this,V))throw new TypeError("setProtectedHeader can only be called once");return M(this,V,t),this}setUnprotectedHeader(t){if(g(this,ae))throw new TypeError("setUnprotectedHeader can only be called once");return M(this,ae,t),this}async sign(t,r){if(!g(this,V)&&!g(this,ae))throw new H("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Ps(g(this,V),g(this,ae)))throw new H("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const n={...g(this,V),...g(this,ae)},s=Ms(H,new Map([["b64",!0]]),r==null?void 0:r.crit,g(this,V),n);let i=!0;if(s.has("b64")&&(i=g(this,V).b64,typeof i!="boolean"))throw new H('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:a}=n;if(typeof a!="string"||!a)throw new H('JWS "alg" (Algorithm) Header Parameter missing or invalid');Ns(a,t,"sign");let c,f;i?(c=Er(g(this,Ye)),f=Fe(c)):(f=g(this,Ye),c="");let u,o;g(this,V)?(u=Er(JSON.stringify(g(this,V))),o=Fe(u)):(u="",o=new Uint8Array);const l=vs(o,Fe("."),f),d=await Ds(t,a),h=await fo(a,d,l),m={signature:Er(h),payload:c};return g(this,ae)&&(m.header=g(this,ae)),g(this,V)&&(m.protected=u),m}}Ye=new WeakMap,V=new WeakMap,ae=new WeakMap;var Xe;class ho{constructor(t){$(this,Xe);M(this,Xe,new lo(t))}setProtectedHeader(t){return g(this,Xe).setProtectedHeader(t),this}async sign(t,r){const n=await g(this,Xe).sign(t,r);if(n.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${n.protected}.${n.payload}.${n.signature}`}}Xe=new WeakMap;var _e,Y;class po{constructor(t={}){$(this,_e);$(this,Y);M(this,Y,new co(t))}setIssuer(t){return g(this,Y).iss=t,this}setSubject(t){return g(this,Y).sub=t,this}setAudience(t){return g(this,Y).aud=t,this}setJti(t){return g(this,Y).jti=t,this}setNotBefore(t){return g(this,Y).nbf=t,this}setExpirationTime(t){return g(this,Y).exp=t,this}setIssuedAt(t){return g(this,Y).iat=t,this}setProtectedHeader(t){return M(this,_e,t),this}async sign(t,r){var s;const n=new ho(g(this,Y).data());if(n.setProtectedHeader(g(this,_e)),Array.isArray((s=g(this,_e))==null?void 0:s.crit)&&g(this,_e).crit.includes("b64")&&g(this,_e).b64===!1)throw new Bt("JWTs MUST NOT use unencoded payload");return n.sign(t,r)}}_e=new WeakMap,Y=new WeakMap;var mo={};const Bs=new TextEncoder().encode(mo.JWT_SECRET||"change-this-secret-in-production"),xo="7d";async function Hs(e){const t=await gs(10);return ws(e,t)}async function yo(e,t){return Ma(e,t)}async function bo(e){return await new po(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(xo).sign(Bs)}async function go(e){try{const{payload:t}=await uo(e,Bs);return t}catch{throw new Error("Invalid or expired token")}}function wo(e){if(!e)return null;const t=e.split(" ");return t.length!==2||t[0]!=="Bearer"?null:t[1]}const rt=new tt;rt.post("/login",async e=>{var t,r;try{const n=await e.req.json(),{email:s,password:i}=n;if(!s||!i)return e.json({error:"Email and password are required"},400);const a=await L("SELECT * FROM users WHERE email = $1 AND active = true",[s]);if(a.length===0)return e.json({error:"Invalid email or password"},401);const c=a[0];if(!await yo(i,c.password_hash))return e.json({error:"Invalid email or password"},401);const u=await L(`SELECT uc.*, c.name as company_name 
       FROM user_companies uc 
       JOIN companies c ON c.id = uc.company_id 
       WHERE uc.user_id = $1`,[c.id]);await L("UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = $1",[c.id]);const o=await bo({userId:c.id,email:c.email,role:c.role,companyId:(t=u[0])==null?void 0:t.company_id});await L(`INSERT INTO audit_logs (user_id, company_id, action, entity_type, entity_id, new_data, ip_address)
       VALUES ($1, $2, $3, $4, $5, $6, $7)`,[c.id,((r=u[0])==null?void 0:r.company_id)||null,"login","user",c.id,JSON.stringify({email:c.email}),e.req.header("cf-connecting-ip")||e.req.header("x-forwarded-for")||"unknown"]);const l={token:o,user:{id:c.id,email:c.email,name:c.name,role:c.role},companies:u.map(d=>({id:d.company_id,name:d.company_name,role:d.role}))};return e.json(l)}catch(n){return console.error("Login error:",n),e.json({error:"Internal server error"},500)}});rt.post("/register",async e=>{try{const t=await e.req.json(),{email:r,password:n,name:s,role:i,company_id:a}=t;if(!r||!n||!s)return e.json({error:"Email, password and name are required"},400);if((await L("SELECT id FROM users WHERE email = $1",[r])).length>0)return e.json({error:"User already exists"},400);const f=await Hs(n),o=(await L(`INSERT INTO users (email, password_hash, name, role, active)
       VALUES ($1, $2, $3, $4, true)
       RETURNING *`,[r,f,s,i||"read_only"]))[0];return a&&await L(`INSERT INTO user_companies (user_id, company_id, role)
         VALUES ($1, $2, $3)`,[o.id,a,i||"read_only"]),e.json({message:"User created successfully",user:{id:o.id,email:o.email,name:o.name,role:o.role}},201)}catch(t){return console.error("Register error:",t),e.json({error:"Internal server error"},500)}});rt.post("/forgot-password",async e=>{try{const{email:t}=await e.req.json();if(!t)return e.json({error:"Email is required"},400);const r=await L("SELECT id FROM users WHERE email = $1 AND active = true",[t]);if(r.length===0)return e.json({message:"If the email exists, a reset link will be sent"});const n=r[0],s=Math.random().toString(36).substring(2,15),i=new Date(Date.now()+36e5);return await L(`UPDATE users 
       SET password_reset_token = $1, password_reset_expires = $2 
       WHERE id = $3`,[s,i,n.id]),e.json({message:"If the email exists, a reset link will be sent"})}catch(t){return console.error("Forgot password error:",t),e.json({error:"Internal server error"},500)}});rt.post("/reset-password",async e=>{try{const{token:t,new_password:r}=await e.req.json();if(!t||!r)return e.json({error:"Token and new password are required"},400);const n=await L(`SELECT id FROM users 
       WHERE password_reset_token = $1 
       AND password_reset_expires > CURRENT_TIMESTAMP 
       AND active = true`,[t]);if(n.length===0)return e.json({error:"Invalid or expired reset token"},400);const s=n[0],i=await Hs(r);return await L(`UPDATE users 
       SET password_hash = $1, 
           password_reset_token = NULL, 
           password_reset_expires = NULL 
       WHERE id = $2`,[i,s.id]),e.json({message:"Password reset successfully"})}catch(t){return console.error("Reset password error:",t),e.json({error:"Internal server error"},500)}});rt.get("/me",async e=>{try{const t=e.get("user");if(!t)return e.json({error:"Not authenticated"},401);const r=await L("SELECT id, email, name, role, avatar_url, active, last_login FROM users WHERE id = $1",[t.userId]);if(r.length===0)return e.json({error:"User not found"},404);const n=await L(`SELECT uc.*, c.name as company_name 
       FROM user_companies uc 
       JOIN companies c ON c.id = uc.company_id 
       WHERE uc.user_id = $1`,[t.userId]);return e.json({user:r[0],companies:n.map(s=>({id:s.company_id,name:s.company_name,role:s.role}))})}catch(t){return console.error("Get user error:",t),e.json({error:"Internal server error"},500)}});async function Nr(e,t){const r=e.req.header("Authorization"),n=wo(r);if(!n)return e.json({error:"Authentication required"},401);try{const s=await go(n);e.set("user",s),await t()}catch{return e.json({error:"Invalid or expired token"},401)}}const Ee=new tt;Ee.use("/*",Nr);Ee.get("/",async e=>{try{const t=e.get("user"),{page:r="1",limit:n="20",search:s="",sort_by:i="name",sort_order:a="asc"}=e.req.query(),c=(parseInt(r)-1)*parseInt(n),f=`%${s}%`,u=`
      SELECT 
        p.*,
        c.name as category_name,
        b.name as brand_name,
        COALESCE(SUM(sb.quantity), 0) as total_stock
      FROM products p
      LEFT JOIN categories c ON c.id = p.category_id
      LEFT JOIN brands b ON b.id = p.brand_id
      LEFT JOIN stock_balance sb ON sb.product_id = p.id
      WHERE p.company_id = $1
      AND (p.name ILIKE $2 OR p.sku ILIKE $2 OR p.barcode ILIKE $2)
      GROUP BY p.id, c.name, b.name
      ORDER BY ${i} ${a}
      LIMIT $3 OFFSET $4
    `,o=await L(u,[t.companyId,f,parseInt(n),c]),l=await L(`SELECT COUNT(*) as count FROM products 
       WHERE company_id = $1 
       AND (name ILIKE $2 OR sku ILIKE $2 OR barcode ILIKE $2)`,[t.companyId,f]),d=parseInt(l[0].count),h={data:o,pagination:{page:parseInt(r),limit:parseInt(n),total:d,total_pages:Math.ceil(d/parseInt(n))}};return e.json(h)}catch(t){return console.error("List products error:",t),e.json({error:"Internal server error"},500)}});Ee.get("/:id",async e=>{try{const t=e.get("user"),{id:r}=e.req.param(),n=await L(`SELECT 
        p.*,
        c.name as category_name,
        b.name as brand_name
      FROM products p
      LEFT JOIN categories c ON c.id = p.category_id
      LEFT JOIN brands b ON b.id = p.brand_id
      WHERE p.id = $1 AND p.company_id = $2`,[r,t.companyId]);if(n.length===0)return e.json({error:"Product not found"},404);const s=await L(`SELECT 
        sb.branch_id,
        br.name as branch_name,
        sb.quantity,
        sb.last_movement
      FROM stock_balance sb
      JOIN branches br ON br.id = sb.branch_id
      WHERE sb.product_id = $1`,[r]);return e.json({product:n[0],stock:s})}catch(t){return console.error("Get product error:",t),e.json({error:"Internal server error"},500)}});Ee.post("/",async e=>{try{const t=e.get("user"),r=await e.req.json(),{sku:n,barcode:s,name:i,description:a,category_id:c,brand_id:f,cost_price:u,sale_price:o,unit:l="UN",min_stock:d=0,max_stock:h=0,image_url:m}=r;if(!n||!i||o===void 0)return e.json({error:"SKU, name and sale_price are required"},400);if((await L("SELECT id FROM products WHERE company_id = $1 AND sku = $2",[t.companyId,n])).length>0)return e.json({error:"SKU already exists"},400);const w=await L(`INSERT INTO products (
        company_id, sku, barcode, name, description, category_id, brand_id,
        cost_price, sale_price, unit, min_stock, max_stock, image_url, active
      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, true)
      RETURNING *`,[t.companyId,n,s,i,a,c,f,u||0,o,l,d,h,m]);return await L(`INSERT INTO audit_logs (user_id, company_id, action, entity_type, entity_id, new_data)
       VALUES ($1, $2, $3, $4, $5, $6)`,[t.userId,t.companyId,"create","product",w[0].id,JSON.stringify(w[0])]),e.json(w[0],201)}catch(t){return console.error("Create product error:",t),e.json({error:"Internal server error"},500)}});Ee.put("/:id",async e=>{try{const t=e.get("user"),{id:r}=e.req.param(),n=await e.req.json(),s=await L("SELECT * FROM products WHERE id = $1 AND company_id = $2",[r,t.companyId]);if(s.length===0)return e.json({error:"Product not found"},404);const i=[],a=[];let c=1;if(Object.entries(n).forEach(([o,l])=>{l!==void 0&&o!=="id"&&o!=="company_id"&&(i.push(`${o} = $${c}`),a.push(l),c++)}),i.length===0)return e.json({error:"No fields to update"},400);a.push(r,t.companyId);const f=`
      UPDATE products 
      SET ${i.join(", ")}, updated_at = CURRENT_TIMESTAMP
      WHERE id = $${c} AND company_id = $${c+1}
      RETURNING *
    `,u=await L(f,a);return await L(`INSERT INTO audit_logs (user_id, company_id, action, entity_type, entity_id, old_data, new_data)
       VALUES ($1, $2, $3, $4, $5, $6, $7)`,[t.userId,t.companyId,"update","product",r,JSON.stringify(s[0]),JSON.stringify(u[0])]),e.json(u[0])}catch(t){return console.error("Update product error:",t),e.json({error:"Internal server error"},500)}});Ee.delete("/:id",async e=>{try{const t=e.get("user"),{id:r}=e.req.param(),n=await L("SELECT * FROM products WHERE id = $1 AND company_id = $2",[r,t.companyId]);return n.length===0?e.json({error:"Product not found"},404):(await L("UPDATE products SET active = false, updated_at = CURRENT_TIMESTAMP WHERE id = $1",[r]),await L(`INSERT INTO audit_logs (user_id, company_id, action, entity_type, entity_id, old_data)
       VALUES ($1, $2, $3, $4, $5, $6)`,[t.userId,t.companyId,"delete","product",r,JSON.stringify(n[0])]),e.json({message:"Product deleted successfully"}))}catch(t){return console.error("Delete product error:",t),e.json({error:"Internal server error"},500)}});Ee.get("/barcode/:barcode",async e=>{try{const t=e.get("user"),{barcode:r}=e.req.param(),n=await L(`SELECT 
        p.*,
        c.name as category_name,
        b.name as brand_name
      FROM products p
      LEFT JOIN categories c ON c.id = p.category_id
      LEFT JOIN brands b ON b.id = p.brand_id
      WHERE p.barcode = $1 AND p.company_id = $2 AND p.active = true`,[r,t.companyId]);return n.length===0?e.json({error:"Product not found"},404):e.json(n[0])}catch(t){return console.error("Find product by barcode error:",t),e.json({error:"Internal server error"},500)}});const vt=new tt;vt.use("/*",Nr);vt.post("/",async e=>{try{const t=e.get("user"),r=await e.req.json(),{customer_id:n,branch_id:s,items:i,discount_amount:a=0,discount_percentage:c=0,payment_method:f,amount_paid:u,payments:o,notes:l}=r;let d=0;i.forEach(v=>{const I=v.quantity*v.unit_price,T=v.discount_amount||I*(v.discount_percentage||0)/100;d+=I-T});const h=a||d*c/100,m=d-h,b=u-m,w=await L("SELECT COUNT(*) as count FROM sales WHERE company_id = $1",[t.companyId]),p=`VND-${String(parseInt(w[0].count)+1).padStart(5,"0")}`,y=await L(`INSERT INTO sales (company_id, branch_id, sale_number, customer_id, cashier_id, status, 
       subtotal, discount_amount, discount_percentage, total, payment_method, amount_paid, change_amount, notes)
      VALUES ($1, $2, $3, $4, $5, 'completed', $6, $7, $8, $9, $10, $11, $12, $13)
      RETURNING *`,[t.companyId,s,p,n,t.userId,d,h,c,m,f,u,b,l]),_=y[0].id;for(const v of i){const I=v.quantity*v.unit_price,T=v.discount_amount||I*(v.discount_percentage||0)/100,x=I-T;await L(`INSERT INTO sale_items (sale_id, product_id, quantity, unit_price, discount_amount, discount_percentage, subtotal, total)
        VALUES ($1, $2, $3, $4, $5, $6, $7, $8)`,[_,v.product_id,v.quantity,v.unit_price,v.discount_amount||0,v.discount_percentage||0,I,x]),await L(`UPDATE stock_balance SET quantity = quantity - $1, last_movement = CURRENT_TIMESTAMP 
        WHERE product_id = $2 AND branch_id = $3`,[v.quantity,v.product_id,s]),await L(`INSERT INTO stock_movements (product_id, branch_id, type, quantity, unit_cost, reference_type, reference_id, user_id)
        VALUES ($1, $2, 'sale', $3, $4, 'sale', $5, $6)`,[v.product_id,s,-v.quantity,v.unit_price,_,t.userId])}if(f==="mixed"&&o)for(const v of o)await L("INSERT INTO sale_payments (sale_id, payment_method, amount) VALUES ($1, $2, $3)",[_,v.payment_method,v.amount]);return await L(`INSERT INTO audit_logs (user_id, company_id, action, entity_type, entity_id, new_data)
      VALUES ($1, $2, 'sale_create', 'sale', $3, $4)`,[t.userId,t.companyId,_,JSON.stringify({sale_number:p,total:m})]),e.json(y[0],201)}catch(t){return console.error("Create sale error:",t),e.json({error:"Internal server error"},500)}});vt.get("/",async e=>{try{const t=e.get("user"),{page:r="1",limit:n="20",start_date:s,end_date:i,branch_id:a,status:c}=e.req.query(),f=(parseInt(r)-1)*parseInt(n);let u="WHERE s.company_id = $1";const o=[t.companyId];let l=2;s&&(u+=` AND s.created_at >= $${l}`,o.push(s),l++),i&&(u+=` AND s.created_at <= $${l}`,o.push(i),l++),a&&(u+=` AND s.branch_id = $${l}`,o.push(a),l++),c&&(u+=` AND s.status = $${l}`,o.push(c),l++);const d=await L(`SELECT s.*, b.name as branch_name, u.name as cashier_name, p.name as customer_name
      FROM sales s
      JOIN branches b ON b.id = s.branch_id
      LEFT JOIN users u ON u.id = s.cashier_id
      LEFT JOIN persons p ON p.id = s.customer_id
      ${u}
      ORDER BY s.created_at DESC
      LIMIT $${l} OFFSET $${l+1}`,[...o,parseInt(n),f]);return e.json({data:d})}catch(t){return console.error("List sales error:",t),e.json({error:"Internal server error"},500)}});vt.get("/:id",async e=>{try{const t=e.get("user"),{id:r}=e.req.param(),n=await L(`SELECT s.*, b.name as branch_name, u.name as cashier_name, p.name as customer_name
      FROM sales s
      JOIN branches b ON b.id = s.branch_id
      LEFT JOIN users u ON u.id = s.cashier_id
      LEFT JOIN persons p ON p.id = s.customer_id
      WHERE s.id = $1 AND s.company_id = $2`,[r,t.companyId]);if(n.length===0)return e.json({error:"Sale not found"},404);const s=await L(`SELECT si.*, pr.name as product_name, pr.sku, pr.barcode
      FROM sale_items si
      JOIN products pr ON pr.id = si.product_id
      WHERE si.sale_id = $1`,[r]),i=await L("SELECT * FROM sale_payments WHERE sale_id = $1",[r]);return e.json({sale:n[0],items:s,payments:i})}catch(t){return console.error("Get sale error:",t),e.json({error:"Internal server error"},500)}});const St=new tt;St.use("/*",Nr);St.get("/",async e=>{try{const t=e.get("user"),{branch_id:r,low_stock:n,search:s}=e.req.query();let i="WHERE p.company_id = $1";const a=[t.companyId];let c=2;r&&(i+=` AND sb.branch_id = $${c}`,a.push(r),c++),s&&(i+=` AND (p.name ILIKE $${c} OR p.sku ILIKE $${c})`,a.push(`%${s}%`),c++);const f=await L(`SELECT 
        p.id as product_id,
        p.sku,
        p.barcode,
        p.name as product_name,
        p.unit,
        p.min_stock,
        p.cost_price,
        p.sale_price,
        sb.branch_id,
        b.name as branch_name,
        sb.quantity,
        sb.last_movement,
        (sb.quantity * p.cost_price) as total_cost,
        (sb.quantity * p.sale_price) as total_value
      FROM products p
      LEFT JOIN stock_balance sb ON sb.product_id = p.id
      LEFT JOIN branches b ON b.id = sb.branch_id
      ${i}
      ${n==="true"?"AND sb.quantity < p.min_stock":""}
      ORDER BY p.name`,a);return e.json({data:f})}catch(t){return console.error("Get stock error:",t),e.json({error:"Internal server error"},500)}});St.post("/adjustment",async e=>{try{const t=e.get("user"),{product_id:r,branch_id:n,quantity:s,type:i,notes:a}=await e.req.json();return await L(`INSERT INTO stock_balance (product_id, branch_id, quantity, last_movement)
      VALUES ($1, $2, $3, CURRENT_TIMESTAMP)
      ON CONFLICT (product_id, branch_id)
      DO UPDATE SET quantity = stock_balance.quantity + $3, last_movement = CURRENT_TIMESTAMP`,[r,n,s]),await L(`INSERT INTO stock_movements (product_id, branch_id, type, quantity, reference_type, notes, user_id)
      VALUES ($1, $2, $3, $4, 'adjustment', $5, $6)`,[r,n,i,s,a,t.userId]),await L(`INSERT INTO audit_logs (user_id, company_id, action, entity_type, entity_id, new_data)
      VALUES ($1, $2, 'stock_adjustment', 'stock', $3, $4)`,[t.userId,t.companyId,r,JSON.stringify({quantity:s,type:i,notes:a})]),e.json({message:"Stock adjusted successfully"})}catch(t){return console.error("Stock adjustment error:",t),e.json({error:"Internal server error"},500)}});St.get("/movements",async e=>{try{const t=e.get("user"),{product_id:r,branch_id:n,start_date:s,end_date:i,type:a}=e.req.query();let c="WHERE p.company_id = $1";const f=[t.companyId];let u=2;r&&(c+=` AND sm.product_id = $${u}`,f.push(r),u++),n&&(c+=` AND sm.branch_id = $${u}`,f.push(n),u++),s&&(c+=` AND sm.created_at >= $${u}`,f.push(s),u++),i&&(c+=` AND sm.created_at <= $${u}`,f.push(i),u++),a&&(c+=` AND sm.type = $${u}`,f.push(a),u++);const o=await L(`SELECT 
        sm.*,
        p.name as product_name,
        p.sku,
        b.name as branch_name,
        u.name as user_name
      FROM stock_movements sm
      JOIN products p ON p.id = sm.product_id
      JOIN branches b ON b.id = sm.branch_id
      LEFT JOIN users u ON u.id = sm.user_id
      ${c}
      ORDER BY sm.created_at DESC
      LIMIT 100`,f);return e.json({data:o})}catch(t){return console.error("Get stock movements error:",t),e.json({error:"Internal server error"},500)}});const Z=new tt;Z.use("/*",$i());Z.use("/api/*",Ii());Z.use("/static/*",Wi({root:"./public"}));Z.route("/api/auth",rt);Z.route("/api/products",Ee);Z.route("/api/sales",vt);Z.route("/api/stock",St);Z.get("/api/health",e=>e.json({status:"ok",timestamp:new Date().toISOString(),version:"1.0.0"}));Z.get("/",e=>e.html(`
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP/PDV - Sistema de Gesto</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"><\/script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              heading: ['Montserrat', 'sans-serif']
            },
            colors: {
              primary: {
                50: '#f0f9ff',
                100: '#e0f2fe',
                500: '#0ea5e9',
                600: '#0284c7',
                700: '#0369a1',
              }
            }
          }
        }
      }
    <\/script>
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      h1, h2, h3, h4, h5, h6 {
        font-family: 'Montserrat', sans-serif;
      }
      .sidebar {
        transition: transform 0.3s ease;
      }
      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
        }
        .sidebar.open {
          transform: translateX(0);
        }
      }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen">
        <div class="flex items-center justify-center min-h-screen">
            <div class="text-center">
                <i class="fas fa-spinner fa-spin text-6xl text-primary-500 mb-6"></i>
                <p class="text-xl text-gray-600">Carregando sistema...</p>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"><\/script>
    <script src="/static/app.js"><\/script>
</body>
</html>
  `));Z.notFound(e=>e.json({error:"Not found"},404));Z.onError((e,t)=>(console.error("Server error:",e),t.json({error:"Internal server error"},500)));const kn=new tt,_o=Object.assign({"/src/index.tsx":Z});let js=!1;for(const[,e]of Object.entries(_o))e&&(kn.all("*",t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),kn.notFound(t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),js=!0);if(!js)throw new Error("Can't import modules from ['/src/index.ts','/src/index.tsx','/app/server.ts']");export{kn as default};
