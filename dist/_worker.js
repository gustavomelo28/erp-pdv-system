var Wn=Object.defineProperty;var qr=e=>{throw TypeError(e)};var Kn=(e,t,r)=>t in e?Wn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var O=(e,t,r)=>Kn(e,typeof t!="symbol"?t+"":t,r),Ht=(e,t,r)=>t.has(e)||qr("Cannot "+r);var g=(e,t,r)=>(Ht(e,t,"read from private field"),r?r.call(e):t.get(e)),$=(e,t,r)=>t.has(e)?qr("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),M=(e,t,r,s)=>(Ht(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),k=(e,t,r)=>(Ht(e,t,"access private method"),r);var kr=(e,t,r,s)=>({set _(i){M(e,t,i,r)},get _(){return g(e,t,s)}});import Gs,{existsSync as Jn,statSync as Gn,createReadStream as Br}from"fs";import Vn,{join as Hr}from"path";import{versions as zn}from"process";import Vs,{Readable as Yn}from"stream";import et from"events";import Ze from"util";import Pr from"crypto";import Xn from"dns";import zs from"net";import Zn from"tls";import ei from"string_decoder";var jr=(e,t,r)=>(s,i)=>{let n=-1;return a(0);async function a(c){if(c<=n)throw new Error("next() called multiple times");n=c;let f,u=!1,o;if(e[c]?(o=e[c][0][0],s.req.routeIndex=c):o=c===e.length&&i||void 0,o)try{f=await o(s,()=>a(c+1))}catch(l){if(l instanceof Error&&t)s.error=l,f=await t(l,s),u=!0;else throw l}else s.finalized===!1&&r&&(f=await r(s));return f&&(s.finalized===!1||u)&&(s.res=f),s}},ti=Symbol(),ri=async(e,t=Object.create(null))=>{const{all:r=!1,dot:s=!1}=t,n=(e instanceof rn?e.raw.headers:e.headers).get("Content-Type");return n!=null&&n.startsWith("multipart/form-data")||n!=null&&n.startsWith("application/x-www-form-urlencoded")?si(e,{all:r,dot:s}):{}};async function si(e,t){const r=await e.formData();return r?ni(r,t):{}}function ni(e,t){const r=Object.create(null);return e.forEach((s,i)=>{t.all||i.endsWith("[]")?ii(r,i,s):r[i]=s}),t.dot&&Object.entries(r).forEach(([s,i])=>{s.includes(".")&&(ai(r,s,i),delete r[s])}),r}var ii=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},ai=(e,t,r)=>{let s=e;const i=t.split(".");i.forEach((n,a)=>{a===i.length-1?s[n]=r:((!s[n]||typeof s[n]!="object"||Array.isArray(s[n])||s[n]instanceof File)&&(s[n]=Object.create(null)),s=s[n])})},Ys=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},oi=e=>{const{groups:t,path:r}=ci(e),s=Ys(r);return ui(s,t)},ci=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,s)=>{const i=`@${s}`;return t.push([i,r]),i}),{groups:t,path:e}},ui=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[s]=t[r];for(let i=e.length-1;i>=0;i--)if(e[i].includes(s)){e[i]=e[i].replace(s,t[r][1]);break}}return e},At={},fi=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const s=`${e}#${t}`;return At[s]||(r[2]?At[s]=t&&t[0]!==":"&&t[0]!=="*"?[s,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:At[s]=[e,r[1],!0]),At[s]}return null},Or=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},di=e=>Or(e,decodeURI),Xs=e=>{const t=e.url,r=t.indexOf("/",t.indexOf(":")+4);let s=r;for(;s<t.length;s++){const i=t.charCodeAt(s);if(i===37){const n=t.indexOf("?",s),a=t.indexOf("#",s),c=n===-1?a===-1?void 0:a:a===-1?n:Math.min(n,a),f=t.slice(r,c);return di(f.includes("%25")?f.replace(/%25/g,"%2525"):f)}else if(i===63||i===35)break}return t.slice(r,s)},li=e=>{const t=Xs(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},qe=(e,t,...r)=>(r.length&&(t=qe(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),Zs=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let s="";return t.forEach(i=>{if(i!==""&&!/\:/.test(i))s+="/"+i;else if(/\:/.test(i))if(/\?/.test(i)){r.length===0&&s===""?r.push("/"):r.push(s);const n=i.replace("?","");s+="/"+n,r.push(s)}else s+="/"+i}),r.filter((i,n,a)=>a.indexOf(i)===n)},jt=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?Or(e,tn):e):e,en=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let a=e.indexOf("?",8);if(a===-1)return;for(e.startsWith(t,a+1)||(a=e.indexOf(`&${t}`,a+1));a!==-1;){const c=e.charCodeAt(a+t.length+1);if(c===61){const f=a+t.length+2,u=e.indexOf("&",f);return jt(e.slice(f,u===-1?void 0:u))}else if(c==38||isNaN(c))return"";a=e.indexOf(`&${t}`,a+1)}if(s=/[%+]/.test(e),!s)return}const i={};s??(s=/[%+]/.test(e));let n=e.indexOf("?",8);for(;n!==-1;){const a=e.indexOf("&",n+1);let c=e.indexOf("=",n);c>a&&a!==-1&&(c=-1);let f=e.slice(n+1,c===-1?a===-1?void 0:a:c);if(s&&(f=jt(f)),n=a,f==="")continue;let u;c===-1?u="":(u=e.slice(c+1,a===-1?void 0:a),s&&(u=jt(u))),r?(i[f]&&Array.isArray(i[f])||(i[f]=[]),i[f].push(u)):i[f]??(i[f]=u)}return t?i[t]:i},hi=en,pi=(e,t)=>en(e,t,!0),tn=decodeURIComponent,Ur=e=>Or(e,tn),Qe,z,de,sn,nn,Ar,xe,Us,rn=(Us=class{constructor(e,t="/",r=[[]]){$(this,de);O(this,"raw");$(this,Qe);$(this,z);O(this,"routeIndex",0);O(this,"path");O(this,"bodyCache",{});$(this,xe,e=>{const{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;const i=Object.keys(t)[0];return i?t[i].then(n=>(i==="json"&&(n=JSON.stringify(n)),new Response(n)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,M(this,z,r),M(this,Qe,{})}param(e){return e?k(this,de,sn).call(this,e):k(this,de,nn).call(this)}query(e){return hi(this.url,e)}queries(e){return pi(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,s)=>{t[s]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await ri(this,e))}json(){return g(this,xe).call(this,"text").then(e=>JSON.parse(e))}text(){return g(this,xe).call(this,"text")}arrayBuffer(){return g(this,xe).call(this,"arrayBuffer")}blob(){return g(this,xe).call(this,"blob")}formData(){return g(this,xe).call(this,"formData")}addValidatedData(e,t){g(this,Qe)[e]=t}valid(e){return g(this,Qe)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[ti](){return g(this,z)}get matchedRoutes(){return g(this,z)[0].map(([[,e]])=>e)}get routePath(){return g(this,z)[0].map(([[,e]])=>e)[this.routeIndex].path}},Qe=new WeakMap,z=new WeakMap,de=new WeakSet,sn=function(e){const t=g(this,z)[0][this.routeIndex][1][e],r=k(this,de,Ar).call(this,t);return r&&/\%/.test(r)?Ur(r):r},nn=function(){const e={},t=Object.keys(g(this,z)[0][this.routeIndex][1]);for(const r of t){const s=k(this,de,Ar).call(this,g(this,z)[0][this.routeIndex][1][r]);s!==void 0&&(e[r]=/\%/.test(s)?Ur(s):s)}return e},Ar=function(e){return g(this,z)[1]?g(this,z)[1][e]:e},xe=new WeakMap,Us),xi={Stringify:1},an=async(e,t,r,s,i)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const n=e.callbacks;return n!=null&&n.length?(i?i[0]+=e:i=[e],Promise.all(n.map(c=>c({phase:t,buffer:i,context:s}))).then(c=>Promise.all(c.filter(Boolean).map(f=>an(f,t,!1,s,i))).then(()=>i[0]))):Promise.resolve(e)},mi="text/plain; charset=UTF-8",Ut=(e,t)=>({"Content-Type":e,...t}),st=(e,t)=>new Response(e,t),yt,bt,oe,We,ce,J,gt,Ke,Je,Ce,wt,_t,me,ke,Fs,yi=(Fs=class{constructor(e,t){$(this,me);$(this,yt);$(this,bt);O(this,"env",{});$(this,oe);O(this,"finalized",!1);O(this,"error");$(this,We);$(this,ce);$(this,J);$(this,gt);$(this,Ke);$(this,Je);$(this,Ce);$(this,wt);$(this,_t);O(this,"render",(...e)=>(g(this,Ke)??M(this,Ke,t=>this.html(t)),g(this,Ke).call(this,...e)));O(this,"setLayout",e=>M(this,gt,e));O(this,"getLayout",()=>g(this,gt));O(this,"setRenderer",e=>{M(this,Ke,e)});O(this,"header",(e,t,r)=>{this.finalized&&M(this,J,st(g(this,J).body,g(this,J)));const s=g(this,J)?g(this,J).headers:g(this,Ce)??M(this,Ce,new Headers);t===void 0?s.delete(e):r!=null&&r.append?s.append(e,t):s.set(e,t)});O(this,"status",e=>{M(this,We,e)});O(this,"set",(e,t)=>{g(this,oe)??M(this,oe,new Map),g(this,oe).set(e,t)});O(this,"get",e=>g(this,oe)?g(this,oe).get(e):void 0);O(this,"newResponse",(...e)=>k(this,me,ke).call(this,...e));O(this,"body",(e,t,r)=>k(this,me,ke).call(this,e,t,r));O(this,"text",(e,t,r)=>!g(this,Ce)&&!g(this,We)&&!t&&!r&&!this.finalized?new Response(e):k(this,me,ke).call(this,e,t,Ut(mi,r)));O(this,"json",(e,t,r)=>k(this,me,ke).call(this,JSON.stringify(e),t,Ut("application/json",r)));O(this,"html",(e,t,r)=>{const s=i=>k(this,me,ke).call(this,i,t,Ut("text/html; charset=UTF-8",r));return typeof e=="object"?an(e,xi.Stringify,!1,{}).then(s):s(e)});O(this,"redirect",(e,t)=>{const r=String(e);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,t??302)});O(this,"notFound",()=>(g(this,Je)??M(this,Je,()=>st()),g(this,Je).call(this,this)));M(this,yt,e),t&&(M(this,ce,t.executionCtx),this.env=t.env,M(this,Je,t.notFoundHandler),M(this,_t,t.path),M(this,wt,t.matchResult))}get req(){return g(this,bt)??M(this,bt,new rn(g(this,yt),g(this,_t),g(this,wt))),g(this,bt)}get event(){if(g(this,ce)&&"respondWith"in g(this,ce))return g(this,ce);throw Error("This context has no FetchEvent")}get executionCtx(){if(g(this,ce))return g(this,ce);throw Error("This context has no ExecutionContext")}get res(){return g(this,J)||M(this,J,st(null,{headers:g(this,Ce)??M(this,Ce,new Headers)}))}set res(e){if(g(this,J)&&e){e=st(e.body,e);for(const[t,r]of g(this,J).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const s=g(this,J).headers.getSetCookie();e.headers.delete("set-cookie");for(const i of s)e.headers.append("set-cookie",i)}else e.headers.set(t,r)}M(this,J,e),this.finalized=!0}get var(){return g(this,oe)?Object.fromEntries(g(this,oe)):{}}},yt=new WeakMap,bt=new WeakMap,oe=new WeakMap,We=new WeakMap,ce=new WeakMap,J=new WeakMap,gt=new WeakMap,Ke=new WeakMap,Je=new WeakMap,Ce=new WeakMap,wt=new WeakMap,_t=new WeakMap,me=new WeakSet,ke=function(e,t,r){const s=g(this,J)?new Headers(g(this,J).headers):g(this,Ce)??new Headers;if(typeof t=="object"&&"headers"in t){const n=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(const[a,c]of n)a.toLowerCase()==="set-cookie"?s.append(a,c):s.set(a,c)}if(r)for(const[n,a]of Object.entries(r))if(typeof a=="string")s.set(n,a);else{s.delete(n);for(const c of a)s.append(n,c)}const i=typeof t=="number"?t:(t==null?void 0:t.status)??g(this,We);return st(e,{status:i,headers:s})},Fs),U="ALL",bi="all",gi=["get","post","put","delete","options","patch"],on="Can not add a route since the matcher is already built.",cn=class extends Error{},wi="__COMPOSED_HANDLER",_i=e=>e.text("404 Not Found",404),Fr=(e,t)=>{if("getResponse"in e){const r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},te,F,un,re,Se,It,Pt,Ge,Ei=(Ge=class{constructor(t={}){$(this,F);O(this,"get");O(this,"post");O(this,"put");O(this,"delete");O(this,"options");O(this,"patch");O(this,"all");O(this,"on");O(this,"use");O(this,"router");O(this,"getPath");O(this,"_basePath","/");$(this,te,"/");O(this,"routes",[]);$(this,re,_i);O(this,"errorHandler",Fr);O(this,"onError",t=>(this.errorHandler=t,this));O(this,"notFound",t=>(M(this,re,t),this));O(this,"fetch",(t,...r)=>k(this,F,Pt).call(this,t,r[1],r[0],t.method));O(this,"request",(t,r,s,i)=>t instanceof Request?this.fetch(r?new Request(t,r):t,s,i):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${qe("/",t)}`,r),s,i)));O(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(k(this,F,Pt).call(this,t.request,t,void 0,t.request.method))})});[...gi,bi].forEach(n=>{this[n]=(a,...c)=>(typeof a=="string"?M(this,te,a):k(this,F,Se).call(this,n,g(this,te),a),c.forEach(f=>{k(this,F,Se).call(this,n,g(this,te),f)}),this)}),this.on=(n,a,...c)=>{for(const f of[a].flat()){M(this,te,f);for(const u of[n].flat())c.map(o=>{k(this,F,Se).call(this,u.toUpperCase(),g(this,te),o)})}return this},this.use=(n,...a)=>(typeof n=="string"?M(this,te,n):(M(this,te,"*"),a.unshift(n)),a.forEach(c=>{k(this,F,Se).call(this,U,g(this,te),c)}),this);const{strict:s,...i}=t;Object.assign(this,i),this.getPath=s??!0?t.getPath??Xs:li}route(t,r){const s=this.basePath(t);return r.routes.map(i=>{var a;let n;r.errorHandler===Fr?n=i.handler:(n=async(c,f)=>(await jr([],r.errorHandler)(c,()=>i.handler(c,f))).res,n[wi]=i.handler),k(a=s,F,Se).call(a,i.method,i.path,n)}),this}basePath(t){const r=k(this,F,un).call(this);return r._basePath=qe(this._basePath,t),r}mount(t,r,s){let i,n;s&&(typeof s=="function"?n=s:(n=s.optionHandler,s.replaceRequest===!1?i=f=>f:i=s.replaceRequest));const a=n?f=>{const u=n(f);return Array.isArray(u)?u:[u]}:f=>{let u;try{u=f.executionCtx}catch{}return[f.env,u]};i||(i=(()=>{const f=qe(this._basePath,t),u=f==="/"?0:f.length;return o=>{const l=new URL(o.url);return l.pathname=l.pathname.slice(u)||"/",new Request(l,o)}})());const c=async(f,u)=>{const o=await r(i(f.req.raw),...a(f));if(o)return o;await u()};return k(this,F,Se).call(this,U,qe(t,"*"),c),this}},te=new WeakMap,F=new WeakSet,un=function(){const t=new Ge({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,M(t,re,g(this,re)),t.routes=this.routes,t},re=new WeakMap,Se=function(t,r,s){t=t.toUpperCase(),r=qe(this._basePath,r);const i={basePath:this._basePath,path:r,method:t,handler:s};this.router.add(t,r,[s,i]),this.routes.push(i)},It=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},Pt=function(t,r,s,i){if(i==="HEAD")return(async()=>new Response(null,await k(this,F,Pt).call(this,t,r,s,"GET")))();const n=this.getPath(t,{env:s}),a=this.router.match(i,n),c=new yi(t,{path:n,matchResult:a,env:s,executionCtx:r,notFoundHandler:g(this,re)});if(a[0].length===1){let u;try{u=a[0][0][0][0](c,async()=>{c.res=await g(this,re).call(this,c)})}catch(o){return k(this,F,It).call(this,o,c)}return u instanceof Promise?u.then(o=>o||(c.finalized?c.res:g(this,re).call(this,c))).catch(o=>k(this,F,It).call(this,o,c)):u??g(this,re).call(this,c)}const f=jr(a[0],this.errorHandler,g(this,re));return(async()=>{try{const u=await f(c);if(!u.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return u.res}catch(u){return k(this,F,It).call(this,u,c)}})()},Ge),fn=[];function vi(e,t){const r=this.buildAllMatchers(),s=((i,n)=>{const a=r[i]||r[U],c=a[2][n];if(c)return c;const f=n.match(a[0]);if(!f)return[[],fn];const u=f.indexOf("",1);return[a[1][u],f]});return this.match=s,s(e,t)}var Dt="[^/]+",ut=".*",ft="(?:|/.*)",Be=Symbol(),Si=new Set(".\\+*[^]$()");function Ai(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===ut||e===ft?1:t===ut||t===ft?-1:e===Dt?1:t===Dt?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var Re,Te,se,Oe,Ci=(Oe=class{constructor(){$(this,Re);$(this,Te);$(this,se,Object.create(null))}insert(t,r,s,i,n){if(t.length===0){if(g(this,Re)!==void 0)throw Be;if(n)return;M(this,Re,r);return}const[a,...c]=t,f=a==="*"?c.length===0?["","",ut]:["","",Dt]:a==="/*"?["","",ft]:a.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let u;if(f){const o=f[1];let l=f[2]||Dt;if(o&&f[2]&&(l===".*"||(l=l.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(l))))throw Be;if(u=g(this,se)[l],!u){if(Object.keys(g(this,se)).some(d=>d!==ut&&d!==ft))throw Be;if(n)return;u=g(this,se)[l]=new Oe,o!==""&&M(u,Te,i.varIndex++)}!n&&o!==""&&s.push([o,g(u,Te)])}else if(u=g(this,se)[a],!u){if(Object.keys(g(this,se)).some(o=>o.length>1&&o!==ut&&o!==ft))throw Be;if(n)return;u=g(this,se)[a]=new Oe}u.insert(c,r,s,i,n)}buildRegExpStr(){const r=Object.keys(g(this,se)).sort(Ai).map(s=>{const i=g(this,se)[s];return(typeof g(i,Te)=="number"?`(${s})@${g(i,Te)}`:Si.has(s)?`\\${s}`:s)+i.buildRegExpStr()});return typeof g(this,Re)=="number"&&r.unshift(`#${g(this,Re)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},Re=new WeakMap,Te=new WeakMap,se=new WeakMap,Oe),$t,Et,Qs,Ri=(Qs=class{constructor(){$(this,$t,{varIndex:0});$(this,Et,new Ci)}insert(e,t,r){const s=[],i=[];for(let a=0;;){let c=!1;if(e=e.replace(/\{[^}]+\}/g,f=>{const u=`@\\${a}`;return i[a]=[u,f],a++,c=!0,u}),!c)break}const n=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=i.length-1;a>=0;a--){const[c]=i[a];for(let f=n.length-1;f>=0;f--)if(n[f].indexOf(c)!==-1){n[f]=n[f].replace(c,i[a][1]);break}}return g(this,Et).insert(n,t,s,g(this,$t),r),s}buildRegExp(){let e=g(this,Et).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(i,n,a)=>n!==void 0?(r[++t]=Number(n),"$()"):(a!==void 0&&(s[Number(a)]=++t),"")),[new RegExp(`^${e}`),r,s]}},$t=new WeakMap,Et=new WeakMap,Qs),Ti=[/^$/,[],Object.create(null)],Ot=Object.create(null);function dn(e){return Ot[e]??(Ot[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Ii(){Ot=Object.create(null)}function Pi(e){var u;const t=new Ri,r=[];if(e.length===0)return Ti;const s=e.map(o=>[!/\*|\/:/.test(o[0]),...o]).sort(([o,l],[d,h])=>o?1:d?-1:l.length-h.length),i=Object.create(null);for(let o=0,l=-1,d=s.length;o<d;o++){const[h,x,b]=s[o];h?i[x]=[b.map(([p])=>[p,Object.create(null)]),fn]:l++;let w;try{w=t.insert(x,l,h)}catch(p){throw p===Be?new cn(x):p}h||(r[l]=b.map(([p,y])=>{const _=Object.create(null);for(y-=1;y>=0;y--){const[v,I]=w[y];_[v]=I}return[p,_]}))}const[n,a,c]=t.buildRegExp();for(let o=0,l=r.length;o<l;o++)for(let d=0,h=r[o].length;d<h;d++){const x=(u=r[o][d])==null?void 0:u[1];if(!x)continue;const b=Object.keys(x);for(let w=0,p=b.length;w<p;w++)x[b[w]]=c[x[b[w]]]}const f=[];for(const o in a)f[o]=r[a[o]];return[n,f,i]}function De(e,t){if(e){for(const r of Object.keys(e).sort((s,i)=>i.length-s.length))if(dn(r).test(t))return[...e[r]]}}var ye,be,Lt,ln,Ws,Oi=(Ws=class{constructor(){$(this,Lt);O(this,"name","RegExpRouter");$(this,ye);$(this,be);O(this,"match",vi);M(this,ye,{[U]:Object.create(null)}),M(this,be,{[U]:Object.create(null)})}add(e,t,r){var c;const s=g(this,ye),i=g(this,be);if(!s||!i)throw new Error(on);s[e]||[s,i].forEach(f=>{f[e]=Object.create(null),Object.keys(f[U]).forEach(u=>{f[e][u]=[...f[U][u]]})}),t==="/*"&&(t="*");const n=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const f=dn(t);e===U?Object.keys(s).forEach(u=>{var o;(o=s[u])[t]||(o[t]=De(s[u],t)||De(s[U],t)||[])}):(c=s[e])[t]||(c[t]=De(s[e],t)||De(s[U],t)||[]),Object.keys(s).forEach(u=>{(e===U||e===u)&&Object.keys(s[u]).forEach(o=>{f.test(o)&&s[u][o].push([r,n])})}),Object.keys(i).forEach(u=>{(e===U||e===u)&&Object.keys(i[u]).forEach(o=>f.test(o)&&i[u][o].push([r,n]))});return}const a=Zs(t)||[t];for(let f=0,u=a.length;f<u;f++){const o=a[f];Object.keys(i).forEach(l=>{var d;(e===U||e===l)&&((d=i[l])[o]||(d[o]=[...De(s[l],o)||De(s[U],o)||[]]),i[l][o].push([r,n-u+f+1]))})}}buildAllMatchers(){const e=Object.create(null);return Object.keys(g(this,be)).concat(Object.keys(g(this,ye))).forEach(t=>{e[t]||(e[t]=k(this,Lt,ln).call(this,t))}),M(this,ye,M(this,be,void 0)),Ii(),e}},ye=new WeakMap,be=new WeakMap,Lt=new WeakSet,ln=function(e){const t=[];let r=e===U;return[g(this,ye),g(this,be)].forEach(s=>{const i=s[e]?Object.keys(s[e]).map(n=>[n,s[e][n]]):[];i.length!==0?(r||(r=!0),t.push(...i)):e!==U&&t.push(...Object.keys(s[U]).map(n=>[n,s[U][n]]))}),r?Pi(t):null},Ws),ge,ue,Ks,Mi=(Ks=class{constructor(e){O(this,"name","SmartRouter");$(this,ge,[]);$(this,ue,[]);M(this,ge,e.routers)}add(e,t,r){if(!g(this,ue))throw new Error(on);g(this,ue).push([e,t,r])}match(e,t){if(!g(this,ue))throw new Error("Fatal error");const r=g(this,ge),s=g(this,ue),i=r.length;let n=0,a;for(;n<i;n++){const c=r[n];try{for(let f=0,u=s.length;f<u;f++)c.add(...s[f]);a=c.match(e,t)}catch(f){if(f instanceof cn)continue;throw f}this.match=c.match.bind(c),M(this,ge,[c]),M(this,ue,void 0);break}if(n===i)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(g(this,ue)||g(this,ge).length!==1)throw new Error("No active router has been determined yet.");return g(this,ge)[0]}},ge=new WeakMap,ue=new WeakMap,Ks),nt=Object.create(null),Di=e=>{for(const t in e)return!0;return!1},we,K,Ie,Ve,W,fe,Ae,ze,Ni=(ze=class{constructor(t,r,s){$(this,fe);$(this,we);$(this,K);$(this,Ie);$(this,Ve,0);$(this,W,nt);if(M(this,K,s||Object.create(null)),M(this,we,[]),t&&r){const i=Object.create(null);i[t]={handler:r,possibleKeys:[],score:0},M(this,we,[i])}M(this,Ie,[])}insert(t,r,s){M(this,Ve,++kr(this,Ve)._);let i=this;const n=oi(r),a=[];for(let c=0,f=n.length;c<f;c++){const u=n[c],o=n[c+1],l=fi(u,o),d=Array.isArray(l)?l[0]:u;if(d in g(i,K)){i=g(i,K)[d],l&&a.push(l[1]);continue}g(i,K)[d]=new ze,l&&(g(i,Ie).push(l),a.push(l[1])),i=g(i,K)[d]}return g(i,we).push({[t]:{handler:s,possibleKeys:a.filter((c,f,u)=>u.indexOf(c)===f),score:g(this,Ve)}}),i}search(t,r){var o;const s=[];M(this,W,nt);let n=[this];const a=Ys(r),c=[],f=a.length;let u=null;for(let l=0;l<f;l++){const d=a[l],h=l===f-1,x=[];for(let w=0,p=n.length;w<p;w++){const y=n[w],_=g(y,K)[d];_&&(M(_,W,g(y,W)),h?(g(_,K)["*"]&&k(this,fe,Ae).call(this,s,g(_,K)["*"],t,g(y,W)),k(this,fe,Ae).call(this,s,_,t,g(y,W))):x.push(_));for(let v=0,I=g(y,Ie).length;v<I;v++){const T=g(y,Ie)[v],m=g(y,W)===nt?{}:{...g(y,W)};if(T==="*"){const P=g(y,K)["*"];P&&(k(this,fe,Ae).call(this,s,P,t,g(y,W)),M(P,W,m),x.push(P));continue}const[S,E,C]=T;if(!d&&!(C instanceof RegExp))continue;const R=g(y,K)[S];if(C instanceof RegExp){if(u===null){u=new Array(f);let D=r[0]==="/"?1:0;for(let q=0;q<f;q++)u[q]=D,D+=a[q].length+1}const P=r.substring(u[l]),A=C.exec(P);if(A){if(m[E]=A[0],k(this,fe,Ae).call(this,s,R,t,g(y,W),m),Di(g(R,K))){M(R,W,m);const D=((o=A[0].match(/\//))==null?void 0:o.length)??0;(c[D]||(c[D]=[])).push(R)}continue}}(C===!0||C.test(d))&&(m[E]=d,h?(k(this,fe,Ae).call(this,s,R,t,m,g(y,W)),g(R,K)["*"]&&k(this,fe,Ae).call(this,s,g(R,K)["*"],t,m,g(y,W))):(M(R,W,m),x.push(R)))}}const b=c.shift();n=b?x.concat(b):x}return s.length>1&&s.sort((l,d)=>l.score-d.score),[s.map(({handler:l,params:d})=>[l,d])]}},we=new WeakMap,K=new WeakMap,Ie=new WeakMap,Ve=new WeakMap,W=new WeakMap,fe=new WeakSet,Ae=function(t,r,s,i,n){for(let a=0,c=g(r,we).length;a<c;a++){const f=g(r,we)[a],u=f[s]||f[U],o={};if(u!==void 0&&(u.params=Object.create(null),t.push(u),i!==nt||n&&n!==nt))for(let l=0,d=u.possibleKeys.length;l<d;l++){const h=u.possibleKeys[l],x=o[u.score];u.params[h]=n!=null&&n[h]&&!x?n[h]:i[h]??(n==null?void 0:n[h]),o[u.score]=!0}}},ze),Pe,Js,$i=(Js=class{constructor(){O(this,"name","TrieRouter");$(this,Pe);M(this,Pe,new Ni)}add(e,t,r){const s=Zs(t);if(s){for(let i=0,n=s.length;i<n;i++)g(this,Pe).insert(e,s[i],r);return}g(this,Pe).insert(e,t,r)}match(e,t){return g(this,Pe).search(e,t)}},Pe=new WeakMap,Js),tt=class extends Ei{constructor(e={}){super(e),this.router=e.router??new Mi({routers:[new Oi,new $i]})}},Li=e=>{const r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},s=(n=>typeof n=="string"?n==="*"?()=>n:a=>n===a?a:null:typeof n=="function"?n:a=>n.includes(a)?a:null)(r.origin),i=(n=>typeof n=="function"?n:Array.isArray(n)?()=>n:()=>[])(r.allowMethods);return async function(a,c){var o;function f(l,d){a.res.headers.set(l,d)}const u=await s(a.req.header("origin")||"",a);if(u&&f("Access-Control-Allow-Origin",u),r.credentials&&f("Access-Control-Allow-Credentials","true"),(o=r.exposeHeaders)!=null&&o.length&&f("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),a.req.method==="OPTIONS"){r.origin!=="*"&&f("Vary","Origin"),r.maxAge!=null&&f("Access-Control-Max-Age",r.maxAge.toString());const l=await i(a.req.header("origin")||"",a);l.length&&f("Access-Control-Allow-Methods",l.join(","));let d=r.allowHeaders;if(!(d!=null&&d.length)){const h=a.req.header("Access-Control-Request-Headers");h&&(d=h.split(/\s*,\s*/))}return d!=null&&d.length&&(f("Access-Control-Allow-Headers",d.join(",")),a.res.headers.append("Vary","Access-Control-Request-Headers")),a.res.headers.delete("Content-Length"),a.res.headers.delete("Content-Type"),new Response(null,{headers:a.res.headers,status:204,statusText:"No Content"})}await c(),r.origin!=="*"&&a.header("Vary","Origin",{append:!0})}};function qi(){const{process:e,Deno:t}=globalThis;return!(typeof(t==null?void 0:t.noColor)=="boolean"?t.noColor:e!==void 0?"NO_COLOR"in(e==null?void 0:e.env):!1)}async function ki(){const{navigator:e}=globalThis,t="cloudflare:workers";return!(e!==void 0&&e.userAgent==="Cloudflare-Workers"?await(async()=>{try{return"NO_COLOR"in((await import(t)).env??{})}catch{return!1}})():!qi())}var Bi=e=>{const[t,r]=[",","."];return e.map(i=>i.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+t)).join(r)},Hi=e=>{const t=Date.now()-e;return Bi([t<1e3?t+"ms":Math.round(t/1e3)+"s"])},ji=async e=>{if(await ki())switch(e/100|0){case 5:return`\x1B[31m${e}\x1B[0m`;case 4:return`\x1B[33m${e}\x1B[0m`;case 3:return`\x1B[36m${e}\x1B[0m`;case 2:return`\x1B[32m${e}\x1B[0m`}return`${e}`};async function Qr(e,t,r,s,i=0,n){const a=t==="<--"?`${t} ${r} ${s}`:`${t} ${r} ${s} ${await ji(i)} ${n}`;e(a)}var Ui=(e=console.log)=>async function(r,s){const{method:i,url:n}=r.req,a=n.slice(n.indexOf("/",8));await Qr(e,"<--",i,a);const c=Date.now();await s(),await Qr(e,"-->",i,a,r.res.status,Hi(c))},Fi=(e,t=Wi)=>{const r=/\.([a-zA-Z0-9]+?)$/,s=e.match(r);if(!s)return;let i=t[s[1]];return i&&i.startsWith("text")&&(i+="; charset=utf-8"),i},Qi={aac:"audio/aac",avi:"video/x-msvideo",avif:"image/avif",av1:"video/av1",bin:"application/octet-stream",bmp:"image/bmp",css:"text/css",csv:"text/csv",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",map:"application/json",mid:"audio/x-midi",midi:"audio/x-midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",pdf:"application/pdf",png:"image/png",rtf:"application/rtf",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",wasm:"application/wasm",webm:"video/webm",weba:"audio/webm",webmanifest:"application/manifest+json",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xml:"application/xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2",gltf:"model/gltf+json",glb:"model/gltf-binary"},Wi=Qi,Ki=/^\s*(?:text\/[^;\s]+|application\/(?:javascript|json|xml|xml-dtd|ecmascript|dart|postscript|rtf|tar|toml|vnd\.dart|vnd\.ms-fontobject|vnd\.ms-opentype|wasm|x-httpd-php|x-javascript|x-ns-proxy-autoconfig|x-sh|x-tar|x-virtualbox-hdd|x-virtualbox-ova|x-virtualbox-ovf|x-virtualbox-vbox|x-virtualbox-vdi|x-virtualbox-vhd|x-virtualbox-vmdk|x-www-form-urlencoded)|font\/(?:otf|ttf)|image\/(?:bmp|vnd\.adobe\.photoshop|vnd\.microsoft\.icon|vnd\.ms-dds|x-icon|x-ms-bmp)|message\/rfc822|model\/gltf-binary|x-shader\/x-fragment|x-shader\/x-vertex|[^;\s]+?\+(?:json|text|xml|yaml))(?:[;\s]|$)/i,Cr={br:".br",zstd:".zst",gzip:".gz"},Ji=Object.keys(Cr),Gi=()=>{const[e,t]=zn.node.split(".").map(r=>parseInt(r));return e>=23||e===22&&t>=7||e===20&&t>=18},Vi=Gi(),Wr=e=>Vi?Yn.toWeb(e):new ReadableStream({start(r){e.on("data",s=>{r.enqueue(s)}),e.on("error",s=>{r.error(s)}),e.on("end",()=>{r.close()})},cancel(){e.destroy()}}),Ft=e=>{let t;try{t=Gn(e)}catch{}return t},zi=(e={root:""})=>{const t=e.root||"",r=e.path;return t!==""&&!Jn(t)&&console.error(`serveStatic: root path '${t}' is not found, are you sure it's correct?`),async(s,i)=>{var d,h,x,b;if(s.finalized)return i();let n;if(r)n=r;else try{if(n=decodeURIComponent(s.req.path),/(?:^|[\/\\])\.\.(?:$|[\/\\])/.test(n))throw new Error}catch{return await((d=e.onNotFound)==null?void 0:d.call(e,s.req.path,s)),i()}let a=Hr(t,!r&&e.rewriteRequestPath?e.rewriteRequestPath(n,s):n),c=Ft(a);if(c&&c.isDirectory()){const w=e.index??"index.html";a=Hr(a,w),c=Ft(a)}if(!c)return await((h=e.onNotFound)==null?void 0:h.call(e,a,s)),i();const f=Fi(a);if(s.header("Content-Type",f||"application/octet-stream"),e.precompressed&&(!f||Ki.test(f))){const w=new Set((x=s.req.header("Accept-Encoding"))==null?void 0:x.split(",").map(p=>p.trim()));for(const p of Ji){if(!w.has(p))continue;const y=Ft(a+Cr[p]);if(y){s.header("Content-Encoding",p),s.header("Vary","Accept-Encoding",{append:!0}),c=y,a=a+Cr[p];break}}}let u;const o=c.size,l=s.req.header("range")||"";if(s.req.method=="HEAD"||s.req.method=="OPTIONS")s.header("Content-Length",o.toString()),s.status(200),u=s.body(null);else if(!l)s.header("Content-Length",o.toString()),u=s.body(Wr(Br(a)),200);else{s.header("Accept-Ranges","bytes"),s.header("Date",c.birthtime.toUTCString());const w=l.replace(/bytes=/,"").split("-",2),p=parseInt(w[0],10)||0;let y=parseInt(w[1],10)||o-1;o<y-p+1&&(y=o-1);const _=y-p+1,v=Br(a,{start:p,end:y});s.header("Content-Length",_.toString()),s.header("Content-Range",`bytes ${p}-${y}/${c.size}`),u=s.body(Wr(v),206)}return await((b=e.onFound)==null?void 0:b.call(e,a,s)),u}},Mr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Yi(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Xi(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var r=function s(){return this instanceof s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(s){var i=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(r,s,i.get?i:{enumerable:!0,get:function(){return e[s]}})}),r}var Qt={exports:{}},Wt={exports:{}},Ne={},Kt={},Kr;function hn(){if(Kr)return Kt;Kr=1,Kt.parse=function(r,s){return new e(r,s).parse()};class e{constructor(s,i){this.source=s,this.transform=i||t,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var s=this.source[this.position++];return s==="\\"?{value:this.source[this.position++],escaped:!0}:{value:s,escaped:!1}}record(s){this.recorded.push(s)}newEntry(s){var i;(this.recorded.length>0||s)&&(i=this.recorded.join(""),i==="NULL"&&!s&&(i=null),i!==null&&(i=this.transform(i)),this.entries.push(i),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var s=this.nextCharacter();if(s.value==="=")break}}parse(s){var i,n,a;for(this.consumeDimensions();!this.isEof();)if(i=this.nextCharacter(),i.value==="{"&&!a)this.dimension++,this.dimension>1&&(n=new e(this.source.substr(this.position-1),this.transform),this.entries.push(n.parse(!0)),this.position+=n.position-2);else if(i.value==="}"&&!a){if(this.dimension--,!this.dimension&&(this.newEntry(),s))return this.entries}else i.value==='"'&&!i.escaped?(a&&this.newEntry(!0),a=!a):i.value===","&&!a?this.newEntry():this.record(i.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}}function t(r){return r}return Kt}var Jt,Jr;function pn(){if(Jr)return Jt;Jr=1;var e=hn();return Jt={create:function(t,r){return{parse:function(){return e.parse(t,r)}}}},Jt}var Gt,Gr;function Zi(){if(Gr)return Gt;Gr=1;var e=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,t=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,r=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,s=/^-?infinity$/;Gt=function(u){if(s.test(u))return Number(u.replace("i","I"));var o=e.exec(u);if(!o)return i(u)||null;var l=!!o[8],d=parseInt(o[1],10);l&&(d=a(d));var h=parseInt(o[2],10)-1,x=o[3],b=parseInt(o[4],10),w=parseInt(o[5],10),p=parseInt(o[6],10),y=o[7];y=y?1e3*parseFloat(y):0;var _,v=n(u);return v!=null?(_=new Date(Date.UTC(d,h,x,b,w,p,y)),c(d)&&_.setUTCFullYear(d),v!==0&&_.setTime(_.getTime()-v)):(_=new Date(d,h,x,b,w,p,y),c(d)&&_.setFullYear(d)),_};function i(f){var u=t.exec(f);if(u){var o=parseInt(u[1],10),l=!!u[4];l&&(o=a(o));var d=parseInt(u[2],10)-1,h=u[3],x=new Date(o,d,h);return c(o)&&x.setFullYear(o),x}}function n(f){if(f.endsWith("+00"))return 0;var u=r.exec(f.split(" ")[1]);if(u){var o=u[1];if(o==="Z")return 0;var l=o==="-"?-1:1,d=parseInt(u[2],10)*3600+parseInt(u[3]||0,10)*60+parseInt(u[4]||0,10);return d*l*1e3}}function a(f){return-(f-1)}function c(f){return f>=0&&f<100}return Gt}var Vt,Vr;function ea(){if(Vr)return Vt;Vr=1,Vt=t;var e=Object.prototype.hasOwnProperty;function t(r){for(var s=1;s<arguments.length;s++){var i=arguments[s];for(var n in i)e.call(i,n)&&(r[n]=i[n])}return r}return Vt}var zt,zr;function ta(){if(zr)return zt;zr=1;var e=ea();zt=t;function t(w){if(!(this instanceof t))return new t(w);e(this,b(w))}var r=["seconds","minutes","hours","days","months","years"];t.prototype.toPostgres=function(){var w=r.filter(this.hasOwnProperty,this);return this.milliseconds&&w.indexOf("seconds")<0&&w.push("seconds"),w.length===0?"0":w.map(function(p){var y=this[p]||0;return p==="seconds"&&this.milliseconds&&(y=(y+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),y+" "+p},this).join(" ")};var s={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},i=["years","months","days"],n=["hours","minutes","seconds"];t.prototype.toISOString=t.prototype.toISO=function(){var w=i.map(y,this).join(""),p=n.map(y,this).join("");return"P"+w+"T"+p;function y(_){var v=this[_]||0;return _==="seconds"&&this.milliseconds&&(v=(v+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),v+s[_]}};var a="([+-]?\\d+)",c=a+"\\s+years?",f=a+"\\s+mons?",u=a+"\\s+days?",o="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",l=new RegExp([c,f,u,o].map(function(w){return"("+w+")?"}).join("\\s*")),d={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},h=["hours","minutes","seconds","milliseconds"];function x(w){var p=w+"000000".slice(w.length);return parseInt(p,10)/1e3}function b(w){if(!w)return{};var p=l.exec(w),y=p[8]==="-";return Object.keys(d).reduce(function(_,v){var I=d[v],T=p[I];return!T||(T=v==="milliseconds"?x(T):parseInt(T,10),!T)||(y&&~h.indexOf(v)&&(T*=-1),_[v]=T),_},{})}return zt}var Yt,Yr;function ra(){if(Yr)return Yt;Yr=1;var e=Buffer.from||Buffer;return Yt=function(r){if(/^\\x/.test(r))return e(r.substr(2),"hex");for(var s="",i=0;i<r.length;)if(r[i]!=="\\")s+=r[i],++i;else if(/[0-7]{3}/.test(r.substr(i+1,3)))s+=String.fromCharCode(parseInt(r.substr(i+1,3),8)),i+=4;else{for(var n=1;i+n<r.length&&r[i+n]==="\\";)n++;for(var a=0;a<Math.floor(n/2);++a)s+="\\";i+=Math.floor(n/2)*2}return e(s,"binary")},Yt}var Xt,Xr;function sa(){if(Xr)return Xt;Xr=1;var e=hn(),t=pn(),r=Zi(),s=ta(),i=ra();function n(m){return function(E){return E===null?E:m(E)}}function a(m){return m===null?m:m==="TRUE"||m==="t"||m==="true"||m==="y"||m==="yes"||m==="on"||m==="1"}function c(m){return m?e.parse(m,a):null}function f(m){return parseInt(m,10)}function u(m){return m?e.parse(m,n(f)):null}function o(m){return m?e.parse(m,n(function(S){return y(S).trim()})):null}var l=function(m){if(!m)return null;var S=t.create(m,function(E){return E!==null&&(E=v(E)),E});return S.parse()},d=function(m){if(!m)return null;var S=t.create(m,function(E){return E!==null&&(E=parseFloat(E)),E});return S.parse()},h=function(m){if(!m)return null;var S=t.create(m);return S.parse()},x=function(m){if(!m)return null;var S=t.create(m,function(E){return E!==null&&(E=r(E)),E});return S.parse()},b=function(m){if(!m)return null;var S=t.create(m,function(E){return E!==null&&(E=s(E)),E});return S.parse()},w=function(m){return m?e.parse(m,n(i)):null},p=function(m){return parseInt(m,10)},y=function(m){var S=String(m);return/^\d+$/.test(S)?S:m},_=function(m){return m?e.parse(m,n(JSON.parse)):null},v=function(m){return m[0]!=="("?null:(m=m.substring(1,m.length-1).split(","),{x:parseFloat(m[0]),y:parseFloat(m[1])})},I=function(m){if(m[0]!=="<"&&m[1]!=="(")return null;for(var S="(",E="",C=!1,R=2;R<m.length-1;R++){if(C||(S+=m[R]),m[R]===")"){C=!0;continue}else if(!C)continue;m[R]!==","&&(E+=m[R])}var P=v(S);return P.radius=parseFloat(E),P},T=function(m){m(20,y),m(21,p),m(23,p),m(26,p),m(700,parseFloat),m(701,parseFloat),m(16,a),m(1082,r),m(1114,r),m(1184,r),m(600,v),m(651,h),m(718,I),m(1e3,c),m(1001,w),m(1005,u),m(1007,u),m(1028,u),m(1016,o),m(1017,l),m(1021,d),m(1022,d),m(1231,d),m(1014,h),m(1015,h),m(1008,h),m(1009,h),m(1040,h),m(1041,h),m(1115,x),m(1182,x),m(1185,x),m(1186,s),m(1187,b),m(17,i),m(114,JSON.parse.bind(JSON)),m(3802,JSON.parse.bind(JSON)),m(199,_),m(3807,_),m(3907,h),m(2951,h),m(791,h),m(1183,h),m(1270,h)};return Xt={init:T},Xt}var Zt,Zr;function na(){if(Zr)return Zt;Zr=1;var e=1e6;function t(r){var s=r.readInt32BE(0),i=r.readUInt32BE(4),n="";s<0&&(s=~s+(i===0),i=~i+1>>>0,n="-");var a="",c,f,u,o,l,d;{if(c=s%e,s=s/e>>>0,f=4294967296*c+i,i=f/e>>>0,u=""+(f-e*i),i===0&&s===0)return n+u+a;for(o="",l=6-u.length,d=0;d<l;d++)o+="0";a=o+u+a}{if(c=s%e,s=s/e>>>0,f=4294967296*c+i,i=f/e>>>0,u=""+(f-e*i),i===0&&s===0)return n+u+a;for(o="",l=6-u.length,d=0;d<l;d++)o+="0";a=o+u+a}{if(c=s%e,s=s/e>>>0,f=4294967296*c+i,i=f/e>>>0,u=""+(f-e*i),i===0&&s===0)return n+u+a;for(o="",l=6-u.length,d=0;d<l;d++)o+="0";a=o+u+a}return c=s%e,f=4294967296*c+i,u=""+f%e,n+u+a}return Zt=t,Zt}var er,es;function ia(){if(es)return er;es=1;var e=na(),t=function(h,x,b,w,p){b=b||0,w=w||!1,p=p||function(C,R,P){return C*Math.pow(2,P)+R};var y=b>>3,_=function(C){return w?~C&255:C},v=255,I=8-b%8;x<I&&(v=255<<8-x&255,I=x),b&&(v=v>>b%8);var T=0;b%8+x>=8&&(T=p(0,_(h[y])&v,I));for(var m=x+b>>3,S=y+1;S<m;S++)T=p(T,_(h[S]),8);var E=(x+b)%8;return E>0&&(T=p(T,_(h[m])>>8-E,E)),T},r=function(h,x,b){var w=Math.pow(2,b-1)-1,p=t(h,1),y=t(h,b,1);if(y===0)return 0;var _=1,v=function(T,m,S){T===0&&(T=1);for(var E=1;E<=S;E++)_/=2,(m&1<<S-E)>0&&(T+=_);return T},I=t(h,x,b+1,!1,v);return y==Math.pow(2,b+1)-1?I===0?p===0?1/0:-1/0:NaN:(p===0?1:-1)*Math.pow(2,y-w)*I},s=function(h){return t(h,1)==1?-1*(t(h,15,1,!0)+1):t(h,15,1)},i=function(h){return t(h,1)==1?-1*(t(h,31,1,!0)+1):t(h,31,1)},n=function(h){return r(h,23,8)},a=function(h){return r(h,52,11)},c=function(h){var x=t(h,16,32);if(x==49152)return NaN;for(var b=Math.pow(1e4,t(h,16,16)),w=0,p=t(h,16),y=0;y<p;y++)w+=t(h,16,64+16*y)*b,b/=1e4;var _=Math.pow(10,t(h,16,48));return(x===0?1:-1)*Math.round(w*_)/_},f=function(h,x){var b=t(x,1),w=t(x,63,1),p=new Date((b===0?1:-1)*w/1e3+9466848e5);return h||p.setTime(p.getTime()+p.getTimezoneOffset()*6e4),p.usec=w%1e3,p.getMicroSeconds=function(){return this.usec},p.setMicroSeconds=function(y){this.usec=y},p.getUTCMicroSeconds=function(){return this.usec},p},u=function(h){var x=t(h,32);t(h,32,32);for(var b=t(h,32,64),w=96,p=[],y=0;y<x;y++)p[y]=t(h,32,w),w+=32,w+=32;var _=function(I){var T=t(h,32,w);if(w+=32,T==4294967295)return null;var m;if(I==23||I==20)return m=t(h,T*8,w),w+=T*8,m;if(I==25)return m=h.toString(this.encoding,w>>3,(w+=T<<3)>>3),m;console.log("ERROR: ElementType not implemented: "+I)},v=function(I,T){var m=[],S;if(I.length>1){var E=I.shift();for(S=0;S<E;S++)m[S]=v(I,T);I.unshift(E)}else for(S=0;S<I[0];S++)m[S]=_(T);return m};return v(p,b)},o=function(h){return h.toString("utf8")},l=function(h){return h===null?null:t(h,8)>0},d=function(h){h(20,e),h(21,s),h(23,i),h(26,i),h(1700,c),h(700,n),h(701,a),h(16,l),h(1114,f.bind(null,!1)),h(1184,f.bind(null,!0)),h(1e3,u),h(1007,u),h(1016,u),h(1008,u),h(1009,u),h(25,o)};return er={init:d},er}var tr,ts;function aa(){return ts||(ts=1,tr={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}),tr}var rs;function qt(){if(rs)return Ne;rs=1;var e=sa(),t=ia(),r=pn(),s=aa();Ne.getTypeParser=a,Ne.setTypeParser=c,Ne.arrayParser=r,Ne.builtins=s;var i={text:{},binary:{}};function n(f){return String(f)}function a(f,u){return u=u||"text",i[u]&&i[u][f]||n}function c(f,u,o){typeof u=="function"&&(o=u,u="text"),i[u][f]=o}return e.init(function(f,u){i.text[f]=u}),t.init(function(f,u){i.binary[f]=u}),Ne}var ss;function kt(){return ss||(ss=1,(function(e){var t={};let r;try{r=process.platform==="win32"?t.USERNAME:t.USER}catch{}e.exports={host:"localhost",user:r,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};const s=qt(),i=s.getTypeParser(20,"text"),n=s.getTypeParser(1016,"text");e.exports.__defineSetter__("parseInt8",function(a){s.setTypeParser(20,"text",a?s.getTypeParser(23,"text"):i),s.setTypeParser(1016,"text",a?s.getTypeParser(1007,"text"):n)})})(Wt)),Wt.exports}var rr,ns;function lt(){if(ns)return rr;ns=1;const e=kt(),t=Ze,{isDate:r}=t.types||t;function s(d){return'"'+d.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function i(d){let h="{";for(let x=0;x<d.length;x++)if(x>0&&(h=h+","),d[x]===null||typeof d[x]>"u")h=h+"NULL";else if(Array.isArray(d[x]))h=h+i(d[x]);else if(ArrayBuffer.isView(d[x])){let b=d[x];if(!(b instanceof Buffer)){const w=Buffer.from(b.buffer,b.byteOffset,b.byteLength);w.length===b.byteLength?b=w:b=w.slice(b.byteOffset,b.byteOffset+b.byteLength)}h+="\\\\x"+b.toString("hex")}else h+=s(n(d[x]));return h=h+"}",h}const n=function(d,h){if(d==null)return null;if(typeof d=="object"){if(d instanceof Buffer)return d;if(ArrayBuffer.isView(d)){const x=Buffer.from(d.buffer,d.byteOffset,d.byteLength);return x.length===d.byteLength?x:x.slice(d.byteOffset,d.byteOffset+d.byteLength)}return r(d)?e.parseInputDatesAsUTC?f(d):c(d):Array.isArray(d)?i(d):a(d,h)}return d.toString()};function a(d,h){if(d&&typeof d.toPostgres=="function"){if(h=h||[],h.indexOf(d)!==-1)throw new Error('circular reference detected while preparing "'+d+'" for query');return h.push(d),n(d.toPostgres(n),h)}return JSON.stringify(d)}function c(d){let h=-d.getTimezoneOffset(),x=d.getFullYear();const b=x<1;b&&(x=Math.abs(x)+1);let w=String(x).padStart(4,"0")+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0")+"T"+String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0")+":"+String(d.getSeconds()).padStart(2,"0")+"."+String(d.getMilliseconds()).padStart(3,"0");return h<0?(w+="-",h*=-1):w+="+",w+=String(Math.floor(h/60)).padStart(2,"0")+":"+String(h%60).padStart(2,"0"),b&&(w+=" BC"),w}function f(d){let h=d.getUTCFullYear();const x=h<1;x&&(h=Math.abs(h)+1);let b=String(h).padStart(4,"0")+"-"+String(d.getUTCMonth()+1).padStart(2,"0")+"-"+String(d.getUTCDate()).padStart(2,"0")+"T"+String(d.getUTCHours()).padStart(2,"0")+":"+String(d.getUTCMinutes()).padStart(2,"0")+":"+String(d.getUTCSeconds()).padStart(2,"0")+"."+String(d.getUTCMilliseconds()).padStart(3,"0");return b+="+00:00",x&&(b+=" BC"),b}function u(d,h,x){return d=typeof d=="string"?{text:d}:d,h&&(typeof h=="function"?d.callback=h:d.values=h),x&&(d.callback=x),d}return rr={prepareValue:function(h){return n(h)},normalizeQueryConfig:u,escapeIdentifier:function(d){return'"'+d.replace(/"/g,'""')+'"'},escapeLiteral:function(d){let h=!1,x="'";if(d==null||typeof d!="string")return"''";for(let b=0;b<d.length;b++){const w=d[b];w==="'"?x+=w+w:w==="\\"?(x+=w+w,h=!0):x+=w}return x+="'",h===!0&&(x=" E"+x),x}},rr}var Ct={exports:{}},sr,is;function oa(){if(is)return sr;is=1;const e=Pr;function t(c){return e.createHash("md5").update(c,"utf-8").digest("hex")}function r(c,f,u){const o=t(f+c);return"md5"+t(Buffer.concat([Buffer.from(o),u]))}function s(c){return e.createHash("sha256").update(c).digest()}function i(c,f){return c=c.replace(/(\D)-/,"$1"),e.createHash(c).update(f).digest()}function n(c,f){return e.createHmac("sha256",c).update(f).digest()}async function a(c,f,u){return e.pbkdf2Sync(c,f,u,32,"sha256")}return sr={postgresMd5PasswordHash:r,randomBytes:e.randomBytes,deriveKey:a,sha256:s,hashByName:i,hmacSha256:n,md5:t},sr}var nr,as;function ca(){if(as)return nr;as=1;const e=Pr;nr={postgresMd5PasswordHash:a,randomBytes:i,deriveKey:o,sha256:c,hashByName:f,hmacSha256:u,md5:n};const t=e.webcrypto||globalThis.crypto,r=t.subtle,s=new TextEncoder;function i(l){return t.getRandomValues(Buffer.alloc(l))}async function n(l){try{return e.createHash("md5").update(l,"utf-8").digest("hex")}catch{const h=typeof l=="string"?s.encode(l):l,x=await r.digest("MD5",h);return Array.from(new Uint8Array(x)).map(b=>b.toString(16).padStart(2,"0")).join("")}}async function a(l,d,h){const x=await n(d+l);return"md5"+await n(Buffer.concat([Buffer.from(x),h]))}async function c(l){return await r.digest("SHA-256",l)}async function f(l,d){return await r.digest(l,d)}async function u(l,d){const h=await r.importKey("raw",l,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await r.sign("HMAC",h,s.encode(d))}async function o(l,d,h){const x=await r.importKey("raw",s.encode(l),"PBKDF2",!1,["deriveBits"]),b={name:"PBKDF2",hash:"SHA-256",salt:d,iterations:h};return await r.deriveBits(b,x,256,["deriveBits"])}return nr}var os;function xn(){return os||(os=1,parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15?Ct.exports=oa():Ct.exports=ca()),Ct.exports}var ir,cs;function ua(){if(cs)return ir;cs=1;function e(n,a){return new Error("SASL channel binding: "+n+" when parsing public certificate "+a.toString("base64"))}function t(n,a){let c=n[a++];if(c<128)return{length:c,index:a};const f=c&127;if(f>4)throw e("bad length",n);c=0;for(let u=0;u<f;u++)c=c<<8|n[a++];return{length:c,index:a}}function r(n,a){if(n[a++]!==6)throw e("non-OID data",n);const{length:c,index:f}=t(n,a);a=f;const u=a+c,o=n[a++];let l=(o/40>>0)+"."+o%40;for(;a<u;){let d=0;for(;a<u;){const h=n[a++];if(d=d<<7|h&127,h<128)break}l+="."+d}return{oid:l,index:a}}function s(n,a){if(n[a++]!==48)throw e("non-sequence data",n);return t(n,a)}function i(n,a){a===void 0&&(a=0),a=s(n,a).index;const{length:c,index:f}=s(n,a);a=f+c,a=s(n,a).index;const{oid:u,index:o}=r(n,a);switch(u){case"1.2.840.113549.1.1.4":return"MD5";case"1.2.840.113549.1.1.5":return"SHA-1";case"1.2.840.113549.1.1.11":return"SHA-256";case"1.2.840.113549.1.1.12":return"SHA-384";case"1.2.840.113549.1.1.13":return"SHA-512";case"1.2.840.113549.1.1.14":return"SHA-224";case"1.2.840.113549.1.1.15":return"SHA512-224";case"1.2.840.113549.1.1.16":return"SHA512-256";case"1.2.840.10045.4.1":return"SHA-1";case"1.2.840.10045.4.3.1":return"SHA-224";case"1.2.840.10045.4.3.2":return"SHA-256";case"1.2.840.10045.4.3.3":return"SHA-384";case"1.2.840.10045.4.3.4":return"SHA-512";case"1.2.840.113549.1.1.10":{if(a=o,a=s(n,a).index,n[a++]!==160)throw e("non-tag data",n);a=t(n,a).index,a=s(n,a).index;const{oid:l}=r(n,a);switch(l){case"1.2.840.113549.2.5":return"MD5";case"1.3.14.3.2.26":return"SHA-1";case"2.16.840.1.101.3.4.2.1":return"SHA-256";case"2.16.840.1.101.3.4.2.2":return"SHA-384";case"2.16.840.1.101.3.4.2.3":return"SHA-512"}throw e("unknown hash OID "+l,n)}case"1.3.101.110":case"1.3.101.112":return"SHA-512";case"1.3.101.111":case"1.3.101.113":throw e("Ed448 certificate channel binding is not currently supported by Postgres")}throw e("unknown OID "+u,n)}return ir={signatureAlgorithmHashFromCertificate:i},ir}var ar,us;function fa(){if(us)return ar;us=1;const e=xn(),{signatureAlgorithmHashFromCertificate:t}=ua();function r(l,d){const h=["SCRAM-SHA-256"];d&&h.unshift("SCRAM-SHA-256-PLUS");const x=h.find(p=>l.includes(p));if(!x)throw new Error("SASL: Only mechanism(s) "+h.join(" and ")+" are supported");if(x==="SCRAM-SHA-256-PLUS"&&typeof d.getPeerCertificate!="function")throw new Error("SASL: Mechanism SCRAM-SHA-256-PLUS requires a certificate");const b=e.randomBytes(18).toString("base64");return{mechanism:x,clientNonce:b,response:(x==="SCRAM-SHA-256-PLUS"?"p=tls-server-end-point":d?"y":"n")+",,n=*,r="+b,message:"SASLInitialResponse"}}async function s(l,d,h,x){if(l.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof d!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(d==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof h!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");const b=f(h);if(b.nonce.startsWith(l.clientNonce)){if(b.nonce.length===l.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");const w="n=*,r="+l.clientNonce,p="r="+b.nonce+",s="+b.salt+",i="+b.iteration;let y=x?"eSws":"biws";if(l.mechanism==="SCRAM-SHA-256-PLUS"){const A=x.getPeerCertificate().raw;let D=t(A);(D==="MD5"||D==="SHA-1")&&(D="SHA-256");const q=await e.hashByName(D,A);y=Buffer.concat([Buffer.from("p=tls-server-end-point,,"),Buffer.from(q)]).toString("base64")}const _="c="+y+",r="+b.nonce,v=w+","+p+","+_,I=Buffer.from(b.salt,"base64"),T=await e.deriveKey(d,I,b.iteration),m=await e.hmacSha256(T,"Client Key"),S=await e.sha256(m),E=await e.hmacSha256(S,v),C=o(Buffer.from(m),Buffer.from(E)).toString("base64"),R=await e.hmacSha256(T,"Server Key"),P=await e.hmacSha256(R,v);l.message="SASLResponse",l.serverSignature=Buffer.from(P).toString("base64"),l.response=_+",p="+C}function i(l,d){if(l.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof d!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");const{serverSignature:h}=u(d);if(h!==l.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}function n(l){if(typeof l!="string")throw new TypeError("SASL: text must be a string");return l.split("").map((d,h)=>l.charCodeAt(h)).every(d=>d>=33&&d<=43||d>=45&&d<=126)}function a(l){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(l)}function c(l){if(typeof l!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(l.split(",").map(d=>{if(!/^.=/.test(d))throw new Error("SASL: Invalid attribute pair entry");const h=d[0],x=d.substring(2);return[h,x]}))}function f(l){const d=c(l),h=d.get("r");if(h){if(!n(h))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");const x=d.get("s");if(x){if(!a(x))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");const b=d.get("i");if(b){if(!/^[1-9][0-9]*$/.test(b))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");const w=parseInt(b,10);return{nonce:h,salt:x,iteration:w}}function u(l){const h=c(l).get("v");if(h){if(!a(h))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:h}}function o(l,d){if(!Buffer.isBuffer(l))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(d))throw new TypeError("second argument must be a Buffer");if(l.length!==d.length)throw new Error("Buffer lengths must match");if(l.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(l.map((h,x)=>l[x]^d[x]))}return ar={startSession:r,continueSession:s,finalizeSession:i},ar}var or,fs;function Dr(){if(fs)return or;fs=1;const e=qt();function t(r){this._types=r||e,this.text={},this.binary={}}return t.prototype.getOverrides=function(r){switch(r){case"text":return this.text;case"binary":return this.binary;default:return{}}},t.prototype.setTypeParser=function(r,s,i){typeof s=="function"&&(i=s,s="text"),this.getOverrides(s)[r]=i},t.prototype.getTypeParser=function(r,s){return s=s||"text",this.getOverrides(s)[r]||this._types.getTypeParser(r,s)},or=t,or}var cr,ds;function da(){if(ds)return cr;ds=1;function e(n,a={}){if(n.charAt(0)==="/"){const h=n.split(" ");return{host:h[0],database:h[1]}}const c={};let f,u=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(n)&&(n=encodeURI(n).replace(/%25(\d\d)/g,"%$1"));try{try{f=new URL(n,"postgres://base")}catch{f=new URL(n.replace("@/","@___DUMMY___/"),"postgres://base"),u=!0}}catch(h){throw h.input&&(h.input="*****REDACTED*****"),h}for(const h of f.searchParams.entries())c[h[0]]=h[1];if(c.user=c.user||decodeURIComponent(f.username),c.password=c.password||decodeURIComponent(f.password),f.protocol=="socket:")return c.host=decodeURI(f.pathname),c.database=f.searchParams.get("db"),c.client_encoding=f.searchParams.get("encoding"),c;const o=u?"":f.hostname;c.host?o&&/^%2f/i.test(o)&&(f.pathname=o+f.pathname):c.host=decodeURIComponent(o),c.port||(c.port=f.port);const l=f.pathname.slice(1)||null;c.database=l?decodeURI(l):null,(c.ssl==="true"||c.ssl==="1")&&(c.ssl=!0),c.ssl==="0"&&(c.ssl=!1),(c.sslcert||c.sslkey||c.sslrootcert||c.sslmode)&&(c.ssl={});const d=c.sslcert||c.sslkey||c.sslrootcert?Gs:null;if(c.sslcert&&(c.ssl.cert=d.readFileSync(c.sslcert).toString()),c.sslkey&&(c.ssl.key=d.readFileSync(c.sslkey).toString()),c.sslrootcert&&(c.ssl.ca=d.readFileSync(c.sslrootcert).toString()),a.useLibpqCompat&&c.uselibpqcompat)throw new Error("Both useLibpqCompat and uselibpqcompat are set. Please use only one of them.");if(c.uselibpqcompat==="true"||a.useLibpqCompat)switch(c.sslmode){case"disable":{c.ssl=!1;break}case"prefer":{c.ssl.rejectUnauthorized=!1;break}case"require":{c.sslrootcert?c.ssl.checkServerIdentity=function(){}:c.ssl.rejectUnauthorized=!1;break}case"verify-ca":{if(!c.ssl.ca)throw new Error("SECURITY WARNING: Using sslmode=verify-ca requires specifying a CA with sslrootcert. If a public CA is used, verify-ca allows connections to a server that somebody else may have registered with the CA, making you vulnerable to Man-in-the-Middle attacks. Either specify a custom CA certificate with sslrootcert parameter or use sslmode=verify-full for proper security.");c.ssl.checkServerIdentity=function(){};break}}else switch(c.sslmode){case"disable":{c.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":{c.sslmode!=="verify-full"&&i(c.sslmode);break}case"no-verify":{c.ssl.rejectUnauthorized=!1;break}}return c}function t(n){return Object.entries(n).reduce((c,[f,u])=>(u!=null&&(c[f]=u),c),{})}function r(n){return Object.entries(n).reduce((c,[f,u])=>{if(f==="ssl"){const o=u;typeof o=="boolean"&&(c[f]=o),typeof o=="object"&&(c[f]=t(o))}else if(u!=null)if(f==="port"){if(u!==""){const o=parseInt(u,10);if(isNaN(o))throw new Error(`Invalid ${f}: ${u}`);c[f]=o}}else c[f]=u;return c},{})}function s(n){return r(e(n))}function i(n){!i.warned&&typeof process<"u"&&process.emitWarning&&(i.warned=!0,process.emitWarning(`SECURITY WARNING: The SSL modes 'prefer', 'require', and 'verify-ca' are treated as aliases for 'verify-full'.
In the next major version (pg-connection-string v3.0.0 and pg v9.0.0), these modes will adopt standard libpq semantics, which have weaker security guarantees.

To prepare for this change:
- If you want the current behavior, explicitly use 'sslmode=verify-full'
- If you want libpq compatibility now, use 'uselibpqcompat=true&sslmode=${n}'

See https://www.postgresql.org/docs/current/libpq-ssl.html for libpq SSL mode definitions.`))}return cr=e,e.parse=e,e.toClientConfig=r,e.parseIntoClientConfig=s,cr}var ur,ls;function mn(){if(ls)return ur;ls=1;var e={};const t=Xn,r=kt(),s=da().parse,i=function(u,o,l){return o[u]?o[u]:(l===void 0?l=e["PG"+u.toUpperCase()]:l===!1||(l=e[l]),l||r[u])},n=function(){switch(e.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return r.ssl},a=function(u){return"'"+(""+u).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},c=function(u,o,l){const d=o[l];d!=null&&u.push(l+"="+a(d))};class f{constructor(o){o=typeof o=="string"?s(o):o||{},o.connectionString&&(o=Object.assign({},o,s(o.connectionString))),this.user=i("user",o),this.database=i("database",o),this.database===void 0&&(this.database=this.user),this.port=parseInt(i("port",o),10),this.host=i("host",o),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:i("password",o)}),this.binary=i("binary",o),this.options=i("options",o),this.ssl=typeof o.ssl>"u"?n():o.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=i("client_encoding",o),this.replication=i("replication",o),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=i("application_name",o,"PGAPPNAME"),this.fallback_application_name=i("fallback_application_name",o,!1),this.statement_timeout=i("statement_timeout",o,!1),this.lock_timeout=i("lock_timeout",o,!1),this.idle_in_transaction_session_timeout=i("idle_in_transaction_session_timeout",o,!1),this.query_timeout=i("query_timeout",o,!1),o.connectionTimeoutMillis===void 0?this.connect_timeout=e.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(o.connectionTimeoutMillis/1e3),o.keepAlive===!1?this.keepalives=0:o.keepAlive===!0&&(this.keepalives=1),typeof o.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(o.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(o){const l=[];c(l,this,"user"),c(l,this,"password"),c(l,this,"port"),c(l,this,"application_name"),c(l,this,"fallback_application_name"),c(l,this,"connect_timeout"),c(l,this,"options");const d=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(l,d,"sslmode"),c(l,d,"sslca"),c(l,d,"sslkey"),c(l,d,"sslcert"),c(l,d,"sslrootcert"),this.database&&l.push("dbname="+a(this.database)),this.replication&&l.push("replication="+a(this.replication)),this.host&&l.push("host="+a(this.host)),this.isDomainSocket)return o(null,l.join(" "));this.client_encoding&&l.push("client_encoding="+a(this.client_encoding)),t.lookup(this.host,function(h,x){return h?o(h,null):(l.push("hostaddr="+a(x)),o(null,l.join(" ")))})}}return ur=f,ur}var fr,hs;function yn(){if(hs)return fr;hs=1;const e=qt(),t=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/;class r{constructor(i,n){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=n,this.RowCtor=null,this.rowAsArray=i==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(i){let n;i.text?n=t.exec(i.text):n=t.exec(i.command),n&&(this.command=n[1],n[3]?(this.oid=parseInt(n[2],10),this.rowCount=parseInt(n[3],10)):n[2]&&(this.rowCount=parseInt(n[2],10)))}_parseRowAsArray(i){const n=new Array(i.length);for(let a=0,c=i.length;a<c;a++){const f=i[a];f!==null?n[a]=this._parsers[a](f):n[a]=null}return n}parseRow(i){const n={...this._prebuiltEmptyResultObject};for(let a=0,c=i.length;a<c;a++){const f=i[a],u=this.fields[a].name;if(f!==null){const o=this.fields[a].format==="binary"?Buffer.from(f):f;n[u]=this._parsers[a](o)}else n[u]=null}return n}addRow(i){this.rows.push(i)}addFields(i){this.fields=i,this.fields.length&&(this._parsers=new Array(i.length));const n={};for(let a=0;a<i.length;a++){const c=i[a];n[c.name]=null,this._types?this._parsers[a]=this._types.getTypeParser(c.dataTypeID,c.format||"text"):this._parsers[a]=e.getTypeParser(c.dataTypeID,c.format||"text")}this._prebuiltEmptyResultObject={...n}}}return fr=r,fr}var dr,ps;function la(){if(ps)return dr;ps=1;const{EventEmitter:e}=et,t=yn(),r=lt();class s extends e{constructor(n,a,c){super(),n=r.normalizeQueryConfig(n,a,c),this.text=n.text,this.values=n.values,this.rows=n.rows,this.types=n.types,this.name=n.name,this.queryMode=n.queryMode,this.binary=n.binary,this.portal=n.portal||"",this.callback=n.callback,this._rowMode=n.rowMode,process.domain&&n.callback&&(this.callback=process.domain.bind(n.callback)),this._result=new t(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.queryMode==="extended"||this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new t(this._rowMode,this._result._types),this._results.push(this._result))}handleRowDescription(n){this._checkForMultirow(),this._result.addFields(n.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(n){let a;if(!this._canceledDueToError){try{a=this._result.parseRow(n.fields)}catch(c){this._canceledDueToError=c;return}this.emit("row",a,this._result),this._accumulateRows&&this._result.addRow(a)}}handleCommandComplete(n,a){this._checkForMultirow(),this._result.addCommandComplete(n),this.rows&&a.sync()}handleEmptyQuery(n){this.rows&&n.sync()}handleError(n,a){if(this._canceledDueToError&&(n=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(n);this.emit("error",n)}handleReadyForQuery(n){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,n);if(this.callback)try{this.callback(null,this._results)}catch(a){process.nextTick(()=>{throw a})}this.emit("end",this._results)}submit(n){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");const a=n.parsedStatements[this.name];if(this.text&&a&&this.text!==a)return new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);if(this.values&&!Array.isArray(this.values))return new Error("Query values must be an array");if(this.requiresPreparation()){n.stream.cork&&n.stream.cork();try{this.prepare(n)}finally{n.stream.uncork&&n.stream.uncork()}}else n.query(this.text);return null}hasBeenParsed(n){return this.name&&n.parsedStatements[this.name]}handlePortalSuspended(n){this._getRows(n,this.rows)}_getRows(n,a){n.execute({portal:this.portal,rows:a}),a?n.flush():n.sync()}prepare(n){this.hasBeenParsed(n)||n.parse({text:this.text,name:this.name,types:this.types});try{n.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:r.prepareValue})}catch(a){this.handleError(a,n);return}n.describe({type:"P",name:this.portal||""}),this._getRows(n,this.rows)}handleCopyInResponse(n){n.sendCopyFail("No source stream defined")}handleCopyData(n,a){}}return dr=s,dr}var lr={},N={},xs;function bn(){if(xs)return N;xs=1,Object.defineProperty(N,"__esModule",{value:!0}),N.NoticeMessage=N.DataRowMessage=N.CommandCompleteMessage=N.ReadyForQueryMessage=N.NotificationResponseMessage=N.BackendKeyDataMessage=N.AuthenticationMD5Password=N.ParameterStatusMessage=N.ParameterDescriptionMessage=N.RowDescriptionMessage=N.Field=N.CopyResponse=N.CopyDataMessage=N.DatabaseError=N.copyDone=N.emptyQuery=N.replicationStart=N.portalSuspended=N.noData=N.closeComplete=N.bindComplete=N.parseComplete=void 0,N.parseComplete={name:"parseComplete",length:5},N.bindComplete={name:"bindComplete",length:5},N.closeComplete={name:"closeComplete",length:5},N.noData={name:"noData",length:5},N.portalSuspended={name:"portalSuspended",length:5},N.replicationStart={name:"replicationStart",length:4},N.emptyQuery={name:"emptyQuery",length:4},N.copyDone={name:"copyDone",length:4};class e extends Error{constructor(b,w,p){super(b),this.length=w,this.name=p}}N.DatabaseError=e;class t{constructor(b,w){this.length=b,this.chunk=w,this.name="copyData"}}N.CopyDataMessage=t;class r{constructor(b,w,p,y){this.length=b,this.name=w,this.binary=p,this.columnTypes=new Array(y)}}N.CopyResponse=r;class s{constructor(b,w,p,y,_,v,I){this.name=b,this.tableID=w,this.columnID=p,this.dataTypeID=y,this.dataTypeSize=_,this.dataTypeModifier=v,this.format=I}}N.Field=s;class i{constructor(b,w){this.length=b,this.fieldCount=w,this.name="rowDescription",this.fields=new Array(this.fieldCount)}}N.RowDescriptionMessage=i;class n{constructor(b,w){this.length=b,this.parameterCount=w,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}}N.ParameterDescriptionMessage=n;class a{constructor(b,w,p){this.length=b,this.parameterName=w,this.parameterValue=p,this.name="parameterStatus"}}N.ParameterStatusMessage=a;class c{constructor(b,w){this.length=b,this.salt=w,this.name="authenticationMD5Password"}}N.AuthenticationMD5Password=c;class f{constructor(b,w,p){this.length=b,this.processID=w,this.secretKey=p,this.name="backendKeyData"}}N.BackendKeyDataMessage=f;class u{constructor(b,w,p,y){this.length=b,this.processId=w,this.channel=p,this.payload=y,this.name="notification"}}N.NotificationResponseMessage=u;class o{constructor(b,w){this.length=b,this.status=w,this.name="readyForQuery"}}N.ReadyForQueryMessage=o;class l{constructor(b,w){this.length=b,this.text=w,this.name="commandComplete"}}N.CommandCompleteMessage=l;class d{constructor(b,w){this.length=b,this.fields=w,this.name="dataRow",this.fieldCount=w.length}}N.DataRowMessage=d;class h{constructor(b,w){this.length=b,this.message=w,this.name="notice"}}return N.NoticeMessage=h,N}var it={},at={},ms;function ha(){if(ms)return at;ms=1,Object.defineProperty(at,"__esModule",{value:!0}),at.Writer=void 0;class e{constructor(r=256){this.size=r,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(r)}ensure(r){if(this.buffer.length-this.offset<r){const i=this.buffer,n=i.length+(i.length>>1)+r;this.buffer=Buffer.allocUnsafe(n),i.copy(this.buffer)}}addInt32(r){return this.ensure(4),this.buffer[this.offset++]=r>>>24&255,this.buffer[this.offset++]=r>>>16&255,this.buffer[this.offset++]=r>>>8&255,this.buffer[this.offset++]=r>>>0&255,this}addInt16(r){return this.ensure(2),this.buffer[this.offset++]=r>>>8&255,this.buffer[this.offset++]=r>>>0&255,this}addCString(r){if(!r)this.ensure(1);else{const s=Buffer.byteLength(r);this.ensure(s+1),this.buffer.write(r,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(r=""){const s=Buffer.byteLength(r);return this.ensure(s),this.buffer.write(r,this.offset),this.offset+=s,this}add(r){return this.ensure(r.length),r.copy(this.buffer,this.offset),this.offset+=r.length,this}join(r){if(r){this.buffer[this.headerPosition]=r;const s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(r?0:5,this.offset)}flush(r){const s=this.join(r);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),s}}return at.Writer=e,at}var ys;function pa(){if(ys)return it;ys=1,Object.defineProperty(it,"__esModule",{value:!0}),it.serialize=void 0;const e=ha(),t=new e.Writer,r=A=>{t.addInt16(3).addInt16(0);for(const B of Object.keys(A))t.addCString(B).addCString(A[B]);t.addCString("client_encoding").addCString("UTF8");const D=t.addCString("").flush(),q=D.length+4;return new e.Writer().addInt32(q).add(D).flush()},s=()=>{const A=Buffer.allocUnsafe(8);return A.writeInt32BE(8,0),A.writeInt32BE(80877103,4),A},i=A=>t.addCString(A).flush(112),n=function(A,D){return t.addCString(A).addInt32(Buffer.byteLength(D)).addString(D),t.flush(112)},a=function(A){return t.addString(A).flush(112)},c=A=>t.addCString(A).flush(81),f=[],u=A=>{const D=A.name||"";D.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",D,D.length),console.error("This can cause conflicts and silent errors executing queries"));const q=A.types||f,B=q.length,Q=t.addCString(D).addCString(A.text).addInt16(B);for(let G=0;G<B;G++)Q.addInt32(q[G]);return t.flush(80)},o=new e.Writer,l=function(A,D){for(let q=0;q<A.length;q++){const B=D?D(A[q],q):A[q];B==null?(t.addInt16(0),o.addInt32(-1)):B instanceof Buffer?(t.addInt16(1),o.addInt32(B.length),o.add(B)):(t.addInt16(0),o.addInt32(Buffer.byteLength(B)),o.addString(B))}},d=(A={})=>{const D=A.portal||"",q=A.statement||"",B=A.binary||!1,Q=A.values||f,G=Q.length;return t.addCString(D).addCString(q),t.addInt16(G),l(Q,A.valueMapper),t.addInt16(G),t.add(o.flush()),t.addInt16(1),t.addInt16(B?1:0),t.flush(66)},h=Buffer.from([69,0,0,0,9,0,0,0,0,0]),x=A=>{if(!A||!A.portal&&!A.rows)return h;const D=A.portal||"",q=A.rows||0,B=Buffer.byteLength(D),Q=4+B+1+4,G=Buffer.allocUnsafe(1+Q);return G[0]=69,G.writeInt32BE(Q,1),G.write(D,5,"utf-8"),G[B+5]=0,G.writeUInt32BE(q,G.length-4),G},b=(A,D)=>{const q=Buffer.allocUnsafe(16);return q.writeInt32BE(16,0),q.writeInt16BE(1234,4),q.writeInt16BE(5678,6),q.writeInt32BE(A,8),q.writeInt32BE(D,12),q},w=(A,D)=>{const B=4+Buffer.byteLength(D)+1,Q=Buffer.allocUnsafe(1+B);return Q[0]=A,Q.writeInt32BE(B,1),Q.write(D,5,"utf-8"),Q[B]=0,Q},p=t.addCString("P").flush(68),y=t.addCString("S").flush(68),_=A=>A.name?w(68,`${A.type}${A.name||""}`):A.type==="P"?p:y,v=A=>{const D=`${A.type}${A.name||""}`;return w(67,D)},I=A=>t.add(A).flush(100),T=A=>w(102,A),m=A=>Buffer.from([A,0,0,0,4]),S=m(72),E=m(83),C=m(88),R=m(99),P={startup:r,password:i,requestSsl:s,sendSASLInitialResponseMessage:n,sendSCRAMClientFinalMessage:a,query:c,parse:u,bind:d,execute:x,describe:_,close:v,flush:()=>S,sync:()=>E,end:()=>C,copyData:I,copyDone:()=>R,copyFail:T,cancel:b};return it.serialize=P,it}var ot={},ct={},bs;function xa(){if(bs)return ct;bs=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.BufferReader=void 0;class e{constructor(r=0){this.offset=r,this.buffer=Buffer.allocUnsafe(0),this.encoding="utf-8"}setBuffer(r,s){this.offset=r,this.buffer=s}int16(){const r=this.buffer.readInt16BE(this.offset);return this.offset+=2,r}byte(){const r=this.buffer[this.offset];return this.offset++,r}int32(){const r=this.buffer.readInt32BE(this.offset);return this.offset+=4,r}uint32(){const r=this.buffer.readUInt32BE(this.offset);return this.offset+=4,r}string(r){const s=this.buffer.toString(this.encoding,this.offset,this.offset+r);return this.offset+=r,s}cstring(){const r=this.offset;let s=r;for(;this.buffer[s++]!==0;);return this.offset=s,this.buffer.toString(this.encoding,r,s-1)}bytes(r){const s=this.buffer.slice(this.offset,this.offset+r);return this.offset+=r,s}}return ct.BufferReader=e,ct}var gs;function ma(){if(gs)return ot;gs=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.Parser=void 0;const e=bn(),t=xa(),r=1,i=r+4,n=-1,a=Buffer.allocUnsafe(0);class c{constructor(S){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new t.BufferReader,(S==null?void 0:S.mode)==="binary")throw new Error("Binary mode not supported yet");this.mode=(S==null?void 0:S.mode)||"text"}parse(S,E){this.mergeBuffer(S);const C=this.bufferOffset+this.bufferLength;let R=this.bufferOffset;for(;R+i<=C;){const P=this.buffer[R],A=this.buffer.readUInt32BE(R+r),D=r+A;if(D+R<=C){const q=this.handlePacket(R+i,P,A,this.buffer);E(q),R+=D}else break}R===C?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=C-R,this.bufferOffset=R)}mergeBuffer(S){if(this.bufferLength>0){const E=this.bufferLength+S.byteLength;if(E+this.bufferOffset>this.buffer.byteLength){let R;if(E<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)R=this.buffer;else{let P=this.buffer.byteLength*2;for(;E>=P;)P*=2;R=Buffer.allocUnsafe(P)}this.buffer.copy(R,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=R,this.bufferOffset=0}S.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=E}else this.buffer=S,this.bufferOffset=0,this.bufferLength=S.byteLength}handlePacket(S,E,C,R){const{reader:P}=this;P.setBuffer(S,R);let A;switch(E){case 50:A=e.bindComplete;break;case 49:A=e.parseComplete;break;case 51:A=e.closeComplete;break;case 110:A=e.noData;break;case 115:A=e.portalSuspended;break;case 99:A=e.copyDone;break;case 87:A=e.replicationStart;break;case 73:A=e.emptyQuery;break;case 68:A=y(P);break;case 67:A=u(P);break;case 90:A=f(P);break;case 65:A=x(P);break;case 82:A=I(P,C);break;case 83:A=_(P);break;case 75:A=v(P);break;case 69:A=T(P,"error");break;case 78:A=T(P,"notice");break;case 84:A=b(P);break;case 116:A=p(P);break;case 71:A=l(P);break;case 72:A=d(P);break;case 100:A=o(P,C);break;default:return new e.DatabaseError("received invalid response: "+E.toString(16),C,"error")}return P.setBuffer(0,a),A.length=C,A}}ot.Parser=c;const f=m=>{const S=m.string(1);return new e.ReadyForQueryMessage(n,S)},u=m=>{const S=m.cstring();return new e.CommandCompleteMessage(n,S)},o=(m,S)=>{const E=m.bytes(S-4);return new e.CopyDataMessage(n,E)},l=m=>h(m,"copyInResponse"),d=m=>h(m,"copyOutResponse"),h=(m,S)=>{const E=m.byte()!==0,C=m.int16(),R=new e.CopyResponse(n,S,E,C);for(let P=0;P<C;P++)R.columnTypes[P]=m.int16();return R},x=m=>{const S=m.int32(),E=m.cstring(),C=m.cstring();return new e.NotificationResponseMessage(n,S,E,C)},b=m=>{const S=m.int16(),E=new e.RowDescriptionMessage(n,S);for(let C=0;C<S;C++)E.fields[C]=w(m);return E},w=m=>{const S=m.cstring(),E=m.uint32(),C=m.int16(),R=m.uint32(),P=m.int16(),A=m.int32(),D=m.int16()===0?"text":"binary";return new e.Field(S,E,C,R,P,A,D)},p=m=>{const S=m.int16(),E=new e.ParameterDescriptionMessage(n,S);for(let C=0;C<S;C++)E.dataTypeIDs[C]=m.int32();return E},y=m=>{const S=m.int16(),E=new Array(S);for(let C=0;C<S;C++){const R=m.int32();E[C]=R===-1?null:m.string(R)}return new e.DataRowMessage(n,E)},_=m=>{const S=m.cstring(),E=m.cstring();return new e.ParameterStatusMessage(n,S,E)},v=m=>{const S=m.int32(),E=m.int32();return new e.BackendKeyDataMessage(n,S,E)},I=(m,S)=>{const E=m.int32(),C={name:"authenticationOk",length:S};switch(E){case 0:break;case 3:C.length===8&&(C.name="authenticationCleartextPassword");break;case 5:if(C.length===12){C.name="authenticationMD5Password";const R=m.bytes(4);return new e.AuthenticationMD5Password(n,R)}break;case 10:{C.name="authenticationSASL",C.mechanisms=[];let R;do R=m.cstring(),R&&C.mechanisms.push(R);while(R)}break;case 11:C.name="authenticationSASLContinue",C.data=m.string(S-8);break;case 12:C.name="authenticationSASLFinal",C.data=m.string(S-8);break;default:throw new Error("Unknown authenticationOk message type "+E)}return C},T=(m,S)=>{const E={};let C=m.string(1);for(;C!=="\0";)E[C]=m.cstring(),C=m.string(1);const R=E.M,P=S==="notice"?new e.NoticeMessage(n,R):new e.DatabaseError(R,n,S);return P.severity=E.S,P.code=E.C,P.detail=E.D,P.hint=E.H,P.position=E.P,P.internalPosition=E.p,P.internalQuery=E.q,P.where=E.W,P.schema=E.s,P.table=E.t,P.column=E.c,P.dataType=E.d,P.constraint=E.n,P.file=E.F,P.line=E.L,P.routine=E.R,P};return ot}var ws;function gn(){return ws||(ws=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DatabaseError=e.serialize=e.parse=void 0;const t=bn();Object.defineProperty(e,"DatabaseError",{enumerable:!0,get:function(){return t.DatabaseError}});const r=pa();Object.defineProperty(e,"serialize",{enumerable:!0,get:function(){return r.serialize}});const s=ma();function i(n,a){const c=new s.Parser;return n.on("data",f=>c.parse(f,a)),new Promise(f=>n.on("end",()=>f()))}e.parse=i})(lr)),lr}var Rt={},_s;function ya(){return _s||(_s=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.default={}),Rt}var hr,Es;function ba(){if(Es)return hr;Es=1;const{getStream:e,getSecureStream:t}=n();hr={getStream:e,getSecureStream:t};function r(){function a(f){const u=zs;return new u.Socket}function c(f){return Zn.connect(f)}return{getStream:a,getSecureStream:c}}function s(){function a(f){const{CloudflareSocket:u}=ya();return new u(f)}function c(f){return f.socket.startTls(f),f.socket}return{getStream:a,getSecureStream:c}}function i(){if(typeof navigator=="object"&&navigator!==null&&typeof navigator.userAgent=="string")return navigator.userAgent==="Cloudflare-Workers";if(typeof Response=="function"){const a=new Response(null,{cf:{thing:!0}});if(typeof a.cf=="object"&&a.cf!==null&&a.cf.thing)return!0}return!1}function n(){return i()?s():r()}return hr}var pr,vs;function wn(){if(vs)return pr;vs=1;const e=et.EventEmitter,{parse:t,serialize:r}=gn(),{getStream:s,getSecureStream:i}=ba(),n=r.flush(),a=r.sync(),c=r.end();class f extends e{constructor(o){super(),o=o||{},this.stream=o.stream||s(o.ssl),typeof this.stream=="function"&&(this.stream=this.stream(o)),this._keepAlive=o.keepAlive,this._keepAliveInitialDelayMillis=o.keepAliveInitialDelayMillis,this.parsedStatements={},this.ssl=o.ssl||!1,this._ending=!1,this._emitMessage=!1;const l=this;this.on("newListener",function(d){d==="message"&&(l._emitMessage=!0)})}connect(o,l){const d=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(o,l),this.stream.once("connect",function(){d._keepAlive&&d.stream.setKeepAlive(!0,d._keepAliveInitialDelayMillis),d.emit("connect")});const h=function(x){d._ending&&(x.code==="ECONNRESET"||x.code==="EPIPE")||d.emit("error",x)};if(this.stream.on("error",h),this.stream.on("close",function(){d.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(x){switch(x.toString("utf8")){case"S":break;case"N":return d.stream.end(),d.emit("error",new Error("The server does not support SSL connections"));default:return d.stream.end(),d.emit("error",new Error("There was an error establishing an SSL connection"))}const w={socket:d.stream};d.ssl!==!0&&(Object.assign(w,d.ssl),"key"in d.ssl&&(w.key=d.ssl.key));const p=zs;p.isIP&&p.isIP(l)===0&&(w.servername=l);try{d.stream=i(w)}catch(y){return d.emit("error",y)}d.attachListeners(d.stream),d.stream.on("error",h),d.emit("sslconnect")})}attachListeners(o){t(o,l=>{const d=l.name==="error"?"errorMessage":l.name;this._emitMessage&&this.emit("message",l),this.emit(d,l)})}requestSsl(){this.stream.write(r.requestSsl())}startup(o){this.stream.write(r.startup(o))}cancel(o,l){this._send(r.cancel(o,l))}password(o){this._send(r.password(o))}sendSASLInitialResponseMessage(o,l){this._send(r.sendSASLInitialResponseMessage(o,l))}sendSCRAMClientFinalMessage(o){this._send(r.sendSCRAMClientFinalMessage(o))}_send(o){return this.stream.writable?this.stream.write(o):!1}query(o){this._send(r.query(o))}parse(o){this._send(r.parse(o))}bind(o){this._send(r.bind(o))}execute(o){this._send(r.execute(o))}flush(){this.stream.writable&&this.stream.write(n)}sync(){this._ending=!0,this._send(a)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(o){this._send(r.close(o))}describe(o){this._send(r.describe(o))}sendCopyFromChunk(o){this._send(r.copyData(o))}endCopyFrom(){this._send(r.copyDone())}sendCopyFail(o){this._send(r.copyFail(o))}}return pr=f,pr}var Tt={exports:{}},xr={exports:{}},mr,Ss;function ga(){if(Ss)return mr;Ss=1;const{Transform:e}=Vs,{StringDecoder:t}=ei,r=Symbol("last"),s=Symbol("decoder");function i(u,o,l){let d;if(this.overflow){if(d=this[s].write(u).split(this.matcher),d.length===1)return l();d.shift(),this.overflow=!1}else this[r]+=this[s].write(u),d=this[r].split(this.matcher);this[r]=d.pop();for(let h=0;h<d.length;h++)try{a(this,this.mapper(d[h]))}catch(x){return l(x)}if(this.overflow=this[r].length>this.maxLength,this.overflow&&!this.skipOverflow){l(new Error("maximum buffer reached"));return}l()}function n(u){if(this[r]+=this[s].end(),this[r])try{a(this,this.mapper(this[r]))}catch(o){return u(o)}u()}function a(u,o){o!==void 0&&u.push(o)}function c(u){return u}function f(u,o,l){switch(u=u||/\r?\n/,o=o||c,l=l||{},arguments.length){case 1:typeof u=="function"?(o=u,u=/\r?\n/):typeof u=="object"&&!(u instanceof RegExp)&&!u[Symbol.split]&&(l=u,u=/\r?\n/);break;case 2:typeof u=="function"?(l=o,o=u,u=/\r?\n/):typeof o=="object"&&(l=o,o=c)}l=Object.assign({},l),l.autoDestroy=!0,l.transform=i,l.flush=n,l.readableObjectMode=!0;const d=new e(l);return d[r]="",d[s]=new t("utf8"),d.matcher=u,d.mapper=o,d.maxLength=l.maxLength,d.skipOverflow=l.skipOverflow||!1,d.overflow=!1,d._destroy=function(h,x){this._writableState.errorEmitted=!1,x(h)},d}return mr=f,mr}var As;function wa(){return As||(As=1,(function(e){var t={},r=Vn,s=Vs.Stream,i=ga(),n=Ze,a=5432,c=process.platform==="win32",f=process.stderr,u=56,o=7,l=61440,d=32768;function h(I){return(I&l)==d}var x=["host","port","database","user","password"],b=x.length,w=x[b-1];function p(){var I=f instanceof s&&f.writable===!0;if(I){var T=Array.prototype.slice.call(arguments).concat(`
`);f.write(n.format.apply(n,T))}}Object.defineProperty(e.exports,"isWin",{get:function(){return c},set:function(I){c=I}}),e.exports.warnTo=function(I){var T=f;return f=I,T},e.exports.getFileName=function(I){var T=I||t,m=T.PGPASSFILE||(c?r.join(T.APPDATA||"./","postgresql","pgpass.conf"):r.join(T.HOME||"./",".pgpass"));return m},e.exports.usePgPass=function(I,T){return Object.prototype.hasOwnProperty.call(t,"PGPASSWORD")?!1:c?!0:(T=T||"<unkn>",h(I.mode)?I.mode&(u|o)?(p('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',T),!1):!0:(p('WARNING: password file "%s" is not a plain file',T),!1))};var y=e.exports.match=function(I,T){return x.slice(0,-1).reduce(function(m,S,E){return E==1&&Number(I[S]||a)===Number(T[S])?m&&!0:m&&(T[S]==="*"||T[S]===I[S])},!0)};e.exports.getPassword=function(I,T,m){var S,E=T.pipe(i());function C(A){var D=_(A);D&&v(D)&&y(I,D)&&(S=D[w],E.end())}var R=function(){T.destroy(),m(S)},P=function(A){T.destroy(),p("WARNING: error on reading file: %s",A),m(void 0)};T.on("error",P),E.on("data",C).on("end",R).on("error",P)};var _=e.exports.parseLine=function(I){if(I.length<11||I.match(/^\s+#/))return null;for(var T="",m="",S=0,E=0,C={},R=!1,P=function(D,q,B){var Q=I.substring(q,B);Object.hasOwnProperty.call(t,"PGPASS_NO_DEESCAPE")||(Q=Q.replace(/\\([:\\])/g,"$1")),C[x[D]]=Q},A=0;A<I.length-1;A+=1){if(T=I.charAt(A+1),m=I.charAt(A),R=S==b-1,R){P(S,E);break}A>=0&&T==":"&&m!=="\\"&&(P(S,E,A+1),E=A+2,S+=1)}return C=Object.keys(C).length===b?C:null,C},v=e.exports.isValidEntry=function(I){for(var T={0:function(R){return R.length>0},1:function(R){return R==="*"?!0:(R=Number(R),isFinite(R)&&R>0&&R<9007199254740992&&Math.floor(R)===R)},2:function(R){return R.length>0},3:function(R){return R.length>0},4:function(R){return R.length>0}},m=0;m<x.length;m+=1){var S=T[m],E=I[x[m]]||"",C=S(E);if(!C)return!1}return!0}})(xr)),xr.exports}var Cs;function _a(){if(Cs)return Tt.exports;Cs=1;var e=Gs,t=wa();return Tt.exports=function(r,s){var i=t.getFileName();e.stat(i,function(n,a){if(n||!t.usePgPass(a,i))return s(void 0);var c=e.createReadStream(i);t.getPassword(r,c,s)})},Tt.exports.warnTo=t.warnTo,Tt.exports}var yr,Rs;function Ea(){if(Rs)return yr;Rs=1;const e=et.EventEmitter,t=lt(),r=Ze,s=fa(),i=Dr(),n=mn(),a=la(),c=kt(),f=wn(),u=xn(),o=r.deprecate(()=>{},"Client.activeQuery is deprecated and will be removed in pg@9.0"),l=r.deprecate(()=>{},"Client.queryQueue is deprecated and will be removed in pg@9.0."),d=r.deprecate(()=>{},"pgpass support is deprecated and will be removed in pg@9.0. You can provide an async function as the password property to the Client/Pool constructor that returns a password instead. Within this function you can call the pgpass module in your own code."),h=r.deprecate(()=>{},"Passing a custom Promise implementation to the Client/Pool constructor is deprecated and will be removed in pg@9.0."),x=r.deprecate(()=>{},"Calling client.query() when the client is already executing a query is deprecated and will be removed in pg@9.0. Use asycn/await or an external async flow control mechanism instead.");class b extends e{constructor(p){super(),this.connectionParameters=new n(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;const y=p||{};y.Promise&&h(),this._Promise=y.Promise||Mr.Promise,this._types=new i(y.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this._activeQuery=null,this.enableChannelBinding=!!y.enableChannelBinding,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this._queryQueue=[],this.binary=y.binary||c.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}get activeQuery(){return o(),this._activeQuery}set activeQuery(p){o(),this._activeQuery=p}_getActiveQuery(){return this._activeQuery}_errorAllQueries(p){const y=v=>{process.nextTick(()=>{v.handleError(p,this.connection)})},_=this._getActiveQuery();_&&(y(_),this._activeQuery=null),this._queryQueue.forEach(y),this._queryQueue.length=0}_connect(p){const y=this,_=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){const v=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{p(v)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{_._ending=!0,_.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?_.connect(this.host+"/.s.PGSQL."+this.port):_.connect(this.port,this.host),_.on("connect",function(){y.ssl?_.requestSsl():_.startup(y.getStartupConf())}),_.on("sslconnect",function(){_.startup(y.getStartupConf())}),this._attachListeners(_),_.once("end",()=>{const v=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(v),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(v):this._handleErrorEvent(v):this._connectionError||this._handleErrorEvent(v)),process.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,_)=>{this._connect(v=>{v?_(v):y(this)})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_getPassword(p){const y=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password(this.connectionParameters)).then(_=>{if(_!==void 0){if(typeof _!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=_}else this.connectionParameters.password=this.password=null;p()}).catch(_=>{y.emit("error",_)});else if(this.password!==null)p();else try{_a()(this.connectionParameters,v=>{v!==void 0&&(d(),this.connectionParameters.password=this.password=v),p()})}catch(_){this.emit("error",_)}}_handleAuthCleartextPassword(p){this._getPassword(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._getPassword(async()=>{try{const y=await u.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)}catch(y){this.emit("error",y)}})}_handleAuthSASL(p){this._getPassword(()=>{try{this.saslSession=s.startSession(p.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(y){this.connection.emit("error",y)}})}async _handleAuthSASLContinue(p){try{await s.continueSession(this.saslSession,this.password,p.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(y){this.connection.emit("error",y)}}_handleAuthSASLFinal(p){try{s.finalizeSession(this.saslSession,p.data),this.saslSession=null}catch(y){this.connection.emit("error",y)}}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));const y=this._getActiveQuery();this._activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);const y=this._getActiveQuery();if(!y){this._handleErrorEvent(p);return}this._activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){const y=this._getActiveQuery();if(y==null){const _=new Error("Received unexpected rowDescription message from backend.");this._handleErrorEvent(_);return}y.handleRowDescription(p)}_handleDataRow(p){const y=this._getActiveQuery();if(y==null){const _=new Error("Received unexpected dataRow message from backend.");this._handleErrorEvent(_);return}y.handleDataRow(p)}_handlePortalSuspended(p){const y=this._getActiveQuery();if(y==null){const _=new Error("Received unexpected portalSuspended message from backend.");this._handleErrorEvent(_);return}y.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){const y=this._getActiveQuery();if(y==null){const _=new Error("Received unexpected emptyQuery message from backend.");this._handleErrorEvent(_);return}y.handleEmptyQuery(this.connection)}_handleCommandComplete(p){const y=this._getActiveQuery();if(y==null){const _=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(_);return}y.handleCommandComplete(p,this.connection)}_handleParseComplete(){const p=this._getActiveQuery();if(p==null){const y=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(y);return}p.name&&(this.connection.parsedStatements[p.name]=p.text)}_handleCopyInResponse(p){const y=this._getActiveQuery();if(y==null){const _=new Error("Received unexpected copyInResponse message from backend.");this._handleErrorEvent(_);return}y.handleCopyInResponse(this.connection)}_handleCopyData(p){const y=this._getActiveQuery();if(y==null){const _=new Error("Received unexpected copyData message from backend.");this._handleErrorEvent(_);return}y.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){const p=this.connectionParameters,y={user:p.user,database:p.database},_=p.application_name||p.fallback_application_name;return _&&(y.application_name=_),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){const _=this.connection;this.host&&this.host.indexOf("/")===0?_.connect(this.host+"/.s.PGSQL."+this.port):_.connect(this.port,this.host),_.on("connect",function(){_.cancel(p.processID,p.secretKey)})}else p._queryQueue.indexOf(y)!==-1&&p._queryQueue.splice(p._queryQueue.indexOf(y),1)}setTypeParser(p,y,_){return this._types.setTypeParser(p,y,_)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return t.escapeIdentifier(p)}escapeLiteral(p){return t.escapeLiteral(p)}_pulseQueryQueue(){if(this.readyForQuery===!0){this._activeQuery=this._queryQueue.shift();const p=this._getActiveQuery();if(p){this.readyForQuery=!1,this.hasExecuted=!0;const y=p.submit(this.connection);y&&process.nextTick(()=>{p.handleError(y,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this._activeQuery=null,this.emit("drain"))}}query(p,y,_){let v,I,T,m,S;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(T=p.query_timeout||this.connectionParameters.query_timeout,I=v=p,v.callback||(typeof y=="function"?v.callback=y:_&&(v.callback=_))):(T=p.query_timeout||this.connectionParameters.query_timeout,v=new a(p,y,_),v.callback||(I=new this._Promise((E,C)=>{v.callback=(R,P)=>R?C(R):E(P)}).catch(E=>{throw Error.captureStackTrace(E),E}))),T&&(S=v.callback||(()=>{}),m=setTimeout(()=>{const E=new Error("Query read timeout");process.nextTick(()=>{v.handleError(E,this.connection)}),S(E),v.callback=()=>{};const C=this._queryQueue.indexOf(v);C>-1&&this._queryQueue.splice(C,1),this._pulseQueryQueue()},T),v.callback=(E,C)=>{clearTimeout(m),S(E,C)}),this.binary&&!v.binary&&(v.binary=!0),v._result&&!v._result._types&&(v._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"),this.connection)}),I):(this._queryQueue.length>0&&x(),this._queryQueue.push(v),this._pulseQueryQueue(),I):(process.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),I)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting||this._ended)if(p)p();else return this._Promise.resolve();if(this._getActiveQuery()||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}get queryQueue(){return l(),this._queryQueue}}return b.Query=a,yr=b,yr}var br,Ts;function va(){if(Ts)return br;Ts=1;const e=et.EventEmitter,t=function(){},r=(u,o)=>{const l=u.findIndex(o);return l===-1?void 0:u.splice(l,1)[0]};class s{constructor(o,l,d){this.client=o,this.idleListener=l,this.timeoutId=d}}class i{constructor(o){this.callback=o}}function n(){throw new Error("Release called on client which has already been released to the pool.")}function a(u,o){if(o)return{callback:o,result:void 0};let l,d;const h=function(b,w){b?l(b):d(w)},x=new u(function(b,w){d=b,l=w}).catch(b=>{throw Error.captureStackTrace(b),b});return{callback:h,result:x}}function c(u,o){return function l(d){d.client=o,o.removeListener("error",l),o.on("error",()=>{u.log("additional client error after disconnection due to error",d)}),u._remove(o),u.emit("error",d,o)}}class f extends e{constructor(o,l){super(),this.options=Object.assign({},o),o!=null&&"password"in o&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:o.password}),o!=null&&o.ssl&&o.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||l||_n().Client,this.Promise=this.options.Promise||Mr.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(l=>{this._remove(l.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;const o=this._pendingQueue.shift();if(this._idle.length){const l=this._idle.pop();clearTimeout(l.timeoutId);const d=l.client;d.ref&&d.ref();const h=l.idleListener;return this._acquireClient(d,o,h,!1)}if(!this._isFull())return this.newClient(o);throw new Error("unexpected condition")}_remove(o,l){const d=r(this._idle,x=>x.client===o);d!==void 0&&clearTimeout(d.timeoutId),this._clients=this._clients.filter(x=>x!==o);const h=this;o.end(()=>{h.emit("remove",o),typeof l=="function"&&l()})}connect(o){if(this.ending){const h=new Error("Cannot use a pool after calling end on the pool");return o?o(h):this.Promise.reject(h)}const l=a(this.Promise,o),d=l.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new i(l.callback)),d;const h=(w,p,y)=>{clearTimeout(b),l.callback(w,p,y)},x=new i(h),b=setTimeout(()=>{r(this._pendingQueue,w=>w.callback===h),x.timedOut=!0,l.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return b.unref&&b.unref(),this._pendingQueue.push(x),d}return this.newClient(new i(l.callback)),d}newClient(o){const l=new this.Client(this.options);this._clients.push(l);const d=c(this,l);this.log("checking client timeout");let h,x=!1;this.options.connectionTimeoutMillis&&(h=setTimeout(()=>{l.connection?(this.log("ending client due to timeout"),x=!0,l.connection.stream.destroy()):l.isConnected()||(this.log("ending client due to timeout"),x=!0,l.end())},this.options.connectionTimeoutMillis)),this.log("connecting new client"),l.connect(b=>{if(h&&clearTimeout(h),l.on("error",d),b)this.log("client failed to connect",b),this._clients=this._clients.filter(w=>w!==l),x&&(b=new Error("Connection terminated due to connection timeout",{cause:b})),this._pulseQueue(),o.timedOut||o.callback(b,void 0,t);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){const w=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(l),this._idle.findIndex(y=>y.client===l)!==-1&&this._acquireClient(l,new i((y,_,v)=>v()),d,!1)},this.options.maxLifetimeSeconds*1e3);w.unref(),l.once("end",()=>clearTimeout(w))}return this._acquireClient(l,o,d,!0)}})}_acquireClient(o,l,d,h){h&&this.emit("connect",o),this.emit("acquire",o),o.release=this._releaseOnce(o,d),o.removeListener("error",d),l.timedOut?h&&this.options.verify?this.options.verify(o,o.release):o.release():h&&this.options.verify?this.options.verify(o,x=>{if(x)return o.release(x),l.callback(x,void 0,t);l.callback(void 0,o,o.release)}):l.callback(void 0,o,o.release)}_releaseOnce(o,l){let d=!1;return h=>{d&&n(),d=!0,this._release(o,l,h)}}_release(o,l,d){if(o.on("error",l),o._poolUseCount=(o._poolUseCount||0)+1,this.emit("release",d,o),d||this.ending||!o._queryable||o._ending||o._poolUseCount>=this.options.maxUses)return o._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(o,this._pulseQueue.bind(this));if(this._expired.has(o))return this.log("remove expired client"),this._expired.delete(o),this._remove(o,this._pulseQueue.bind(this));let x;this.options.idleTimeoutMillis&&this._isAboveMin()&&(x=setTimeout(()=>{this._isAboveMin()&&(this.log("remove idle client"),this._remove(o,this._pulseQueue.bind(this)))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&x.unref()),this.options.allowExitOnIdle&&o.unref(),this._idle.push(new s(o,l,x)),this._pulseQueue()}query(o,l,d){if(typeof o=="function"){const x=a(this.Promise,o);return setImmediate(function(){return x.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),x.result}typeof l=="function"&&(d=l,l=void 0);const h=a(this.Promise,d);return d=h.callback,this.connect((x,b)=>{if(x)return d(x);let w=!1;const p=y=>{w||(w=!0,b.release(y),d(y))};b.once("error",p),this.log("dispatching query");try{b.query(o,l,(y,_)=>{if(this.log("query dispatched"),b.removeListener("error",p),!w)return w=!0,b.release(y),y?d(y):d(void 0,_)})}catch(y){return b.release(y),d(y)}}),h.result}end(o){if(this.log("ending"),this.ending){const d=new Error("Called end on pool more than once");return o?o(d):this.Promise.reject(d)}this.ending=!0;const l=a(this.Promise,o);return this._endCallback=l.callback,this._pulseQueue(),l.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((o,l)=>o+(this._expired.has(l)?1:0),0)}get totalCount(){return this._clients.length}}return br=f,br}var gr={exports:{}};const Sa={},Aa=Object.freeze(Object.defineProperty({__proto__:null,default:Sa},Symbol.toStringTag,{value:"Module"})),Ca=Xi(Aa);var wr={exports:{}},Is;function Ra(){if(Is)return wr.exports;Is=1;const e=et.EventEmitter,t=Ze,r=lt(),s=wr.exports=function(n,a,c){e.call(this),n=r.normalizeQueryConfig(n,a,c),this.text=n.text,this.values=n.values,this.name=n.name,this.queryMode=n.queryMode,this.callback=n.callback,this.state="new",this._arrayMode=n.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",(function(f){f==="row"&&(this._emitRowEvents=!0)}).bind(this))};t.inherits(s,e);const i={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};return s.prototype.handleError=function(n){const a=this.native.pq.resultErrorFields();if(a)for(const c in a){const f=i[c]||c;n[f]=a[c]}this.callback?this.callback(n):this.emit("error",n),this.state="error"},s.prototype.then=function(n,a){return this._getPromise().then(n,a)},s.prototype.catch=function(n){return this._getPromise().catch(n)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise((function(n,a){this._once("end",n),this._once("error",a)}).bind(this)),this._promise)},s.prototype.submit=function(n){this.state="running";const a=this;this.native=n.native,n.native.arrayMode=this._arrayMode;let c=function(f,u,o){if(n.native.arrayMode=!1,setImmediate(function(){a.emit("_done")}),f)return a.handleError(f);a._emitRowEvents&&(o.length>1?u.forEach((l,d)=>{l.forEach(h=>{a.emit("row",h,o[d])})}):u.forEach(function(l){a.emit("row",l,o)})),a.state="end",a.emit("end",o),a.callback&&a.callback(null,o)};if(process.domain&&(c=process.domain.bind(c)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));const f=(this.values||[]).map(r.prepareValue);if(n.namedQueries[this.name]){if(this.text&&n.namedQueries[this.name]!==this.text){const u=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return c(u)}return n.native.execute(this.name,f,c)}return n.native.prepare(this.name,this.text,f.length,function(u){return u?c(u):(n.namedQueries[a.name]=a.text,a.native.execute(a.name,f,c))})}else if(this.values){if(!Array.isArray(this.values)){const u=new Error("Query values must be an array");return c(u)}const f=this.values.map(r.prepareValue);n.native.query(this.text,f,c)}else this.queryMode==="extended"?n.native.query(this.text,[],c):n.native.query(this.text,c)},wr.exports}var Ps;function Ta(){if(Ps)return gr.exports;Ps=1;const e=Ze;var t;try{t=Ca}catch(u){throw u}const r=Dr(),s=et.EventEmitter,i=Ze,n=mn(),a=Ra(),c=e.deprecate(()=>{},"Calling client.query() when the client is already executing a query is deprecated and will be removed in pg@9.0. Use asycn/await or an external async flow control mechanism instead."),f=gr.exports=function(u){s.call(this),u=u||{},this._Promise=u.Promise||Mr.Promise,this._types=new r(u.types),this.native=new t({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;const o=this.connectionParameters=new n(u);u.nativeConnectionString&&(o.nativeConnectionString=u.nativeConnectionString),this.user=o.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:o.password}),this.database=o.database,this.host=o.host,this.port=o.port,this.namedQueries={}};return f.Query=a,i.inherits(f,s),f.prototype._errorAllQueries=function(u){const o=l=>{process.nextTick(()=>{l.native=this.native,l.handleError(u)})};this._hasActiveQuery()&&(o(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(o),this._queryQueue.length=0},f.prototype._connect=function(u){const o=this;if(this._connecting){process.nextTick(()=>u(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(l,d){if(o.connectionParameters.nativeConnectionString&&(d=o.connectionParameters.nativeConnectionString),l)return u(l);o.native.connect(d,function(h){if(h)return o.native.end(),u(h);o._connected=!0,o.native.on("error",function(x){o._queryable=!1,o._errorAllQueries(x),o.emit("error",x)}),o.native.on("notification",function(x){o.emit("notification",{channel:x.relname,payload:x.extra})}),o.emit("connect"),o._pulseQueryQueue(!0),u(null,this)})})},f.prototype.connect=function(u){if(u){this._connect(u);return}return new this._Promise((o,l)=>{this._connect(d=>{d?l(d):o(this)})})},f.prototype.query=function(u,o,l){let d,h,x,b,w;if(u==null)throw new TypeError("Client was passed a null or undefined query");if(typeof u.submit=="function")x=u.query_timeout||this.connectionParameters.query_timeout,h=d=u,typeof o=="function"&&(u.callback=o);else if(x=u.query_timeout||this.connectionParameters.query_timeout,d=new a(u,o,l),!d.callback){let p,y;h=new this._Promise((_,v)=>{p=_,y=v}).catch(_=>{throw Error.captureStackTrace(_),_}),d.callback=(_,v)=>_?y(_):p(v)}return x&&(w=d.callback||(()=>{}),b=setTimeout(()=>{const p=new Error("Query read timeout");process.nextTick(()=>{d.handleError(p,this.connection)}),w(p),d.callback=()=>{};const y=this._queryQueue.indexOf(d);y>-1&&this._queryQueue.splice(y,1),this._pulseQueryQueue()},x),d.callback=(p,y)=>{clearTimeout(b),w(p,y)}),this._queryable?this._ending?(d.native=this.native,process.nextTick(()=>{d.handleError(new Error("Client was closed and is not queryable"))}),h):(this._queryQueue.length>0&&c(),this._queryQueue.push(d),this._pulseQueryQueue(),h):(d.native=this.native,process.nextTick(()=>{d.handleError(new Error("Client has encountered a connection error and is not queryable"))}),h)},f.prototype.end=function(u){const o=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,u));let l;return u||(l=new this._Promise(function(d,h){u=x=>x?h(x):d()})),this.native.end(function(){o._connected=!1,o._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{o.emit("end"),u&&u()})}),l},f.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},f.prototype._pulseQueryQueue=function(u){if(!this._connected||this._hasActiveQuery())return;const o=this._queryQueue.shift();if(!o){u||this.emit("drain");return}this._activeQuery=o,o.submit(this);const l=this;o.once("_done",function(){l._pulseQueryQueue()})},f.prototype.cancel=function(u){this._activeQuery===u?this.native.cancel(function(){}):this._queryQueue.indexOf(u)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(u),1)},f.prototype.ref=function(){},f.prototype.unref=function(){},f.prototype.setTypeParser=function(u,o,l){return this._types.setTypeParser(u,o,l)},f.prototype.getTypeParser=function(u,o){return this._types.getTypeParser(u,o)},f.prototype.isConnected=function(){return this._connected},gr.exports}var _r,Os;function Ms(){return Os||(Os=1,_r=Ta()),_r}var Ds;function _n(){return Ds||(Ds=1,(function(e){var t={};const r=Ea(),s=kt(),i=wn(),n=yn(),a=lt(),c=va(),f=Dr(),{DatabaseError:u}=gn(),{escapeIdentifier:o,escapeLiteral:l}=lt(),d=w=>class extends c{constructor(y){super(y,w)}},h=function(w){this.defaults=s,this.Client=w,this.Query=this.Client.Query,this.Pool=d(this.Client),this._pools=[],this.Connection=i,this.types=qt(),this.DatabaseError=u,this.TypeOverrides=f,this.escapeIdentifier=o,this.escapeLiteral=l,this.Result=n,this.utils=a};let x=r,b=!1;try{b=!!t.NODE_PG_FORCE_NATIVE}catch{}b&&(x=Ms()),e.exports=new h(x),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){let w=null;try{w=new h(Ms())}catch(p){if(p.code!=="MODULE_NOT_FOUND")throw p}return Object.defineProperty(e.exports,"native",{value:w}),w}})})(Qt)),Qt.exports}var Ia=_n();const X=Yi(Ia);X.Client;X.Pool;X.Connection;X.types;X.Query;X.DatabaseError;X.escapeIdentifier;X.escapeLiteral;X.Result;X.TypeOverrides;X.defaults;var Pa={};const{Pool:Oa}=X;let Er=null;const Ma="postgresql://neondb_owner:npg_dmGzNnsx6tf0@ep-divine-mouse-acs7dan0-pooler.sa-east-1.aws.neon.tech/neondb?sslmode=require";function Da(){if(!Er){const e=Pa.DATABASE_URL||Ma;Er=new Oa({connectionString:e,ssl:{rejectUnauthorized:!1},max:10,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3})}return Er}async function L(e,t=[]){try{return(await Da().query(e,t)).rows}catch(r){throw console.error("Database query error:",r),r}}function Na(e){try{return crypto.getRandomValues(new Uint8Array(e))}catch{}try{return Pr.randomBytes(e)}catch{}throw Error("Neither WebCryptoAPI nor a crypto module is available. Use bcrypt.setRandomFallback to set an alternative")}function $a(e,t){if(e=e||Sn,typeof e!="number")throw Error("Illegal arguments: "+typeof e+", "+typeof t);e<4?e=4:e>31&&(e=31);var r=[];return r.push("$2b$"),e<10&&r.push("0"),r.push(e.toString()),r.push("$"),r.push(Rr(Na(ht),ht)),r.join("")}function En(e,t,r){if(typeof t=="function"&&(r=t,t=void 0),typeof e=="function"&&(r=e,e=void 0),typeof e>"u")e=Sn;else if(typeof e!="number")throw Error("illegal arguments: "+typeof e);function s(i){ne(function(){try{i(null,$a(e))}catch(n){i(n)}})}if(r){if(typeof r!="function")throw Error("Illegal callback: "+typeof r);s(r)}else return new Promise(function(i,n){s(function(a,c){if(a){n(a);return}i(c)})})}function vn(e,t,r,s){function i(n){typeof e=="string"&&typeof t=="number"?En(t,function(a,c){ks(e,c,n,s)}):typeof e=="string"&&typeof t=="string"?ks(e,t,n,s):ne(n.bind(this,Error("Illegal arguments: "+typeof e+", "+typeof t)))}if(r){if(typeof r!="function")throw Error("Illegal callback: "+typeof r);i(r)}else return new Promise(function(n,a){i(function(c,f){if(c){a(c);return}n(f)})})}function La(e,t){for(var r=e.length^t.length,s=0;s<e.length;++s)r|=e.charCodeAt(s)^t.charCodeAt(s);return r===0}function qa(e,t,r,s){function i(n){if(typeof e!="string"||typeof t!="string"){ne(n.bind(this,Error("Illegal arguments: "+typeof e+", "+typeof t)));return}if(t.length!==60){ne(n.bind(this,null,!1));return}vn(e,t.substring(0,29),function(a,c){a?n(a):n(null,La(c,t))},s)}if(r){if(typeof r!="function")throw Error("Illegal callback: "+typeof r);i(r)}else return new Promise(function(n,a){i(function(c,f){if(c){a(c);return}n(f)})})}var ne=typeof setImmediate=="function"?setImmediate:typeof scheduler=="object"&&typeof scheduler.postTask=="function"?scheduler.postTask.bind(scheduler):setTimeout;function ka(e){for(var t=0,r=0,s=0;s<e.length;++s)r=e.charCodeAt(s),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(s+1)&64512)===56320?(++s,t+=4):t+=3;return t}function Ba(e){for(var t=0,r,s,i=new Array(ka(e)),n=0,a=e.length;n<a;++n)r=e.charCodeAt(n),r<128?i[t++]=r:r<2048?(i[t++]=r>>6|192,i[t++]=r&63|128):(r&64512)===55296&&((s=e.charCodeAt(n+1))&64512)===56320?(r=65536+((r&1023)<<10)+(s&1023),++n,i[t++]=r>>18|240,i[t++]=r>>12&63|128,i[t++]=r>>6&63|128,i[t++]=r&63|128):(i[t++]=r>>12|224,i[t++]=r>>6&63|128,i[t++]=r&63|128);return i}var $e="./ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),le=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,54,55,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,-1,-1,-1,-1,-1,-1,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,-1,-1,-1,-1,-1];function Rr(e,t){var r=0,s=[],i,n;if(t<=0||t>e.length)throw Error("Illegal len: "+t);for(;r<t;){if(i=e[r++]&255,s.push($e[i>>2&63]),i=(i&3)<<4,r>=t){s.push($e[i&63]);break}if(n=e[r++]&255,i|=n>>4&15,s.push($e[i&63]),i=(n&15)<<2,r>=t){s.push($e[i&63]);break}n=e[r++]&255,i|=n>>6&3,s.push($e[i&63]),s.push($e[n&63])}return s.join("")}function Ha(e,t){for(var r=0,s=e.length,i=0,n=[],a,c,f,u,o,l;r<s-1&&i<t&&(l=e.charCodeAt(r++),a=l<le.length?le[l]:-1,l=e.charCodeAt(r++),c=l<le.length?le[l]:-1,!(a==-1||c==-1||(o=a<<2>>>0,o|=(c&48)>>4,n.push(String.fromCharCode(o)),++i>=t||r>=s)||(l=e.charCodeAt(r++),f=l<le.length?le[l]:-1,f==-1)||(o=(c&15)<<4>>>0,o|=(f&60)>>2,n.push(String.fromCharCode(o)),++i>=t||r>=s)));)l=e.charCodeAt(r++),u=l<le.length?le[l]:-1,o=(f&3)<<6>>>0,o|=u,n.push(String.fromCharCode(o)),++i;var d=[];for(r=0;r<i;r++)d.push(n[r].charCodeAt(0));return d}var ht=16,Sn=10,ja=16,Ua=100,Ns=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],$s=[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946,1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055,3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504,976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462],An=[1332899944,1700884034,1701343084,1684370003,1668446532,1869963892];function pt(e,t,r,s){var i,n=e[t],a=e[t+1];return n^=r[0],i=s[n>>>24],i+=s[256|n>>16&255],i^=s[512|n>>8&255],i+=s[768|n&255],a^=i^r[1],i=s[a>>>24],i+=s[256|a>>16&255],i^=s[512|a>>8&255],i+=s[768|a&255],n^=i^r[2],i=s[n>>>24],i+=s[256|n>>16&255],i^=s[512|n>>8&255],i+=s[768|n&255],a^=i^r[3],i=s[a>>>24],i+=s[256|a>>16&255],i^=s[512|a>>8&255],i+=s[768|a&255],n^=i^r[4],i=s[n>>>24],i+=s[256|n>>16&255],i^=s[512|n>>8&255],i+=s[768|n&255],a^=i^r[5],i=s[a>>>24],i+=s[256|a>>16&255],i^=s[512|a>>8&255],i+=s[768|a&255],n^=i^r[6],i=s[n>>>24],i+=s[256|n>>16&255],i^=s[512|n>>8&255],i+=s[768|n&255],a^=i^r[7],i=s[a>>>24],i+=s[256|a>>16&255],i^=s[512|a>>8&255],i+=s[768|a&255],n^=i^r[8],i=s[n>>>24],i+=s[256|n>>16&255],i^=s[512|n>>8&255],i+=s[768|n&255],a^=i^r[9],i=s[a>>>24],i+=s[256|a>>16&255],i^=s[512|a>>8&255],i+=s[768|a&255],n^=i^r[10],i=s[n>>>24],i+=s[256|n>>16&255],i^=s[512|n>>8&255],i+=s[768|n&255],a^=i^r[11],i=s[a>>>24],i+=s[256|a>>16&255],i^=s[512|a>>8&255],i+=s[768|a&255],n^=i^r[12],i=s[n>>>24],i+=s[256|n>>16&255],i^=s[512|n>>8&255],i+=s[768|n&255],a^=i^r[13],i=s[a>>>24],i+=s[256|a>>16&255],i^=s[512|a>>8&255],i+=s[768|a&255],n^=i^r[14],i=s[n>>>24],i+=s[256|n>>16&255],i^=s[512|n>>8&255],i+=s[768|n&255],a^=i^r[15],i=s[a>>>24],i+=s[256|a>>16&255],i^=s[512|a>>8&255],i+=s[768|a&255],n^=i^r[16],e[t]=a^r[ja+1],e[t+1]=n,e}function He(e,t){for(var r=0,s=0;r<4;++r)s=s<<8|e[t]&255,t=(t+1)%e.length;return{key:s,offp:t}}function Ls(e,t,r){for(var s=0,i=[0,0],n=t.length,a=r.length,c,f=0;f<n;f++)c=He(e,s),s=c.offp,t[f]=t[f]^c.key;for(f=0;f<n;f+=2)i=pt(i,0,t,r),t[f]=i[0],t[f+1]=i[1];for(f=0;f<a;f+=2)i=pt(i,0,t,r),r[f]=i[0],r[f+1]=i[1]}function Fa(e,t,r,s){for(var i=0,n=[0,0],a=r.length,c=s.length,f,u=0;u<a;u++)f=He(t,i),i=f.offp,r[u]=r[u]^f.key;for(i=0,u=0;u<a;u+=2)f=He(e,i),i=f.offp,n[0]^=f.key,f=He(e,i),i=f.offp,n[1]^=f.key,n=pt(n,0,r,s),r[u]=n[0],r[u+1]=n[1];for(u=0;u<c;u+=2)f=He(e,i),i=f.offp,n[0]^=f.key,f=He(e,i),i=f.offp,n[1]^=f.key,n=pt(n,0,r,s),s[u]=n[0],s[u+1]=n[1]}function qs(e,t,r,s,i){var n=An.slice(),a=n.length,c;if(r<4||r>31)if(c=Error("Illegal number of rounds (4-31): "+r),s){ne(s.bind(this,c));return}else throw c;if(t.length!==ht)if(c=Error("Illegal salt length: "+t.length+" != "+ht),s){ne(s.bind(this,c));return}else throw c;r=1<<r>>>0;var f,u,o=0,l;typeof Int32Array=="function"?(f=new Int32Array(Ns),u=new Int32Array($s)):(f=Ns.slice(),u=$s.slice()),Fa(t,e,f,u);function d(){if(i&&i(o/r),o<r)for(var x=Date.now();o<r&&(o=o+1,Ls(e,f,u),Ls(t,f,u),!(Date.now()-x>Ua)););else{for(o=0;o<64;o++)for(l=0;l<a>>1;l++)pt(n,l<<1,f,u);var b=[];for(o=0;o<a;o++)b.push((n[o]>>24&255)>>>0),b.push((n[o]>>16&255)>>>0),b.push((n[o]>>8&255)>>>0),b.push((n[o]&255)>>>0);if(s){s(null,b);return}else return b}s&&ne(d)}if(typeof s<"u")d();else for(var h;;)if(typeof(h=d())<"u")return h||[]}function ks(e,t,r,s){var i;if(typeof e!="string"||typeof t!="string")if(i=Error("Invalid string / salt: Not a string"),r){ne(r.bind(this,i));return}else throw i;var n,a;if(t.charAt(0)!=="$"||t.charAt(1)!=="2")if(i=Error("Invalid salt version: "+t.substring(0,2)),r){ne(r.bind(this,i));return}else throw i;if(t.charAt(2)==="$")n="\0",a=3;else{if(n=t.charAt(2),n!=="a"&&n!=="b"&&n!=="y"||t.charAt(3)!=="$")if(i=Error("Invalid salt revision: "+t.substring(2,4)),r){ne(r.bind(this,i));return}else throw i;a=4}if(t.charAt(a+2)>"$")if(i=Error("Missing salt rounds"),r){ne(r.bind(this,i));return}else throw i;var c=parseInt(t.substring(a,a+1),10)*10,f=parseInt(t.substring(a+1,a+2),10),u=c+f,o=t.substring(a+3,a+25);e+=n>="a"?"\0":"";var l=Ba(e),d=Ha(o,ht);function h(x){var b=[];return b.push("$2"),n>="a"&&b.push(n),b.push("$"),u<10&&b.push("0"),b.push(u.toString()),b.push("$"),b.push(Rr(d,d.length)),b.push(Rr(x,An.length*4-1)),b.join("")}if(typeof r>"u")return h(qs(l,d,u));qs(l,d,u,function(x,b){x?r(x,null):r(null,h(b))},s)}const Nt=new TextEncoder,xt=new TextDecoder;function Cn(...e){const t=e.reduce((i,{length:n})=>i+n,0),r=new Uint8Array(t);let s=0;for(const i of e)r.set(i,s),s+=i.length;return r}function Ue(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++){const s=e.charCodeAt(r);if(s>127)throw new TypeError("non-ASCII string encountered in encode()");t[r]=s}return t}function Qa(e){if(Uint8Array.prototype.toBase64)return e.toBase64();const t=32768,r=[];for(let s=0;s<e.length;s+=t)r.push(String.fromCharCode.apply(null,e.subarray(s,s+t)));return btoa(r.join(""))}function Wa(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(e);const t=atob(e),r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}function Mt(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(typeof e=="string"?e:xt.decode(e),{alphabet:"base64url"});let t=e;t instanceof Uint8Array&&(t=xt.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/");try{return Wa(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}}function vr(e){let t=e;return typeof t=="string"&&(t=Nt.encode(t)),Uint8Array.prototype.toBase64?t.toBase64({alphabet:"base64url",omitPadding:!0}):Qa(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}class Me extends Error{constructor(r,s){var i;super(r,s);O(this,"code","ERR_JOSE_GENERIC");this.name=this.constructor.name,(i=Error.captureStackTrace)==null||i.call(Error,this,this.constructor)}}O(Me,"code","ERR_JOSE_GENERIC");class ee extends Me{constructor(r,s,i="unspecified",n="unspecified"){super(r,{cause:{claim:i,reason:n,payload:s}});O(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");O(this,"claim");O(this,"reason");O(this,"payload");this.claim=i,this.reason=n,this.payload=s}}O(ee,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class Tr extends Me{constructor(r,s,i="unspecified",n="unspecified"){super(r,{cause:{claim:i,reason:n,payload:s}});O(this,"code","ERR_JWT_EXPIRED");O(this,"claim");O(this,"reason");O(this,"payload");this.claim=i,this.reason=n,this.payload=s}}O(Tr,"code","ERR_JWT_EXPIRED");class pe extends Me{constructor(){super(...arguments);O(this,"code","ERR_JOSE_NOT_SUPPORTED")}}O(pe,"code","ERR_JOSE_NOT_SUPPORTED");class H extends Me{constructor(){super(...arguments);O(this,"code","ERR_JWS_INVALID")}}O(H,"code","ERR_JWS_INVALID");class Bt extends Me{constructor(){super(...arguments);O(this,"code","ERR_JWT_INVALID")}}O(Bt,"code","ERR_JWT_INVALID");class Rn extends Me{constructor(r="signature verification failed",s){super(r,s);O(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}O(Rn,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");const ie=(e,t="algorithm.name")=>new TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`),Le=(e,t)=>e.name===t;function Sr(e){return parseInt(e.name.slice(4),10)}function Ka(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Ja(e,t){if(t&&!e.usages.includes(t))throw new TypeError(`CryptoKey does not support this operation, its usages must include ${t}.`)}function Ga(e,t,r){switch(t){case"HS256":case"HS384":case"HS512":{if(!Le(e.algorithm,"HMAC"))throw ie("HMAC");const s=parseInt(t.slice(2),10);if(Sr(e.algorithm.hash)!==s)throw ie(`SHA-${s}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Le(e.algorithm,"RSASSA-PKCS1-v1_5"))throw ie("RSASSA-PKCS1-v1_5");const s=parseInt(t.slice(2),10);if(Sr(e.algorithm.hash)!==s)throw ie(`SHA-${s}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Le(e.algorithm,"RSA-PSS"))throw ie("RSA-PSS");const s=parseInt(t.slice(2),10);if(Sr(e.algorithm.hash)!==s)throw ie(`SHA-${s}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":{if(!Le(e.algorithm,"Ed25519"))throw ie("Ed25519");break}case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":{if(!Le(e.algorithm,t))throw ie(t);break}case"ES256":case"ES384":case"ES512":{if(!Le(e.algorithm,"ECDSA"))throw ie("ECDSA");const s=Ka(t);if(e.algorithm.namedCurve!==s)throw ie(s,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Ja(e,r)}function Tn(e,t,...r){var s;if(r=r.filter(Boolean),r.length>2){const i=r.pop();e+=`one of type ${r.join(", ")}, or ${i}.`}else r.length===2?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return t==null?e+=` Received ${t}`:typeof t=="function"&&t.name?e+=` Received function ${t.name}`:typeof t=="object"&&t!=null&&(s=t.constructor)!=null&&s.name&&(e+=` Received an instance of ${t.constructor.name}`),e}const Va=(e,...t)=>Tn("Key must be ",e,...t),In=(e,t,...r)=>Tn(`Key for the ${e} algorithm must be `,t,...r),Pn=e=>{if((e==null?void 0:e[Symbol.toStringTag])==="CryptoKey")return!0;try{return e instanceof CryptoKey}catch{return!1}},On=e=>(e==null?void 0:e[Symbol.toStringTag])==="KeyObject",Mn=e=>Pn(e)||On(e);function Dn(...e){const t=e.filter(Boolean);if(t.length===0||t.length===1)return!0;let r;for(const s of t){const i=Object.keys(s);if(!r||r.size===0){r=new Set(i);continue}for(const n of i){if(r.has(n))return!1;r.add(n)}}return!0}const za=e=>typeof e=="object"&&e!==null;function mt(e){if(!za(e)||Object.prototype.toString.call(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Nn(e,t){if(e.startsWith("RS")||e.startsWith("PS")){const{modulusLength:r}=t.algorithm;if(typeof r!="number"||r<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}}function Ya(e){let t,r;switch(e.kty){case"AKP":{switch(e.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":t={name:e.alg},r=e.priv?["sign"]:["verify"];break;default:throw new pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"RSA":{switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(e.alg){case"Ed25519":case"EdDSA":t={name:"Ed25519"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new pe('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}async function Xa(e){if(!e.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:t,keyUsages:r}=Ya(e),s={...e};return s.kty!=="AKP"&&delete s.alg,delete s.use,crypto.subtle.importKey("jwk",s,t,e.ext??!(e.d||e.priv),e.key_ops??r)}function $n(e,t,r,s,i){if(i.crit!==void 0&&(s==null?void 0:s.crit)===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!s||s.crit===void 0)return new Set;if(!Array.isArray(s.crit)||s.crit.length===0||s.crit.some(a=>typeof a!="string"||a.length===0))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let n;r!==void 0?n=new Map([...Object.entries(r),...t.entries()]):n=t;for(const a of s.crit){if(!n.has(a))throw new pe(`Extension Header Parameter "${a}" is not recognized`);if(i[a]===void 0)throw new e(`Extension Header Parameter "${a}" is missing`);if(n.get(a)&&s[a]===void 0)throw new e(`Extension Header Parameter "${a}" MUST be integrity protected`)}return new Set(s.crit)}const Nr=e=>mt(e)&&typeof e.kty=="string",Za=e=>e.kty!=="oct"&&(e.kty==="AKP"&&typeof e.priv=="string"||typeof e.d=="string"),eo=e=>e.kty!=="oct"&&e.d===void 0&&e.priv===void 0,to=e=>e.kty==="oct"&&typeof e.k=="string";let Fe;const Bs=async(e,t,r,s=!1)=>{Fe||(Fe=new WeakMap);let i=Fe.get(e);if(i!=null&&i[r])return i[r];const n=await Xa({...t,alg:r});return s&&Object.freeze(e),i?i[r]=n:Fe.set(e,{[r]:n}),n},ro=(e,t)=>{var a;Fe||(Fe=new WeakMap);let r=Fe.get(e);if(r!=null&&r[t])return r[t];const s=e.type==="public",i=!!s;let n;if(e.asymmetricKeyType==="x25519"){switch(t){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}n=e.toCryptoKey(e.asymmetricKeyType,i,s?[]:["deriveBits"])}if(e.asymmetricKeyType==="ed25519"){if(t!=="EdDSA"&&t!=="Ed25519")throw new TypeError("given KeyObject instance cannot be used for this algorithm");n=e.toCryptoKey(e.asymmetricKeyType,i,[s?"verify":"sign"])}switch(e.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":{if(t!==e.asymmetricKeyType.toUpperCase())throw new TypeError("given KeyObject instance cannot be used for this algorithm");n=e.toCryptoKey(e.asymmetricKeyType,i,[s?"verify":"sign"])}}if(e.asymmetricKeyType==="rsa"){let c;switch(t){case"RSA-OAEP":c="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":c="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":c="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":c="SHA-512";break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}if(t.startsWith("RSA-OAEP"))return e.toCryptoKey({name:"RSA-OAEP",hash:c},i,s?["encrypt"]:["decrypt"]);n=e.toCryptoKey({name:t.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:c},i,[s?"verify":"sign"])}if(e.asymmetricKeyType==="ec"){const f=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get((a=e.asymmetricKeyDetails)==null?void 0:a.namedCurve);if(!f)throw new TypeError("given KeyObject instance cannot be used for this algorithm");t==="ES256"&&f==="P-256"&&(n=e.toCryptoKey({name:"ECDSA",namedCurve:f},i,[s?"verify":"sign"])),t==="ES384"&&f==="P-384"&&(n=e.toCryptoKey({name:"ECDSA",namedCurve:f},i,[s?"verify":"sign"])),t==="ES512"&&f==="P-521"&&(n=e.toCryptoKey({name:"ECDSA",namedCurve:f},i,[s?"verify":"sign"])),t.startsWith("ECDH-ES")&&(n=e.toCryptoKey({name:"ECDH",namedCurve:f},i,s?[]:["deriveBits"]))}if(!n)throw new TypeError("given KeyObject instance cannot be used for this algorithm");return r?r[t]=n:Fe.set(e,{[t]:n}),n};async function Ln(e,t){if(e instanceof Uint8Array||Pn(e))return e;if(On(e)){if(e.type==="secret")return e.export();if("toCryptoKey"in e&&typeof e.toCryptoKey=="function")try{return ro(e,t)}catch(s){if(s instanceof TypeError)throw s}let r=e.export({format:"jwk"});return Bs(e,r,t)}if(Nr(e))return e.k?Mt(e.k):Bs(e,e,t,!0);throw new Error("unreachable")}const je=e=>e==null?void 0:e[Symbol.toStringTag],Ir=(e,t,r)=>{var s,i;if(t.use!==void 0){let n;switch(r){case"sign":case"verify":n="sig";break;case"encrypt":case"decrypt":n="enc";break}if(t.use!==n)throw new TypeError(`Invalid key for this operation, its "use" must be "${n}" when present`)}if(t.alg!==void 0&&t.alg!==e)throw new TypeError(`Invalid key for this operation, its "alg" must be "${e}" when present`);if(Array.isArray(t.key_ops)){let n;switch(!0){case(r==="sign"||r==="verify"):case e==="dir":case e.includes("CBC-HS"):n=r;break;case e.startsWith("PBES2"):n="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(e):!e.includes("GCM")&&e.endsWith("KW")?n=r==="encrypt"?"wrapKey":"unwrapKey":n=r;break;case(r==="encrypt"&&e.startsWith("RSA")):n="wrapKey";break;case r==="decrypt":n=e.startsWith("RSA")?"unwrapKey":"deriveBits";break}if(n&&((i=(s=t.key_ops)==null?void 0:s.includes)==null?void 0:i.call(s,n))===!1)throw new TypeError(`Invalid key for this operation, its "key_ops" must include "${n}" when present`)}return!0},so=(e,t,r)=>{if(!(t instanceof Uint8Array)){if(Nr(t)){if(to(t)&&Ir(e,t,r))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Mn(t))throw new TypeError(In(e,t,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if(t.type!=="secret")throw new TypeError(`${je(t)} instances for symmetric algorithms must be of type "secret"`)}},no=(e,t,r)=>{if(Nr(t))switch(r){case"decrypt":case"sign":if(Za(t)&&Ir(e,t,r))return;throw new TypeError("JSON Web Key for this operation must be a private JWK");case"encrypt":case"verify":if(eo(t)&&Ir(e,t,r))return;throw new TypeError("JSON Web Key for this operation must be a public JWK")}if(!Mn(t))throw new TypeError(In(e,t,"CryptoKey","KeyObject","JSON Web Key"));if(t.type==="secret")throw new TypeError(`${je(t)} instances for asymmetric algorithms must not be of type "secret"`);if(t.type==="public")switch(r){case"sign":throw new TypeError(`${je(t)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw new TypeError(`${je(t)} instances for asymmetric algorithm decryption must be of type "private"`)}if(t.type==="private")switch(r){case"verify":throw new TypeError(`${je(t)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw new TypeError(`${je(t)} instances for asymmetric algorithm encryption must be of type "public"`)}};function qn(e,t,r){switch(e.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":so(e,t,r);break;default:no(e,t,r)}}function kn(e,t){const r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:parseInt(e.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:e};default:throw new pe(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}async function Bn(e,t,r){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(Va(t,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}return Ga(t,e,r),t}async function io(e,t,r,s){const i=await Bn(e,t,"verify");Nn(e,i);const n=kn(e,i.algorithm);try{return await crypto.subtle.verify(n,i,r,s)}catch{return!1}}async function ao(e,t,r){if(!mt(e))throw new H("Flattened JWS must be an object");if(e.protected===void 0&&e.header===void 0)throw new H('Flattened JWS must have either of the "protected" or "header" members');if(e.protected!==void 0&&typeof e.protected!="string")throw new H("JWS Protected Header incorrect type");if(e.payload===void 0)throw new H("JWS Payload missing");if(typeof e.signature!="string")throw new H("JWS Signature missing or incorrect type");if(e.header!==void 0&&!mt(e.header))throw new H("JWS Unprotected Header incorrect type");let s={};if(e.protected)try{const b=Mt(e.protected);s=JSON.parse(xt.decode(b))}catch{throw new H("JWS Protected Header is invalid")}if(!Dn(s,e.header))throw new H("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const i={...s,...e.header},n=$n(H,new Map([["b64",!0]]),r==null?void 0:r.crit,s,i);let a=!0;if(n.has("b64")&&(a=s.b64,typeof a!="boolean"))throw new H('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:c}=i;if(typeof c!="string"||!c)throw new H('JWS "alg" (Algorithm) Header Parameter missing or invalid');if(a){if(typeof e.payload!="string")throw new H("JWS Payload must be a string")}else if(typeof e.payload!="string"&&!(e.payload instanceof Uint8Array))throw new H("JWS Payload must be a string or an Uint8Array instance");let f=!1;typeof t=="function"&&(t=await t(s,e),f=!0),qn(c,t,"verify");const u=Cn(e.protected!==void 0?Ue(e.protected):new Uint8Array,Ue("."),typeof e.payload=="string"?a?Ue(e.payload):Nt.encode(e.payload):e.payload);let o;try{o=Mt(e.signature)}catch{throw new H("Failed to base64url decode the signature")}const l=await Ln(t,c);if(!await io(c,l,o,u))throw new Rn;let h;if(a)try{h=Mt(e.payload)}catch{throw new H("Failed to base64url decode the payload")}else typeof e.payload=="string"?h=Nt.encode(e.payload):h=e.payload;const x={payload:h};return e.protected!==void 0&&(x.protectedHeader=s),e.header!==void 0&&(x.unprotectedHeader=e.header),f?{...x,key:l}:x}async function oo(e,t,r){if(e instanceof Uint8Array&&(e=xt.decode(e)),typeof e!="string")throw new H("Compact JWS must be a string or Uint8Array");const{0:s,1:i,2:n,length:a}=e.split(".");if(a!==3)throw new H("Invalid Compact JWS");const c=await ao({payload:i,protected:s,signature:n},t,r),f={payload:c.payload,protectedHeader:c.protectedHeader};return typeof t=="function"?{...f,key:c.key}:f}const he=e=>Math.floor(e.getTime()/1e3),Hn=60,jn=Hn*60,$r=jn*24,co=$r*7,uo=$r*365.25,fo=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function dt(e){const t=fo.exec(e);if(!t||t[4]&&t[1])throw new TypeError("Invalid time period format");const r=parseFloat(t[2]),s=t[3].toLowerCase();let i;switch(s){case"sec":case"secs":case"second":case"seconds":case"s":i=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":i=Math.round(r*Hn);break;case"hour":case"hours":case"hr":case"hrs":case"h":i=Math.round(r*jn);break;case"day":case"days":case"d":i=Math.round(r*$r);break;case"week":case"weeks":case"w":i=Math.round(r*co);break;default:i=Math.round(r*uo);break}return t[1]==="-"||t[4]==="ago"?-i:i}function ve(e,t){if(!Number.isFinite(t))throw new TypeError(`Invalid ${e} input`);return t}const Hs=e=>e.includes("/")?e.toLowerCase():`application/${e.toLowerCase()}`,lo=(e,t)=>typeof e=="string"?t.includes(e):Array.isArray(e)?t.some(Set.prototype.has.bind(new Set(e))):!1;function ho(e,t,r={}){let s;try{s=JSON.parse(xt.decode(t))}catch{}if(!mt(s))throw new Bt("JWT Claims Set must be a top-level JSON object");const{typ:i}=r;if(i&&(typeof e.typ!="string"||Hs(e.typ)!==Hs(i)))throw new ee('unexpected "typ" JWT header value',s,"typ","check_failed");const{requiredClaims:n=[],issuer:a,subject:c,audience:f,maxTokenAge:u}=r,o=[...n];u!==void 0&&o.push("iat"),f!==void 0&&o.push("aud"),c!==void 0&&o.push("sub"),a!==void 0&&o.push("iss");for(const x of new Set(o.reverse()))if(!(x in s))throw new ee(`missing required "${x}" claim`,s,x,"missing");if(a&&!(Array.isArray(a)?a:[a]).includes(s.iss))throw new ee('unexpected "iss" claim value',s,"iss","check_failed");if(c&&s.sub!==c)throw new ee('unexpected "sub" claim value',s,"sub","check_failed");if(f&&!lo(s.aud,typeof f=="string"?[f]:f))throw new ee('unexpected "aud" claim value',s,"aud","check_failed");let l;switch(typeof r.clockTolerance){case"string":l=dt(r.clockTolerance);break;case"number":l=r.clockTolerance;break;case"undefined":l=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:d}=r,h=he(d||new Date);if((s.iat!==void 0||u)&&typeof s.iat!="number")throw new ee('"iat" claim must be a number',s,"iat","invalid");if(s.nbf!==void 0){if(typeof s.nbf!="number")throw new ee('"nbf" claim must be a number',s,"nbf","invalid");if(s.nbf>h+l)throw new ee('"nbf" claim timestamp check failed',s,"nbf","check_failed")}if(s.exp!==void 0){if(typeof s.exp!="number")throw new ee('"exp" claim must be a number',s,"exp","invalid");if(s.exp<=h-l)throw new Tr('"exp" claim timestamp check failed',s,"exp","check_failed")}if(u){const x=h-s.iat,b=typeof u=="number"?u:dt(u);if(x-l>b)throw new Tr('"iat" claim timestamp check failed (too far in the past)',s,"iat","check_failed");if(x<0-l)throw new ee('"iat" claim timestamp check failed (it should be in the past)',s,"iat","check_failed")}return s}var j;class po{constructor(t){$(this,j);if(!mt(t))throw new TypeError("JWT Claims Set MUST be an object");M(this,j,structuredClone(t))}data(){return Nt.encode(JSON.stringify(g(this,j)))}get iss(){return g(this,j).iss}set iss(t){g(this,j).iss=t}get sub(){return g(this,j).sub}set sub(t){g(this,j).sub=t}get aud(){return g(this,j).aud}set aud(t){g(this,j).aud=t}set jti(t){g(this,j).jti=t}set nbf(t){typeof t=="number"?g(this,j).nbf=ve("setNotBefore",t):t instanceof Date?g(this,j).nbf=ve("setNotBefore",he(t)):g(this,j).nbf=he(new Date)+dt(t)}set exp(t){typeof t=="number"?g(this,j).exp=ve("setExpirationTime",t):t instanceof Date?g(this,j).exp=ve("setExpirationTime",he(t)):g(this,j).exp=he(new Date)+dt(t)}set iat(t){t===void 0?g(this,j).iat=he(new Date):t instanceof Date?g(this,j).iat=ve("setIssuedAt",he(t)):typeof t=="string"?g(this,j).iat=ve("setIssuedAt",he(new Date)+dt(t)):g(this,j).iat=ve("setIssuedAt",t)}}j=new WeakMap;async function xo(e,t,r){var a;const s=await oo(e,t,r);if((a=s.protectedHeader.crit)!=null&&a.includes("b64")&&s.protectedHeader.b64===!1)throw new Bt("JWTs MUST NOT use unencoded payload");const n={payload:ho(s.protectedHeader,s.payload,r),protectedHeader:s.protectedHeader};return typeof t=="function"?{...n,key:s.key}:n}async function mo(e,t,r){const s=await Bn(e,t,"sign");Nn(e,s);const i=await crypto.subtle.sign(kn(e,s.algorithm),s,r);return new Uint8Array(i)}var Ye,V,ae;class yo{constructor(t){$(this,Ye);$(this,V);$(this,ae);if(!(t instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");M(this,Ye,t)}setProtectedHeader(t){if(g(this,V))throw new TypeError("setProtectedHeader can only be called once");return M(this,V,t),this}setUnprotectedHeader(t){if(g(this,ae))throw new TypeError("setUnprotectedHeader can only be called once");return M(this,ae,t),this}async sign(t,r){if(!g(this,V)&&!g(this,ae))throw new H("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Dn(g(this,V),g(this,ae)))throw new H("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const s={...g(this,V),...g(this,ae)},i=$n(H,new Map([["b64",!0]]),r==null?void 0:r.crit,g(this,V),s);let n=!0;if(i.has("b64")&&(n=g(this,V).b64,typeof n!="boolean"))throw new H('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:a}=s;if(typeof a!="string"||!a)throw new H('JWS "alg" (Algorithm) Header Parameter missing or invalid');qn(a,t,"sign");let c,f;n?(c=vr(g(this,Ye)),f=Ue(c)):(f=g(this,Ye),c="");let u,o;g(this,V)?(u=vr(JSON.stringify(g(this,V))),o=Ue(u)):(u="",o=new Uint8Array);const l=Cn(o,Ue("."),f),d=await Ln(t,a),h=await mo(a,d,l),x={signature:vr(h),payload:c};return g(this,ae)&&(x.header=g(this,ae)),g(this,V)&&(x.protected=u),x}}Ye=new WeakMap,V=new WeakMap,ae=new WeakMap;var Xe;class bo{constructor(t){$(this,Xe);M(this,Xe,new yo(t))}setProtectedHeader(t){return g(this,Xe).setProtectedHeader(t),this}async sign(t,r){const s=await g(this,Xe).sign(t,r);if(s.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${s.protected}.${s.payload}.${s.signature}`}}Xe=new WeakMap;var _e,Y;class go{constructor(t={}){$(this,_e);$(this,Y);M(this,Y,new po(t))}setIssuer(t){return g(this,Y).iss=t,this}setSubject(t){return g(this,Y).sub=t,this}setAudience(t){return g(this,Y).aud=t,this}setJti(t){return g(this,Y).jti=t,this}setNotBefore(t){return g(this,Y).nbf=t,this}setExpirationTime(t){return g(this,Y).exp=t,this}setIssuedAt(t){return g(this,Y).iat=t,this}setProtectedHeader(t){return M(this,_e,t),this}async sign(t,r){var i;const s=new bo(g(this,Y).data());if(s.setProtectedHeader(g(this,_e)),Array.isArray((i=g(this,_e))==null?void 0:i.crit)&&g(this,_e).crit.includes("b64")&&g(this,_e).b64===!1)throw new Bt("JWTs MUST NOT use unencoded payload");return s.sign(t,r)}}_e=new WeakMap,Y=new WeakMap;var wo={};const Un=new TextEncoder().encode(wo.JWT_SECRET||"change-this-secret-in-production"),_o="7d";async function Fn(e){const t=await En(10);return vn(e,t)}async function Eo(e,t){return qa(e,t)}async function vo(e){return await new go(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(_o).sign(Un)}async function So(e){try{const{payload:t}=await xo(e,Un);return t}catch{throw new Error("Invalid or expired token")}}function Ao(e){if(!e)return null;const t=e.split(" ");return t.length!==2||t[0]!=="Bearer"?null:t[1]}const rt=new tt;rt.post("/login",async e=>{var t,r;try{const s=await e.req.json(),{email:i,password:n}=s;if(!i||!n)return e.json({error:"Email and password are required"},400);const a=await L("SELECT * FROM users WHERE email = $1 AND active = true",[i]);if(a.length===0)return e.json({error:"Invalid email or password"},401);const c=a[0];if(!await Eo(n,c.password_hash))return e.json({error:"Invalid email or password"},401);const u=await L(`SELECT uc.*, c.name as company_name 
       FROM user_companies uc 
       JOIN companies c ON c.id = uc.company_id 
       WHERE uc.user_id = $1`,[c.id]);await L("UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = $1",[c.id]);const o=await vo({userId:c.id,email:c.email,role:c.role,companyId:(t=u[0])==null?void 0:t.company_id});await L(`INSERT INTO audit_logs (user_id, company_id, action, entity_type, entity_id, new_data, ip_address)
       VALUES ($1, $2, $3, $4, $5, $6, $7)`,[c.id,((r=u[0])==null?void 0:r.company_id)||null,"login","user",c.id,JSON.stringify({email:c.email}),e.req.header("cf-connecting-ip")||e.req.header("x-forwarded-for")||"unknown"]);const l={token:o,user:{id:c.id,email:c.email,name:c.name,role:c.role},companies:u.map(d=>({id:d.company_id,name:d.company_name,role:d.role}))};return e.json(l)}catch(s){return console.error("Login error:",s),e.json({error:"Internal server error"},500)}});rt.post("/register",async e=>{try{const t=await e.req.json(),{email:r,password:s,name:i,role:n,company_id:a}=t;if(!r||!s||!i)return e.json({error:"Email, password and name are required"},400);if((await L("SELECT id FROM users WHERE email = $1",[r])).length>0)return e.json({error:"User already exists"},400);const f=await Fn(s),o=(await L(`INSERT INTO users (email, password_hash, name, role, active)
       VALUES ($1, $2, $3, $4, true)
       RETURNING *`,[r,f,i,n||"read_only"]))[0];return a&&await L(`INSERT INTO user_companies (user_id, company_id, role)
         VALUES ($1, $2, $3)`,[o.id,a,n||"read_only"]),e.json({message:"User created successfully",user:{id:o.id,email:o.email,name:o.name,role:o.role}},201)}catch(t){return console.error("Register error:",t),e.json({error:"Internal server error"},500)}});rt.post("/forgot-password",async e=>{try{const{email:t}=await e.req.json();if(!t)return e.json({error:"Email is required"},400);const r=await L("SELECT id FROM users WHERE email = $1 AND active = true",[t]);if(r.length===0)return e.json({message:"If the email exists, a reset link will be sent"});const s=r[0],i=Math.random().toString(36).substring(2,15),n=new Date(Date.now()+36e5);return await L(`UPDATE users 
       SET password_reset_token = $1, password_reset_expires = $2 
       WHERE id = $3`,[i,n,s.id]),e.json({message:"If the email exists, a reset link will be sent"})}catch(t){return console.error("Forgot password error:",t),e.json({error:"Internal server error"},500)}});rt.post("/reset-password",async e=>{try{const{token:t,new_password:r}=await e.req.json();if(!t||!r)return e.json({error:"Token and new password are required"},400);const s=await L(`SELECT id FROM users 
       WHERE password_reset_token = $1 
       AND password_reset_expires > CURRENT_TIMESTAMP 
       AND active = true`,[t]);if(s.length===0)return e.json({error:"Invalid or expired reset token"},400);const i=s[0],n=await Fn(r);return await L(`UPDATE users 
       SET password_hash = $1, 
           password_reset_token = NULL, 
           password_reset_expires = NULL 
       WHERE id = $2`,[n,i.id]),e.json({message:"Password reset successfully"})}catch(t){return console.error("Reset password error:",t),e.json({error:"Internal server error"},500)}});rt.get("/me",async e=>{try{const t=e.get("user");if(!t)return e.json({error:"Not authenticated"},401);const r=await L("SELECT id, email, name, role, avatar_url, active, last_login FROM users WHERE id = $1",[t.userId]);if(r.length===0)return e.json({error:"User not found"},404);const s=await L(`SELECT uc.*, c.name as company_name 
       FROM user_companies uc 
       JOIN companies c ON c.id = uc.company_id 
       WHERE uc.user_id = $1`,[t.userId]);return e.json({user:r[0],companies:s.map(i=>({id:i.company_id,name:i.company_name,role:i.role}))})}catch(t){return console.error("Get user error:",t),e.json({error:"Internal server error"},500)}});async function Lr(e,t){const r=e.req.header("Authorization"),s=Ao(r);if(!s)return e.json({error:"Authentication required"},401);try{const i=await So(s);e.set("user",i),await t()}catch{return e.json({error:"Invalid or expired token"},401)}}const Ee=new tt;Ee.use("/*",Lr);Ee.get("/",async e=>{try{const t=e.get("user"),{page:r="1",limit:s="20",search:i="",sort_by:n="name",sort_order:a="asc"}=e.req.query(),c=(parseInt(r)-1)*parseInt(s),f=`%${i}%`,u=`
      SELECT 
        p.*,
        c.name as category_name,
        b.name as brand_name,
        COALESCE(SUM(sb.quantity), 0) as total_stock
      FROM products p
      LEFT JOIN categories c ON c.id = p.category_id
      LEFT JOIN brands b ON b.id = p.brand_id
      LEFT JOIN stock_balance sb ON sb.product_id = p.id
      WHERE p.company_id = $1
      AND (p.name ILIKE $2 OR p.sku ILIKE $2 OR p.barcode ILIKE $2)
      GROUP BY p.id, c.name, b.name
      ORDER BY ${n} ${a}
      LIMIT $3 OFFSET $4
    `,o=await L(u,[t.companyId,f,parseInt(s),c]),l=await L(`SELECT COUNT(*) as count FROM products 
       WHERE company_id = $1 
       AND (name ILIKE $2 OR sku ILIKE $2 OR barcode ILIKE $2)`,[t.companyId,f]),d=parseInt(l[0].count),h={data:o,pagination:{page:parseInt(r),limit:parseInt(s),total:d,total_pages:Math.ceil(d/parseInt(s))}};return e.json(h)}catch(t){return console.error("List products error:",t),e.json({error:"Internal server error"},500)}});Ee.get("/:id",async e=>{try{const t=e.get("user"),{id:r}=e.req.param(),s=await L(`SELECT 
        p.*,
        c.name as category_name,
        b.name as brand_name
      FROM products p
      LEFT JOIN categories c ON c.id = p.category_id
      LEFT JOIN brands b ON b.id = p.brand_id
      WHERE p.id = $1 AND p.company_id = $2`,[r,t.companyId]);if(s.length===0)return e.json({error:"Product not found"},404);const i=await L(`SELECT 
        sb.branch_id,
        br.name as branch_name,
        sb.quantity,
        sb.last_movement
      FROM stock_balance sb
      JOIN branches br ON br.id = sb.branch_id
      WHERE sb.product_id = $1`,[r]);return e.json({product:s[0],stock:i})}catch(t){return console.error("Get product error:",t),e.json({error:"Internal server error"},500)}});Ee.post("/",async e=>{try{const t=e.get("user"),r=await e.req.json(),{sku:s,barcode:i,name:n,description:a,category_id:c,brand_id:f,cost_price:u,sale_price:o,unit:l="UN",min_stock:d=0,max_stock:h=0,image_url:x}=r;if(!s||!n||o===void 0)return e.json({error:"SKU, name and sale_price are required"},400);if((await L("SELECT id FROM products WHERE company_id = $1 AND sku = $2",[t.companyId,s])).length>0)return e.json({error:"SKU already exists"},400);const w=await L(`INSERT INTO products (
        company_id, sku, barcode, name, description, category_id, brand_id,
        cost_price, sale_price, unit, min_stock, max_stock, image_url, active
      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, true)
      RETURNING *`,[t.companyId,s,i,n,a,c,f,u||0,o,l,d,h,x]);return await L(`INSERT INTO audit_logs (user_id, company_id, action, entity_type, entity_id, new_data)
       VALUES ($1, $2, $3, $4, $5, $6)`,[t.userId,t.companyId,"create","product",w[0].id,JSON.stringify(w[0])]),e.json(w[0],201)}catch(t){return console.error("Create product error:",t),e.json({error:"Internal server error"},500)}});Ee.put("/:id",async e=>{try{const t=e.get("user"),{id:r}=e.req.param(),s=await e.req.json(),i=await L("SELECT * FROM products WHERE id = $1 AND company_id = $2",[r,t.companyId]);if(i.length===0)return e.json({error:"Product not found"},404);const n=[],a=[];let c=1;if(Object.entries(s).forEach(([o,l])=>{l!==void 0&&o!=="id"&&o!=="company_id"&&(n.push(`${o} = $${c}`),a.push(l),c++)}),n.length===0)return e.json({error:"No fields to update"},400);a.push(r,t.companyId);const f=`
      UPDATE products 
      SET ${n.join(", ")}, updated_at = CURRENT_TIMESTAMP
      WHERE id = $${c} AND company_id = $${c+1}
      RETURNING *
    `,u=await L(f,a);return await L(`INSERT INTO audit_logs (user_id, company_id, action, entity_type, entity_id, old_data, new_data)
       VALUES ($1, $2, $3, $4, $5, $6, $7)`,[t.userId,t.companyId,"update","product",r,JSON.stringify(i[0]),JSON.stringify(u[0])]),e.json(u[0])}catch(t){return console.error("Update product error:",t),e.json({error:"Internal server error"},500)}});Ee.delete("/:id",async e=>{try{const t=e.get("user"),{id:r}=e.req.param(),s=await L("SELECT * FROM products WHERE id = $1 AND company_id = $2",[r,t.companyId]);return s.length===0?e.json({error:"Product not found"},404):(await L("UPDATE products SET active = false, updated_at = CURRENT_TIMESTAMP WHERE id = $1",[r]),await L(`INSERT INTO audit_logs (user_id, company_id, action, entity_type, entity_id, old_data)
       VALUES ($1, $2, $3, $4, $5, $6)`,[t.userId,t.companyId,"delete","product",r,JSON.stringify(s[0])]),e.json({message:"Product deleted successfully"}))}catch(t){return console.error("Delete product error:",t),e.json({error:"Internal server error"},500)}});Ee.get("/barcode/:barcode",async e=>{try{const t=e.get("user"),{barcode:r}=e.req.param(),s=await L(`SELECT 
        p.*,
        c.name as category_name,
        b.name as brand_name
      FROM products p
      LEFT JOIN categories c ON c.id = p.category_id
      LEFT JOIN brands b ON b.id = p.brand_id
      WHERE p.barcode = $1 AND p.company_id = $2 AND p.active = true`,[r,t.companyId]);return s.length===0?e.json({error:"Product not found"},404):e.json(s[0])}catch(t){return console.error("Find product by barcode error:",t),e.json({error:"Internal server error"},500)}});const vt=new tt;vt.use("/*",Lr);vt.post("/",async e=>{try{const t=e.get("user"),r=await e.req.json(),{customer_id:s,branch_id:i,items:n,discount_amount:a=0,discount_percentage:c=0,payment_method:f,amount_paid:u,payments:o,notes:l}=r;let d=0;n.forEach(v=>{const I=v.quantity*v.unit_price,T=v.discount_amount||I*(v.discount_percentage||0)/100;d+=I-T});const h=a||d*c/100,x=d-h,b=u-x,w=await L("SELECT COUNT(*) as count FROM sales WHERE company_id = $1",[t.companyId]),p=`VND-${String(parseInt(w[0].count)+1).padStart(5,"0")}`,y=await L(`INSERT INTO sales (company_id, branch_id, sale_number, customer_id, cashier_id, status, 
       subtotal, discount_amount, discount_percentage, total, payment_method, amount_paid, change_amount, notes)
      VALUES ($1, $2, $3, $4, $5, 'completed', $6, $7, $8, $9, $10, $11, $12, $13)
      RETURNING *`,[t.companyId,i,p,s,t.userId,d,h,c,x,f,u,b,l]),_=y[0].id;for(const v of n){const I=v.quantity*v.unit_price,T=v.discount_amount||I*(v.discount_percentage||0)/100,m=I-T;await L(`INSERT INTO sale_items (sale_id, product_id, quantity, unit_price, discount_amount, discount_percentage, subtotal, total)
        VALUES ($1, $2, $3, $4, $5, $6, $7, $8)`,[_,v.product_id,v.quantity,v.unit_price,v.discount_amount||0,v.discount_percentage||0,I,m]),await L(`UPDATE stock_balance SET quantity = quantity - $1, last_movement = CURRENT_TIMESTAMP 
        WHERE product_id = $2 AND branch_id = $3`,[v.quantity,v.product_id,i]),await L(`INSERT INTO stock_movements (product_id, branch_id, type, quantity, unit_cost, reference_type, reference_id, user_id)
        VALUES ($1, $2, 'sale', $3, $4, 'sale', $5, $6)`,[v.product_id,i,-v.quantity,v.unit_price,_,t.userId])}if(f==="mixed"&&o)for(const v of o)await L("INSERT INTO sale_payments (sale_id, payment_method, amount) VALUES ($1, $2, $3)",[_,v.payment_method,v.amount]);return await L(`INSERT INTO audit_logs (user_id, company_id, action, entity_type, entity_id, new_data)
      VALUES ($1, $2, 'sale_create', 'sale', $3, $4)`,[t.userId,t.companyId,_,JSON.stringify({sale_number:p,total:x})]),e.json(y[0],201)}catch(t){return console.error("Create sale error:",t),e.json({error:"Internal server error"},500)}});vt.get("/",async e=>{try{const t=e.get("user"),{page:r="1",limit:s="20",start_date:i,end_date:n,branch_id:a,status:c}=e.req.query(),f=(parseInt(r)-1)*parseInt(s);let u="WHERE s.company_id = $1";const o=[t.companyId];let l=2;i&&(u+=` AND s.created_at >= $${l}`,o.push(i),l++),n&&(u+=` AND s.created_at <= $${l}`,o.push(n),l++),a&&(u+=` AND s.branch_id = $${l}`,o.push(a),l++),c&&(u+=` AND s.status = $${l}`,o.push(c),l++);const d=await L(`SELECT s.*, b.name as branch_name, u.name as cashier_name, p.name as customer_name
      FROM sales s
      JOIN branches b ON b.id = s.branch_id
      LEFT JOIN users u ON u.id = s.cashier_id
      LEFT JOIN persons p ON p.id = s.customer_id
      ${u}
      ORDER BY s.created_at DESC
      LIMIT $${l} OFFSET $${l+1}`,[...o,parseInt(s),f]);return e.json({data:d})}catch(t){return console.error("List sales error:",t),e.json({error:"Internal server error"},500)}});vt.get("/:id",async e=>{try{const t=e.get("user"),{id:r}=e.req.param(),s=await L(`SELECT s.*, b.name as branch_name, u.name as cashier_name, p.name as customer_name
      FROM sales s
      JOIN branches b ON b.id = s.branch_id
      LEFT JOIN users u ON u.id = s.cashier_id
      LEFT JOIN persons p ON p.id = s.customer_id
      WHERE s.id = $1 AND s.company_id = $2`,[r,t.companyId]);if(s.length===0)return e.json({error:"Sale not found"},404);const i=await L(`SELECT si.*, pr.name as product_name, pr.sku, pr.barcode
      FROM sale_items si
      JOIN products pr ON pr.id = si.product_id
      WHERE si.sale_id = $1`,[r]),n=await L("SELECT * FROM sale_payments WHERE sale_id = $1",[r]);return e.json({sale:s[0],items:i,payments:n})}catch(t){return console.error("Get sale error:",t),e.json({error:"Internal server error"},500)}});const St=new tt;St.use("/*",Lr);St.get("/",async e=>{try{const t=e.get("user"),{branch_id:r,low_stock:s,search:i}=e.req.query();let n="WHERE p.company_id = $1";const a=[t.companyId];let c=2;r&&(n+=` AND sb.branch_id = $${c}`,a.push(r),c++),i&&(n+=` AND (p.name ILIKE $${c} OR p.sku ILIKE $${c})`,a.push(`%${i}%`),c++);const f=await L(`SELECT 
        p.id as product_id,
        p.sku,
        p.barcode,
        p.name as product_name,
        p.unit,
        p.min_stock,
        p.cost_price,
        p.sale_price,
        sb.branch_id,
        b.name as branch_name,
        sb.quantity,
        sb.last_movement,
        (sb.quantity * p.cost_price) as total_cost,
        (sb.quantity * p.sale_price) as total_value
      FROM products p
      LEFT JOIN stock_balance sb ON sb.product_id = p.id
      LEFT JOIN branches b ON b.id = sb.branch_id
      ${n}
      ${s==="true"?"AND sb.quantity < p.min_stock":""}
      ORDER BY p.name`,a);return e.json({data:f})}catch(t){return console.error("Get stock error:",t),e.json({error:"Internal server error"},500)}});St.post("/adjustment",async e=>{try{const t=e.get("user"),{product_id:r,branch_id:s,quantity:i,type:n,notes:a}=await e.req.json();return await L(`INSERT INTO stock_balance (product_id, branch_id, quantity, last_movement)
      VALUES ($1, $2, $3, CURRENT_TIMESTAMP)
      ON CONFLICT (product_id, branch_id)
      DO UPDATE SET quantity = stock_balance.quantity + $3, last_movement = CURRENT_TIMESTAMP`,[r,s,i]),await L(`INSERT INTO stock_movements (product_id, branch_id, type, quantity, reference_type, notes, user_id)
      VALUES ($1, $2, $3, $4, 'adjustment', $5, $6)`,[r,s,n,i,a,t.userId]),await L(`INSERT INTO audit_logs (user_id, company_id, action, entity_type, entity_id, new_data)
      VALUES ($1, $2, 'stock_adjustment', 'stock', $3, $4)`,[t.userId,t.companyId,r,JSON.stringify({quantity:i,type:n,notes:a})]),e.json({message:"Stock adjusted successfully"})}catch(t){return console.error("Stock adjustment error:",t),e.json({error:"Internal server error"},500)}});St.get("/movements",async e=>{try{const t=e.get("user"),{product_id:r,branch_id:s,start_date:i,end_date:n,type:a}=e.req.query();let c="WHERE p.company_id = $1";const f=[t.companyId];let u=2;r&&(c+=` AND sm.product_id = $${u}`,f.push(r),u++),s&&(c+=` AND sm.branch_id = $${u}`,f.push(s),u++),i&&(c+=` AND sm.created_at >= $${u}`,f.push(i),u++),n&&(c+=` AND sm.created_at <= $${u}`,f.push(n),u++),a&&(c+=` AND sm.type = $${u}`,f.push(a),u++);const o=await L(`SELECT 
        sm.*,
        p.name as product_name,
        p.sku,
        b.name as branch_name,
        u.name as user_name
      FROM stock_movements sm
      JOIN products p ON p.id = sm.product_id
      JOIN branches b ON b.id = sm.branch_id
      LEFT JOIN users u ON u.id = sm.user_id
      ${c}
      ORDER BY sm.created_at DESC
      LIMIT 100`,f);return e.json({data:o})}catch(t){return console.error("Get stock movements error:",t),e.json({error:"Internal server error"},500)}});const Z=new tt;Z.use("/*",Ui());Z.use("/api/*",Li());Z.use("/static/*",zi({root:"./dist"}));Z.route("/api/auth",rt);Z.route("/api/products",Ee);Z.route("/api/sales",vt);Z.route("/api/stock",St);Z.get("/api/health",e=>e.json({status:"ok",timestamp:new Date().toISOString(),version:"1.0.0"}));Z.get("/",e=>e.html(`
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP/PDV - Sistema de Gesto</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"><\/script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              heading: ['Montserrat', 'sans-serif']
            },
            colors: {
              primary: {
                50: '#f0f9ff',
                100: '#e0f2fe',
                500: '#0ea5e9',
                600: '#0284c7',
                700: '#0369a1',
              }
            }
          }
        }
      }
    <\/script>
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      h1, h2, h3, h4, h5, h6 {
        font-family: 'Montserrat', sans-serif;
      }
      .sidebar {
        transition: transform 0.3s ease;
      }
      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
        }
        .sidebar.open {
          transform: translateX(0);
        }
      }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen">
        <div class="flex items-center justify-center min-h-screen">
            <div class="text-center">
                <i class="fas fa-spinner fa-spin text-6xl text-primary-500 mb-6"></i>
                <p class="text-xl text-gray-600">Carregando sistema...</p>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"><\/script>
    <script src="/static/app.js"><\/script>
</body>
</html>
  `));Z.notFound(e=>e.json({error:"Not found"},404));Z.onError((e,t)=>(console.error("Server error:",e),t.json({error:"Internal server error"},500)));const js=new tt,Co=Object.assign({"/src/index.tsx":Z});let Qn=!1;for(const[,e]of Object.entries(Co))e&&(js.all("*",t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),js.notFound(t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),Qn=!0);if(!Qn)throw new Error("Can't import modules from ['/src/index.ts','/src/index.tsx','/app/server.ts']");export{js as default};
